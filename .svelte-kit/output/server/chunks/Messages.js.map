{"version":3,"file":"Messages.js","sources":["../../../../src/lib/components/common/Tags/TagInput.svelte","../../../../src/lib/components/common/Tags/TagList.svelte","../../../../src/lib/components/common/Tags.svelte","../../../../src/lib/components/chat/Messages/Skeleton.svelte","../../../../src/lib/components/chat/Messages/RateComment.svelte","../../../../src/lib/components/icons/MagnifyingGlass.svelte","../../../../src/lib/components/chat/Messages/ResponseMessage/WebSearchResults.svelte","../../../../src/lib/components/icons/Sparkles.svelte","../../../../src/lib/components/chat/Messages/Error.svelte","../../../../src/lib/components/chat/Messages/CitationsModal.svelte","../../../../src/lib/components/chat/Messages/Citations.svelte","../../../../src/lib/components/chat/Messages/CodeExecutionModal.svelte","../../../../src/lib/components/chat/Messages/CodeExecutions.svelte","../../../../src/lib/components/icons/ChatBubble.svelte","../../../../src/lib/components/icons/LightBlub.svelte","../../../../src/lib/components/chat/ContentRenderer/FloatingButtons.svelte","../../../../src/lib/components/chat/Messages/ContentRenderer.svelte","../../../../src/lib/components/chat/Messages/ResponseMessage.svelte","../../../../src/lib/components/chat/Messages/MultiResponseMessages.svelte","../../../../src/lib/components/chat/Messages/UserMessage.svelte","../../../../src/lib/components/chat/Messages/Message.svelte","../../../../src/lib/components/icons/EyeSlash.svelte","../../../../src/lib/components/chat/ChatPlaceholder.svelte","../../../../src/lib/components/chat/Messages.svelte"],"sourcesContent":["<script lang=\"ts\">\n\timport { createEventDispatcher, getContext } from 'svelte';\n\timport { tags } from '$lib/stores';\n\timport { toast } from 'svelte-sonner';\n\tconst dispatch = createEventDispatcher();\n\n\tconst i18n = getContext('i18n');\n\n\texport let label = '';\n\tlet showTagInput = false;\n\tlet tagName = '';\n\n\tconst addTagHandler = async () => {\n\t\ttagName = tagName.trim();\n\t\tif (tagName !== '') {\n\t\t\tdispatch('add', tagName);\n\t\t\ttagName = '';\n\t\t\tshowTagInput = false;\n\t\t} else {\n\t\t\ttoast.error($i18n.t(`Invalid Tag`));\n\t\t}\n\t};\n</script>\n\n<div class=\"px-0.5 flex {showTagInput ? 'flex-row-reverse' : ''}\">\n\t{#if showTagInput}\n\t\t<div class=\"flex items-center\">\n\t\t\t<input\n\t\t\t\tbind:value={tagName}\n\t\t\t\tclass=\" px-2 cursor-pointer self-center text-xs h-fit bg-transparent outline-hidden line-clamp-1 w-[6.5rem]\"\n\t\t\t\tplaceholder={$i18n.t('Add a tag')}\n\t\t\t\tlist=\"tagOptions\"\n\t\t\t\ton:keydown={(event) => {\n\t\t\t\t\tif (event.key === 'Enter') {\n\t\t\t\t\t\taddTagHandler();\n\t\t\t\t\t}\n\t\t\t\t}}\n\t\t\t/>\n\t\t\t<datalist id=\"tagOptions\">\n\t\t\t\t{#each $tags as tag}\n\t\t\t\t\t<option value={tag.name} />\n\t\t\t\t{/each}\n\t\t\t</datalist>\n\n\t\t\t<button type=\"button\" aria-label={$i18n.t('Save Tag')} on:click={addTagHandler}>\n\t\t\t\t<svg\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\tviewBox=\"0 0 16 16\"\n\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\tclass=\"w-3 h-3\"\n\t\t\t\t>\n\t\t\t\t\t<path\n\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\td=\"M12.416 3.376a.75.75 0 0 1 .208 1.04l-5 7.5a.75.75 0 0 1-1.154.114l-3-3a.75.75 0 0 1 1.06-1.06l2.353 2.353 4.493-6.74a.75.75 0 0 1 1.04-.207Z\"\n\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t/>\n\t\t\t\t</svg>\n\t\t\t</button>\n\t\t</div>\n\t{/if}\n\n\t<button\n\t\tclass=\" cursor-pointer self-center p-0.5 flex h-fit items-center dark:hover:bg-gray-700 rounded-full transition border dark:border-gray-600 border-dashed\"\n\t\ttype=\"button\"\n\t\taria-label={$i18n.t('Add Tag')}\n\t\ton:click={() => {\n\t\t\tshowTagInput = !showTagInput;\n\t\t}}\n\t>\n\t\t<div class=\" m-auto self-center\">\n\t\t\t<svg\n\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\tviewBox=\"0 0 16 16\"\n\t\t\t\tfill=\"currentColor\"\n\t\t\t\tclass=\"w-3 h-3 {showTagInput ? 'rotate-45' : ''} transition-all transform\"\n\t\t\t>\n\t\t\t\t<path\n\t\t\t\t\td=\"M8.75 3.75a.75.75 0 0 0-1.5 0v3.5h-3.5a.75.75 0 0 0 0 1.5h3.5v3.5a.75.75 0 0 0 1.5 0v-3.5h3.5a.75.75 0 0 0 0-1.5h-3.5v-3.5Z\"\n\t\t\t\t/>\n\t\t\t</svg>\n\t\t</div>\n\t</button>\n\n\t{#if label && !showTagInput}\n\t\t<span class=\"text-xs pl-2 self-center\">{label}</span>\n\t{/if}\n</div>\n","<script lang=\"ts\">\n\timport { createEventDispatcher } from 'svelte';\n\timport Tooltip from '../Tooltip.svelte';\n\timport XMark from '$lib/components/icons/XMark.svelte';\n\timport Badge from '../Badge.svelte';\n\tconst dispatch = createEventDispatcher();\n\n\texport let tags = [];\n</script>\n\n{#each tags as tag}\n\t<Tooltip content={tag.name}>\n\t\t<div\n\t\t\tclass=\"relative group/tags px-1.5 py-[0.2px] gap-0.5 flex justify-between h-fit max-h-fit w-fit items-center rounded-full bg-gray-500/20 text-gray-700 dark:text-gray-200 transition cursor-pointer\"\n\t\t>\n\t\t\t<div class=\" text-[0.7rem] font-medium self-center line-clamp-1 w-fit\">\n\t\t\t\t{tag.name}\n\t\t\t</div>\n\t\t\t<div class=\"absolute invisible right-0.5 group-hover/tags:visible transition\">\n\t\t\t\t<button\n\t\t\t\t\tclass=\"rounded-full border bg-white dark:bg-gray-700 h-full flex self-center cursor-pointer\"\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\tdispatch('delete', tag.name);\n\t\t\t\t\t}}\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t>\n\t\t\t\t\t<XMark className=\"size-3\" strokeWidth=\"2.5\" />\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>\n\t</Tooltip>\n{/each}\n","<script lang=\"ts\">\n\timport TagInput from './Tags/TagInput.svelte';\n\timport TagList from './Tags/TagList.svelte';\n\timport { getContext, createEventDispatcher } from 'svelte';\n\tconst dispatch = createEventDispatcher();\n\n\tconst i18n = getContext('i18n');\n\n\texport let tags = [];\n</script>\n\n<div class=\"flex flex-row flex-wrap gap-1 line-clamp-1\">\n\t<TagList\n\t\t{tags}\n\t\ton:delete={(e) => {\n\t\t\tdispatch('delete', e.detail);\n\t\t}}\n\t/>\n\n\t<TagInput\n\t\tlabel={tags.length == 0 ? $i18n.t('Add Tags') : ''}\n\t\ton:add={(e) => {\n\t\t\tdispatch('add', e.detail);\n\t\t}}\n\t/>\n</div>\n","<script lang=\"ts\">\n\texport let size = 'md';\n</script>\n\n<div class=\"w-full mt-2 mb-2\">\n\t<div class=\"animate-pulse flex w-full\">\n\t\t<div class=\"{size === 'md' ? 'space-y-2' : 'space-y-1.5'} w-full\">\n\t\t\t<div\n\t\t\t\tclass=\"{size === 'md' ? 'h-2' : 'h-1.5'} bg-gray-200 dark:bg-gray-600 rounded-sm mr-14\"\n\t\t\t/>\n\n\t\t\t<div class=\"grid grid-cols-3 gap-4\">\n\t\t\t\t<div\n\t\t\t\t\tclass=\"{size === 'md'\n\t\t\t\t\t\t? 'h-2'\n\t\t\t\t\t\t: 'h-1.5'} bg-gray-200 dark:bg-gray-600 rounded-sm col-span-2\"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tclass=\"{size === 'md'\n\t\t\t\t\t\t? 'h-2'\n\t\t\t\t\t\t: 'h-1.5'} bg-gray-200 dark:bg-gray-600 rounded-sm col-span-1\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div class=\"grid grid-cols-4 gap-4\">\n\t\t\t\t<div\n\t\t\t\t\tclass=\"{size === 'md'\n\t\t\t\t\t\t? 'h-2'\n\t\t\t\t\t\t: 'h-1.5'} bg-gray-200 dark:bg-gray-600 rounded-sm col-span-1\"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tclass=\"{size === 'md'\n\t\t\t\t\t\t? 'h-2'\n\t\t\t\t\t\t: 'h-1.5'} bg-gray-200 dark:bg-gray-600 rounded-sm col-span-2\"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tclass=\"{size === 'md'\n\t\t\t\t\t\t? 'h-2'\n\t\t\t\t\t\t: 'h-1.5'} bg-gray-200 dark:bg-gray-600 rounded-sm col-span-1 mr-4\"\n\t\t\t\t/>\n\t\t\t</div>\n\n\t\t\t<div class=\"{size === 'md' ? 'h-2' : 'h-1.5'} bg-gray-200 dark:bg-gray-600 rounded-sm\" />\n\t\t</div>\n\t</div>\n</div>\n","<script lang=\"ts\">\n\timport { toast } from 'svelte-sonner';\n\n\timport { createEventDispatcher, onMount, getContext } from 'svelte';\n\timport { config, models } from '$lib/stores';\n\timport Tags from '$lib/components/common/Tags.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\tconst dispatch = createEventDispatcher();\n\n\texport let message;\n\texport let show = false;\n\n\tlet LIKE_REASONS = [\n\t\t'accurate_information',\n\t\t'followed_instructions_perfectly',\n\t\t'showcased_creativity',\n\t\t'positive_attitude',\n\t\t'attention_to_detail',\n\t\t'thorough_explanation',\n\t\t'other'\n\t];\n\tlet DISLIKE_REASONS = [\n\t\t'dont_like_the_style',\n\t\t'too_verbose',\n\t\t'not_helpful',\n\t\t'not_factually_correct',\n\t\t'didnt_fully_follow_instructions',\n\t\t'refused_when_it_shouldnt_have',\n\t\t'being_lazy',\n\t\t'other'\n\t];\n\n\tlet tags = [];\n\n\tlet reasons = [];\n\tlet selectedReason = null;\n\tlet comment = '';\n\n\tlet detailedRating = null;\n\tlet selectedModel = null;\n\n\t$: if (message?.annotation?.rating === 1) {\n\t\treasons = LIKE_REASONS;\n\t} else if (message?.annotation?.rating === -1) {\n\t\treasons = DISLIKE_REASONS;\n\t}\n\n\t$: if (message) {\n\t\tinit();\n\t}\n\n\tconst init = () => {\n\t\tif (!selectedReason) {\n\t\t\tselectedReason = message?.annotation?.reason ?? '';\n\t\t}\n\n\t\tif (!comment) {\n\t\t\tcomment = message?.annotation?.comment ?? '';\n\t\t}\n\n\t\ttags = (message?.annotation?.tags ?? []).map((tag) => ({\n\t\t\tname: tag\n\t\t}));\n\n\t\tif (!detailedRating) {\n\t\t\tdetailedRating = message?.annotation?.details?.rating ?? null;\n\t\t}\n\t};\n\n\tonMount(() => {\n\t\tif (message?.arena) {\n\t\t\tselectedModel = $models.find((m) => m.id === message.selectedModelId);\n\t\t\ttoast.success(\n\t\t\t\t$i18n.t('This response was generated by \"{{model}}\"', {\n\t\t\t\t\tmodel: selectedModel ? (selectedModel?.name ?? selectedModel.id) : message.selectedModelId\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\t});\n\n\tconst saveHandler = () => {\n\t\tconsole.log('saveHandler');\n\t\t// if (!selectedReason) {\n\t\t// \ttoast.error($i18n.t('Please select a reason'));\n\t\t// \treturn;\n\t\t// }\n\n\t\tdispatch('save', {\n\t\t\treason: selectedReason,\n\t\t\tcomment: comment,\n\t\t\ttags: tags.map((tag) => tag.name),\n\t\t\tdetails: {\n\t\t\t\trating: detailedRating\n\t\t\t}\n\t\t});\n\n\t\ttoast.success($i18n.t('Thanks for your feedback!'));\n\t\tshow = false;\n\t};\n</script>\n\n{#if message?.arena}\n\t<div class=\"text-xs font-medium pt-1.5 -mb-0.5\">\n\t\t{$i18n.t('This response was generated by \"{{model}}\"', {\n\t\t\tmodel: selectedModel ? (selectedModel?.name ?? selectedModel.id) : message.selectedModelId\n\t\t})}\n\t</div>\n{/if}\n\n<div\n\tclass=\" my-2.5 rounded-xl px-4 py-3 border border-gray-100 dark:border-gray-850\"\n\tid=\"message-feedback-{message.id}\"\n>\n\t<div class=\"flex justify-between items-center\">\n\t\t<div class=\"text-sm font-medium\">{$i18n.t('How would you rate this response?')}</div>\n\n\t\t<!-- <div class=\" text-sm\">{$i18n.t('Tell us more:')}</div> -->\n\n\t\t<button\n\t\t\ton:click={() => {\n\t\t\t\tshow = false;\n\t\t\t}}\n\t\t>\n\t\t\t<svg\n\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\tfill=\"none\"\n\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\tstroke-width=\"1.5\"\n\t\t\t\tstroke=\"currentColor\"\n\t\t\t\tclass=\"size-4\"\n\t\t\t>\n\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M6 18 18 6M6 6l12 12\" />\n\t\t\t</svg>\n\t\t</button>\n\t</div>\n\n\t<div class=\"w-full flex justify-center\">\n\t\t<div class=\" relative w-fit\">\n\t\t\t<div class=\"mt-1.5 w-fit flex gap-1 pb-5\">\n\t\t\t\t<!-- 1-10 scale -->\n\t\t\t\t{#each Array.from({ length: 10 }).map((_, i) => i + 1) as rating}\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"size-7 text-sm border border-gray-100 dark:border-gray-850 hover:bg-gray-50 dark:hover:bg-gray-850 {detailedRating ===\n\t\t\t\t\t\trating\n\t\t\t\t\t\t\t? 'bg-gray-100 dark:bg-gray-800'\n\t\t\t\t\t\t\t: ''} transition rounded-full disabled:cursor-not-allowed disabled:text-gray-500 disabled:bg-white dark:disabled:bg-gray-900\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\tdetailedRating = rating;\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tdisabled={message?.annotation?.rating === -1 ? rating > 5 : rating < 6}\n\t\t\t\t\t>\n\t\t\t\t\t\t{rating}\n\t\t\t\t\t</button>\n\t\t\t\t{/each}\n\t\t\t</div>\n\n\t\t\t<div class=\"absolute bottom-0 left-0 right-0 flex justify-between text-xs\">\n\t\t\t\t<div>\n\t\t\t\t\t1 - {$i18n.t('Awful')}\n\t\t\t\t</div>\n\n\t\t\t\t<div>\n\t\t\t\t\t10 - {$i18n.t('Amazing')}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n\t<div>\n\t\t{#if reasons.length > 0}\n\t\t\t<div class=\"text-sm mt-1.5 font-medium\">{$i18n.t('Why?')}</div>\n\n\t\t\t<div class=\"flex flex-wrap gap-1.5 text-sm mt-1.5\">\n\t\t\t\t{#each reasons as reason}\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"px-3 py-0.5 border border-gray-100 dark:border-gray-850 hover:bg-gray-50 dark:hover:bg-gray-850 {selectedReason ===\n\t\t\t\t\t\treason\n\t\t\t\t\t\t\t? 'bg-gray-100 dark:bg-gray-800'\n\t\t\t\t\t\t\t: ''} transition rounded-xl\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\tselectedReason = reason;\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t{#if reason === 'accurate_information'}\n\t\t\t\t\t\t\t{$i18n.t('Accurate information')}\n\t\t\t\t\t\t{:else if reason === 'followed_instructions_perfectly'}\n\t\t\t\t\t\t\t{$i18n.t('Followed instructions perfectly')}\n\t\t\t\t\t\t{:else if reason === 'showcased_creativity'}\n\t\t\t\t\t\t\t{$i18n.t('Showcased creativity')}\n\t\t\t\t\t\t{:else if reason === 'positive_attitude'}\n\t\t\t\t\t\t\t{$i18n.t('Positive attitude')}\n\t\t\t\t\t\t{:else if reason === 'attention_to_detail'}\n\t\t\t\t\t\t\t{$i18n.t('Attention to detail')}\n\t\t\t\t\t\t{:else if reason === 'thorough_explanation'}\n\t\t\t\t\t\t\t{$i18n.t('Thorough explanation')}\n\t\t\t\t\t\t{:else if reason === 'dont_like_the_style'}\n\t\t\t\t\t\t\t{$i18n.t(\"Don't like the style\")}\n\t\t\t\t\t\t{:else if reason === 'too_verbose'}\n\t\t\t\t\t\t\t{$i18n.t('Too verbose')}\n\t\t\t\t\t\t{:else if reason === 'not_helpful'}\n\t\t\t\t\t\t\t{$i18n.t('Not helpful')}\n\t\t\t\t\t\t{:else if reason === 'not_factually_correct'}\n\t\t\t\t\t\t\t{$i18n.t('Not factually correct')}\n\t\t\t\t\t\t{:else if reason === 'didnt_fully_follow_instructions'}\n\t\t\t\t\t\t\t{$i18n.t(\"Didn't fully follow instructions\")}\n\t\t\t\t\t\t{:else if reason === 'refused_when_it_shouldnt_have'}\n\t\t\t\t\t\t\t{$i18n.t(\"Refused when it shouldn't have\")}\n\t\t\t\t\t\t{:else if reason === 'being_lazy'}\n\t\t\t\t\t\t\t{$i18n.t('Being lazy')}\n\t\t\t\t\t\t{:else if reason === 'other'}\n\t\t\t\t\t\t\t{$i18n.t('Other')}\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t{reason}\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</button>\n\t\t\t\t{/each}\n\t\t\t</div>\n\t\t{/if}\n\t</div>\n\n\t<div class=\"mt-2\">\n\t\t<textarea\n\t\t\tbind:value={comment}\n\t\t\tclass=\"w-full text-sm px-1 py-2 bg-transparent outline-hidden resize-none rounded-xl\"\n\t\t\tplaceholder={$i18n.t('Feel free to add specific details')}\n\t\t\trows=\"3\"\n\t\t/>\n\t</div>\n\n\t<div class=\"mt-2 gap-1.5 flex justify-between\">\n\t\t<div class=\"flex items-end group\">\n\t\t\t<Tags\n\t\t\t\t{tags}\n\t\t\t\ton:delete={(e) => {\n\t\t\t\t\ttags = tags.filter(\n\t\t\t\t\t\t(tag) =>\n\t\t\t\t\t\t\ttag.name.replaceAll(' ', '_').toLowerCase() !==\n\t\t\t\t\t\t\te.detail.replaceAll(' ', '_').toLowerCase()\n\t\t\t\t\t);\n\t\t\t\t}}\n\t\t\t\ton:add={(e) => {\n\t\t\t\t\ttags = [...tags, { name: e.detail }];\n\t\t\t\t}}\n\t\t\t/>\n\t\t</div>\n\n\t\t<button\n\t\t\tclass=\"px-3.5 py-1.5 text-sm font-medium bg-black hover:bg-gray-900 text-white dark:bg-white dark:text-black dark:hover:bg-gray-100 transition rounded-full\"\n\t\t\ton:click={() => {\n\t\t\t\tsaveHandler();\n\t\t\t}}\n\t\t>\n\t\t\t{$i18n.t('Save')}\n\t\t</button>\n\t</div>\n</div>\n","<script lang=\"ts\">\n\texport let className = 'size-4';\n\texport let strokeWidth = '2';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n>\n\t<path\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t\td=\"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\timport ChevronDown from '$lib/components/icons/ChevronDown.svelte';\n\timport ChevronUp from '$lib/components/icons/ChevronUp.svelte';\n\timport MagnifyingGlass from '$lib/components/icons/MagnifyingGlass.svelte';\n\timport Collapsible from '$lib/components/common/Collapsible.svelte';\n\n\texport let status = { urls: [], query: '' };\n\tlet state = false;\n</script>\n\n<Collapsible bind:open={state} className=\"w-full space-y-1\">\n\t<div\n\t\tclass=\"flex items-center gap-2 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 transition\"\n\t>\n\t\t<slot />\n\n\t\t{#if state}\n\t\t\t<ChevronUp strokeWidth=\"3.5\" className=\"size-3.5 \" />\n\t\t{:else}\n\t\t\t<ChevronDown strokeWidth=\"3.5\" className=\"size-3.5 \" />\n\t\t{/if}\n\t</div>\n\t<div\n\t\tclass=\"text-sm border border-gray-300/30 dark:border-gray-700/50 rounded-xl mb-1.5\"\n\t\tslot=\"content\"\n\t>\n\t\t{#if status?.query}\n\t\t\t<a\n\t\t\t\thref=\"https://www.google.com/search?q={status.query}\"\n\t\t\t\ttarget=\"_blank\"\n\t\t\t\tclass=\"flex w-full items-center p-3 px-4 border-b border-gray-300/30 dark:border-gray-700/50 group/item justify-between font-normal text-gray-800 dark:text-gray-300 no-underline\"\n\t\t\t>\n\t\t\t\t<div class=\"flex gap-2 items-center\">\n\t\t\t\t\t<MagnifyingGlass />\n\n\t\t\t\t\t<div class=\" line-clamp-1\">\n\t\t\t\t\t\t{status.query}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div\n\t\t\t\t\tclass=\" ml-1 text-white dark:text-gray-900 group-hover/item:text-gray-600 dark:group-hover/item:text-white transition\"\n\t\t\t\t>\n\t\t\t\t\t<!--  -->\n\t\t\t\t\t<svg\n\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\tviewBox=\"0 0 16 16\"\n\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\tclass=\"size-4\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\td=\"M4.22 11.78a.75.75 0 0 1 0-1.06L9.44 5.5H5.75a.75.75 0 0 1 0-1.5h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V6.56l-5.22 5.22a.75.75 0 0 1-1.06 0Z\"\n\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</svg>\n\t\t\t\t</div>\n\t\t\t</a>\n\t\t{/if}\n\n\t\t{#each status.urls as url, urlIdx}\n\t\t\t<a\n\t\t\t\thref={url}\n\t\t\t\ttarget=\"_blank\"\n\t\t\t\tclass=\"flex w-full items-center p-3 px-4 {urlIdx === status.urls.length - 1\n\t\t\t\t\t? ''\n\t\t\t\t\t: 'border-b border-gray-300/30 dark:border-gray-700/50'} group/item justify-between font-normal text-gray-800 dark:text-gray-300\"\n\t\t\t>\n\t\t\t\t<div class=\" line-clamp-1\">\n\t\t\t\t\t{url}\n\t\t\t\t</div>\n\n\t\t\t\t<div\n\t\t\t\t\tclass=\" ml-1 text-white dark:text-gray-900 group-hover/item:text-gray-600 dark:group-hover/item:text-white transition\"\n\t\t\t\t>\n\t\t\t\t\t<!--  -->\n\t\t\t\t\t<svg\n\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\tviewBox=\"0 0 16 16\"\n\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\tclass=\"size-4\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\td=\"M4.22 11.78a.75.75 0 0 1 0-1.06L9.44 5.5H5.75a.75.75 0 0 1 0-1.5h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V6.56l-5.22 5.22a.75.75 0 0 1-1.06 0Z\"\n\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</svg>\n\t\t\t\t</div>\n\t\t\t</a>\n\t\t{/each}\n\t</div>\n</Collapsible>\n","<script lang=\"ts\">\n\texport let className = 'w-4 h-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n>\n\t<path\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t\td=\"M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456ZM16.894 20.567 16.5 21.75l-.394-1.183a2.25 2.25 0 0 0-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 0 0 1.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 0 0 1.423 1.423l1.183.394-1.183.394a2.25 2.25 0 0 0-1.423 1.423Z\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\timport Info from '$lib/components/icons/Info.svelte';\n\n\texport let content = '';\n</script>\n\n<div class=\"flex my-2 gap-2.5 border px-4 py-3 border-red-600/10 bg-red-600/10 rounded-lg\">\n\t<div class=\" self-start mt-0.5\">\n\t\t<Info className=\"size-5 text-red-700 dark:text-red-400\" />\n\t</div>\n\n\t<div class=\" self-center text-sm\">\n\t\t{typeof content === 'string' ? content : JSON.stringify(content)}\n\t</div>\n</div>\n","<script lang=\"ts\">\n\timport { getContext, onMount, tick } from 'svelte';\n\timport Modal from '$lib/components/common/Modal.svelte';\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\n\timport { WEBUI_API_BASE_URL } from '$lib/constants';\n\n\tconst i18n = getContext('i18n');\n\n\texport let show = false;\n\texport let citation;\n\texport let showPercentage = false;\n\texport let showRelevance = true;\n\n\tlet mergedDocuments = [];\n\n\tfunction calculatePercentage(distance: number) {\n\t\tif (distance < 0) return 0;\n\t\tif (distance > 1) return 100;\n\t\treturn Math.round(distance * 10000) / 100;\n\t}\n\n\tfunction getRelevanceColor(percentage: number) {\n\t\tif (percentage >= 80)\n\t\t\treturn 'bg-green-200 dark:bg-green-800 text-green-800 dark:text-green-200';\n\t\tif (percentage >= 60)\n\t\t\treturn 'bg-yellow-200 dark:bg-yellow-800 text-yellow-800 dark:text-yellow-200';\n\t\tif (percentage >= 40)\n\t\t\treturn 'bg-orange-200 dark:bg-orange-800 text-orange-800 dark:text-orange-200';\n\t\treturn 'bg-red-200 dark:bg-red-800 text-red-800 dark:text-red-200';\n\t}\n\n\t$: if (citation) {\n\t\tmergedDocuments = citation.document?.map((c, i) => {\n\t\t\treturn {\n\t\t\t\tsource: citation.source,\n\t\t\t\tdocument: c,\n\t\t\t\tmetadata: citation.metadata?.[i],\n\t\t\t\tdistance: citation.distances?.[i]\n\t\t\t};\n\t\t});\n\t\tif (mergedDocuments.every((doc) => doc.distance !== undefined)) {\n\t\t\tmergedDocuments = mergedDocuments.sort(\n\t\t\t\t(a, b) => (b.distance ?? Infinity) - (a.distance ?? Infinity)\n\t\t\t);\n\t\t}\n\t}\n</script>\n\n<Modal size=\"lg\" bind:show>\n\t<div>\n\t\t<div class=\" flex justify-between dark:text-gray-300 px-5 pt-4 pb-2\">\n\t\t\t<div class=\" text-lg font-medium self-center capitalize\">\n\t\t\t\t{$i18n.t('Citation')}\n\t\t\t</div>\n\t\t\t<button\n\t\t\t\tclass=\"self-center\"\n\t\t\t\ton:click={() => {\n\t\t\t\t\tshow = false;\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<svg\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\tclass=\"w-5 h-5\"\n\t\t\t\t>\n\t\t\t\t\t<path\n\t\t\t\t\t\td=\"M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z\"\n\t\t\t\t\t/>\n\t\t\t\t</svg>\n\t\t\t</button>\n\t\t</div>\n\n\t\t<div class=\"flex flex-col md:flex-row w-full px-6 pb-5 md:space-x-4\">\n\t\t\t<div\n\t\t\t\tclass=\"flex flex-col w-full dark:text-gray-200 overflow-y-scroll max-h-[22rem] scrollbar-hidden\"\n\t\t\t>\n\t\t\t\t{#each mergedDocuments as document, documentIdx}\n\t\t\t\t\t<div class=\"flex flex-col w-full\">\n\t\t\t\t\t\t<div class=\"text-sm font-medium dark:text-gray-300\">\n\t\t\t\t\t\t\t{$i18n.t('Source')}\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t{#if document.source?.name}\n\t\t\t\t\t\t\t<Tooltip\n\t\t\t\t\t\t\t\tclassName=\"w-fit\"\n\t\t\t\t\t\t\t\tcontent={$i18n.t('Open file')}\n\t\t\t\t\t\t\t\tplacement=\"top-start\"\n\t\t\t\t\t\t\t\ttippyOptions={{ duration: [500, 0] }}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class=\"text-sm dark:text-gray-400 flex items-center gap-2 w-fit\">\n\t\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\t\tclass=\"hover:text-gray-500 dark:hover:text-gray-100 underline grow\"\n\t\t\t\t\t\t\t\t\t\thref={document?.metadata?.file_id\n\t\t\t\t\t\t\t\t\t\t\t? `${WEBUI_API_BASE_URL}/files/${document?.metadata?.file_id}/content${document?.metadata?.page !== undefined ? `#page=${document.metadata.page + 1}` : ''}`\n\t\t\t\t\t\t\t\t\t\t\t: document.source?.url?.includes('http')\n\t\t\t\t\t\t\t\t\t\t\t\t? document.source.url\n\t\t\t\t\t\t\t\t\t\t\t\t: `#`}\n\t\t\t\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{document?.metadata?.name ?? document.source.name}\n\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t\t{#if document?.metadata?.page}\n\t\t\t\t\t\t\t\t\t\t<span class=\"text-xs text-gray-500 dark:text-gray-400\">\n\t\t\t\t\t\t\t\t\t\t\t({$i18n.t('page')}\n\t\t\t\t\t\t\t\t\t\t\t{document.metadata.page + 1})\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t{#if showRelevance}\n\t\t\t\t\t\t\t\t<div class=\"text-sm font-medium dark:text-gray-300 mt-2\">\n\t\t\t\t\t\t\t\t\t{$i18n.t('Relevance')}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{#if document.distance !== undefined}\n\t\t\t\t\t\t\t\t\t<Tooltip\n\t\t\t\t\t\t\t\t\t\tclassName=\"w-fit\"\n\t\t\t\t\t\t\t\t\t\tcontent={$i18n.t('Semantic distance to query')}\n\t\t\t\t\t\t\t\t\t\tplacement=\"top-start\"\n\t\t\t\t\t\t\t\t\t\ttippyOptions={{ duration: [500, 0] }}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<div class=\"text-sm my-1 dark:text-gray-400 flex items-center gap-2 w-fit\">\n\t\t\t\t\t\t\t\t\t\t\t{#if showPercentage}\n\t\t\t\t\t\t\t\t\t\t\t\t{@const percentage = calculatePercentage(document.distance)}\n\t\t\t\t\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass={`px-1 rounded-sm font-medium ${getRelevanceColor(percentage)}`}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{percentage.toFixed(2)}%\n\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-gray-500 dark:text-gray-500\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t({document.distance.toFixed(4)})\n\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-gray-500 dark:text-gray-500\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{document.distance.toFixed(4)}\n\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t<div class=\"text-sm dark:text-gray-400\">\n\t\t\t\t\t\t\t\t\t\t{$i18n.t('No distance available')}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t<div class=\"text-sm dark:text-gray-400\">\n\t\t\t\t\t\t\t\t{$i18n.t('No source available')}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"flex flex-col w-full\">\n\t\t\t\t\t\t<div class=\" text-sm font-medium dark:text-gray-300 mt-2\">\n\t\t\t\t\t\t\t{$i18n.t('Content')}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{#if document.metadata?.html}\n\t\t\t\t\t\t\t<iframe\n\t\t\t\t\t\t\t\tclass=\"w-full border-0 h-auto rounded-none\"\n\t\t\t\t\t\t\t\tsandbox=\"allow-scripts allow-forms allow-same-origin\"\n\t\t\t\t\t\t\t\tsrcdoc={document.document}\n\t\t\t\t\t\t\t\ttitle={$i18n.t('Content')}\n\t\t\t\t\t\t\t></iframe>\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t<pre class=\"text-sm dark:text-gray-400 whitespace-pre-line\">\n                {document.document}\n              </pre>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{#if documentIdx !== mergedDocuments.length - 1}\n\t\t\t\t\t\t<hr class=\"border-gray-100 dark:border-gray-850 my-3\" />\n\t\t\t\t\t{/if}\n\t\t\t\t{/each}\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</Modal>\n","<script lang=\"ts\">\n\timport { getContext } from 'svelte';\n\timport CitationsModal from './CitationsModal.svelte';\n\timport Collapsible from '$lib/components/common/Collapsible.svelte';\n\timport ChevronDown from '$lib/components/icons/ChevronDown.svelte';\n\timport ChevronUp from '$lib/components/icons/ChevronUp.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let id = '';\n\texport let sources = [];\n\n\tlet citations = [];\n\tlet showPercentage = false;\n\tlet showRelevance = true;\n\n\tlet showCitationModal = false;\n\tlet selectedCitation: any = null;\n\tlet isCollapsibleOpen = false;\n\n\tfunction calculateShowRelevance(sources: any[]) {\n\t\tconst distances = sources.flatMap((citation) => citation.distances ?? []);\n\t\tconst inRange = distances.filter((d) => d !== undefined && d >= -1 && d <= 1).length;\n\t\tconst outOfRange = distances.filter((d) => d !== undefined && (d < -1 || d > 1)).length;\n\n\t\tif (distances.length === 0) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (\n\t\t\t(inRange === distances.length - 1 && outOfRange === 1) ||\n\t\t\t(outOfRange === distances.length - 1 && inRange === 1)\n\t\t) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tfunction shouldShowPercentage(sources: any[]) {\n\t\tconst distances = sources.flatMap((citation) => citation.distances ?? []);\n\t\treturn distances.every((d) => d !== undefined && d >= -1 && d <= 1);\n\t}\n\n\t$: {\n\t\tconsole.log('sources', sources);\n\t\tcitations = sources.reduce((acc, source) => {\n\t\t\tif (Object.keys(source).length === 0) {\n\t\t\t\treturn acc;\n\t\t\t}\n\n\t\t\tsource.document.forEach((document, index) => {\n\t\t\t\tconst metadata = source.metadata?.[index];\n\t\t\t\tconst distance = source.distances?.[index];\n\n\t\t\t\t// Within the same citation there could be multiple documents\n\t\t\t\tconst id = metadata?.source ?? source?.source?.id ?? 'N/A';\n\t\t\t\tlet _source = source?.source;\n\n\t\t\t\tif (metadata?.name) {\n\t\t\t\t\t_source = { ..._source, name: metadata.name };\n\t\t\t\t}\n\n\t\t\t\tif (id.startsWith('http://') || id.startsWith('https://')) {\n\t\t\t\t\t_source = { ..._source, name: id, url: id };\n\t\t\t\t}\n\n\t\t\t\tconst existingSource = acc.find((item) => item.id === id);\n\n\t\t\t\tif (existingSource) {\n\t\t\t\t\texistingSource.document.push(document);\n\t\t\t\t\texistingSource.metadata.push(metadata);\n\t\t\t\t\tif (distance !== undefined) existingSource.distances.push(distance);\n\t\t\t\t} else {\n\t\t\t\t\tacc.push({\n\t\t\t\t\t\tid: id,\n\t\t\t\t\t\tsource: _source,\n\t\t\t\t\t\tdocument: [document],\n\t\t\t\t\t\tmetadata: metadata ? [metadata] : [],\n\t\t\t\t\t\tdistances: distance !== undefined ? [distance] : undefined\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn acc;\n\t\t}, []);\n\n\t\tshowRelevance = calculateShowRelevance(citations);\n\t\tshowPercentage = shouldShowPercentage(citations);\n\t}\n</script>\n\n<CitationsModal\n\tbind:show={showCitationModal}\n\tcitation={selectedCitation}\n\t{showPercentage}\n\t{showRelevance}\n/>\n\n{#if citations.length > 0}\n\t<div class=\" py-0.5 -mx-0.5 w-full flex gap-1 items-center flex-wrap\">\n\t\t{#if citations.length <= 3}\n\t\t\t<div class=\"flex text-xs font-medium flex-wrap\">\n\t\t\t\t{#each citations as citation, idx}\n\t\t\t\t\t<button\n\t\t\t\t\t\tid={`source-${id}-${idx}`}\n\t\t\t\t\t\tclass=\"no-toggle outline-hidden flex dark:text-gray-300 p-1 bg-white dark:bg-gray-900 rounded-xl max-w-96\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\tshowCitationModal = true;\n\t\t\t\t\t\t\tselectedCitation = citation;\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t{#if citations.every((c) => c.distances !== undefined)}\n\t\t\t\t\t\t\t<div class=\"bg-gray-50 dark:bg-gray-800 rounded-full size-4\">\n\t\t\t\t\t\t\t\t{idx + 1}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\"flex-1 mx-1 truncate text-black/60 hover:text-black dark:text-white/60 dark:hover:text-white transition\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{citation.source.name}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</button>\n\t\t\t\t{/each}\n\t\t\t</div>\n\t\t{:else}\n\t\t\t<Collapsible\n\t\t\t\tid=\"collapsible-sources\"\n\t\t\t\tbind:open={isCollapsibleOpen}\n\t\t\t\tclassName=\"w-full max-w-full \"\n\t\t\t\tbuttonClassName=\"w-fit max-w-full\"\n\t\t\t>\n\t\t\t\t<div\n\t\t\t\t\tclass=\"flex w-full overflow-auto items-center gap-2 text-gray-500 hover:text-gray-600 dark:hover:text-gray-400 transition cursor-pointer\"\n\t\t\t\t>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"flex-1 flex items-center gap-1 overflow-auto scrollbar-none w-full max-w-full\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span class=\"whitespace-nowrap hidden sm:inline shrink-0\"\n\t\t\t\t\t\t\t>{$i18n.t('References from')}</span\n\t\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"flex items-center overflow-auto scrollbar-none w-full max-w-full flex-1\">\n\t\t\t\t\t\t\t<div class=\"flex text-xs font-medium items-center\">\n\t\t\t\t\t\t\t\t{#each citations.slice(0, 2) as citation, idx}\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\tclass=\"no-toggle outline-hidden flex dark:text-gray-300 p-1 bg-gray-50 hover:bg-gray-100 dark:bg-gray-900 dark:hover:bg-gray-850 transition rounded-xl max-w-96\"\n\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\tshowCitationModal = true;\n\t\t\t\t\t\t\t\t\t\t\tselectedCitation = citation;\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\ton:pointerup={(e) => {\n\t\t\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{#if citations.every((c) => c.distances !== undefined)}\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"bg-gray-50 dark:bg-gray-800 rounded-full size-4\">\n\t\t\t\t\t\t\t\t\t\t\t\t{idx + 1}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t<div class=\"flex-1 mx-1 truncate\">\n\t\t\t\t\t\t\t\t\t\t\t{citation.source.name}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"flex items-center gap-1 whitespace-nowrap shrink-0\">\n\t\t\t\t\t\t\t<span class=\"hidden sm:inline\">{$i18n.t('and')}</span>\n\t\t\t\t\t\t\t{citations.length - 2}\n\t\t\t\t\t\t\t<span>{$i18n.t('more')}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"shrink-0\">\n\t\t\t\t\t\t{#if isCollapsibleOpen}\n\t\t\t\t\t\t\t<ChevronUp strokeWidth=\"3.5\" className=\"size-3.5\" />\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t<ChevronDown strokeWidth=\"3.5\" className=\"size-3.5\" />\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div slot=\"content\">\n\t\t\t\t\t<div class=\"flex text-xs font-medium flex-wrap\">\n\t\t\t\t\t\t{#each citations as citation, idx}\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tid={`source-${id}-${idx}`}\n\t\t\t\t\t\t\t\tclass=\"no-toggle outline-hidden flex dark:text-gray-300 p-1 bg-gray-50 hover:bg-gray-100 dark:bg-gray-900 dark:hover:bg-gray-850 transition rounded-xl max-w-96\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\tshowCitationModal = true;\n\t\t\t\t\t\t\t\t\tselectedCitation = citation;\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{#if citations.every((c) => c.distances !== undefined)}\n\t\t\t\t\t\t\t\t\t<div class=\"bg-gray-50 dark:bg-gray-800 rounded-full size-4\">\n\t\t\t\t\t\t\t\t\t\t{idx + 1}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t<div class=\"flex-1 mx-1 truncate\">\n\t\t\t\t\t\t\t\t\t{citation.source.name}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t{/each}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</Collapsible>\n\t\t{/if}\n\t</div>\n{/if}\n","<script lang=\"ts\">\n\timport { getContext } from 'svelte';\n\timport CodeBlock from './CodeBlock.svelte';\n\timport Modal from '$lib/components/common/Modal.svelte';\n\timport Spinner from '$lib/components/common/Spinner.svelte';\n\timport Badge from '$lib/components/common/Badge.svelte';\n\tconst i18n = getContext('i18n');\n\n\texport let show = false;\n\texport let codeExecution = null;\n</script>\n\n<Modal size=\"lg\" bind:show>\n\t<div>\n\t\t<div class=\"flex justify-between dark:text-gray-300 px-5 pt-4 pb-2\">\n\t\t\t<div class=\"text-lg font-medium self-center flex flex-col gap-0.5 capitalize\">\n\t\t\t\t{#if codeExecution?.result}\n\t\t\t\t\t<div>\n\t\t\t\t\t\t{#if codeExecution.result?.error}\n\t\t\t\t\t\t\t<Badge type=\"error\" content=\"error\" />\n\t\t\t\t\t\t{:else if codeExecution.result?.output}\n\t\t\t\t\t\t\t<Badge type=\"success\" content=\"success\" />\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t<Badge type=\"warning\" content=\"incomplete\" />\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\n\t\t\t\t<div class=\"flex gap-2 items-center\">\n\t\t\t\t\t{#if !codeExecution?.result}\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Spinner className=\"size-4\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t<div>\n\t\t\t\t\t\t{#if codeExecution?.name}\n\t\t\t\t\t\t\t{$i18n.t('Code execution')}: {codeExecution?.name}\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t{$i18n.t('Code execution')}\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<button\n\t\t\t\tclass=\"self-center\"\n\t\t\t\ton:click={() => {\n\t\t\t\t\tshow = false;\n\t\t\t\t\tcodeExecution = null;\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<svg\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\tclass=\"w-5 h-5\"\n\t\t\t\t>\n\t\t\t\t\t<path\n\t\t\t\t\t\td=\"M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z\"\n\t\t\t\t\t/>\n\t\t\t\t</svg>\n\t\t\t</button>\n\t\t</div>\n\n\t\t<div class=\"flex flex-col md:flex-row w-full px-4 pb-5\">\n\t\t\t<div\n\t\t\t\tclass=\"flex flex-col w-full dark:text-gray-200 overflow-y-scroll max-h-[22rem] scrollbar-hidden\"\n\t\t\t>\n\t\t\t\t<div class=\"flex flex-col w-full\">\n\t\t\t\t\t<CodeBlock\n\t\t\t\t\t\tid=\"code-exec-{codeExecution?.id}-code\"\n\t\t\t\t\t\tlang={codeExecution?.language ?? ''}\n\t\t\t\t\t\tcode={codeExecution?.code ?? ''}\n\t\t\t\t\t\tclassName=\"\"\n\t\t\t\t\t\teditorClassName={codeExecution?.result &&\n\t\t\t\t\t\t(codeExecution?.result?.error || codeExecution?.result?.output)\n\t\t\t\t\t\t\t? 'rounded-b-none'\n\t\t\t\t\t\t\t: ''}\n\t\t\t\t\t\tstickyButtonsClassName=\"top-0\"\n\t\t\t\t\t\trun={false}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\n\t\t\t\t{#if codeExecution?.result && (codeExecution?.result?.error || codeExecution?.result?.output)}\n\t\t\t\t\t<div class=\"dark:bg-[#202123] dark:text-white px-4 py-4 rounded-b-lg flex flex-col gap-3\">\n\t\t\t\t\t\t{#if codeExecution?.result?.error}\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<div class=\" text-gray-500 text-xs mb-1\">{$i18n.t('ERROR')}</div>\n\t\t\t\t\t\t\t\t<div class=\"text-sm\">{codeExecution?.result?.error}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t{#if codeExecution?.result?.output}\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<div class=\" text-gray-500 text-xs mb-1\">{$i18n.t('OUTPUT')}</div>\n\t\t\t\t\t\t\t\t<div class=\"text-sm\">{codeExecution?.result?.output}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\t\t\t\t{#if codeExecution?.result?.files && codeExecution?.result?.files.length > 0}\n\t\t\t\t\t<div class=\"flex flex-col w-full\">\n\t\t\t\t\t\t<hr class=\"border-gray-100 dark:border-gray-850 my-2\" />\n\t\t\t\t\t\t<div class=\" text-sm font-medium dark:text-gray-300\">\n\t\t\t\t\t\t\t{$i18n.t('Files')}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<ul class=\"mt-1 list-disc pl-4 text-xs\">\n\t\t\t\t\t\t\t{#each codeExecution?.result?.files as file}\n\t\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t\t<a href={file.url} target=\"_blank\">{file.name}</a>\n\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</Modal>\n","<script lang=\"ts\">\n\timport CodeExecutionModal from './CodeExecutionModal.svelte';\n\timport Spinner from '$lib/components/common/Spinner.svelte';\n\timport Check from '$lib/components/icons/Check.svelte';\n\timport XMark from '$lib/components/icons/XMark.svelte';\n\timport EllipsisHorizontal from '$lib/components/icons/EllipsisHorizontal.svelte';\n\n\texport let codeExecutions = [];\n\n\tlet selectedCodeExecution = null;\n\tlet showCodeExecutionModal = false;\n\n\t$: if (codeExecutions) {\n\t\tupdateSelectedCodeExecution();\n\t}\n\n\tconst updateSelectedCodeExecution = () => {\n\t\tif (selectedCodeExecution) {\n\t\t\tselectedCodeExecution = codeExecutions.find(\n\t\t\t\t(execution) => execution.id === selectedCodeExecution.id\n\t\t\t);\n\t\t}\n\t};\n</script>\n\n<CodeExecutionModal bind:show={showCodeExecutionModal} codeExecution={selectedCodeExecution} />\n\n{#if codeExecutions.length > 0}\n\t<div class=\"mt-1 mb-2 w-full flex gap-1 items-center flex-wrap\">\n\t\t{#each codeExecutions as execution (execution.id)}\n\t\t\t<div class=\"flex gap-1 text-xs font-semibold\">\n\t\t\t\t<button\n\t\t\t\t\tclass=\"flex dark:text-gray-300 py-1 px-1 bg-gray-50 hover:bg-gray-100 dark:bg-gray-850 dark:hover:bg-gray-800 transition rounded-xl max-w-96\"\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\tselectedCodeExecution = execution;\n\t\t\t\t\t\tshowCodeExecutionModal = true;\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"bg-white dark:bg-gray-700 rounded-full size-4 flex items-center justify-center\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{#if execution?.result}\n\t\t\t\t\t\t\t{#if execution.result?.error}\n\t\t\t\t\t\t\t\t<XMark />\n\t\t\t\t\t\t\t{:else if execution.result?.output}\n\t\t\t\t\t\t\t\t<Check strokeWidth=\"3\" className=\"size-3\" />\n\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t<EllipsisHorizontal />\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t<Spinner className=\"size-4\" />\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"flex-1 mx-2 line-clamp-1 code-execution-name {execution?.result ? '' : 'pulse'}\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{execution.name}\n\t\t\t\t\t</div>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t{/each}\n\t</div>\n{/if}\n\n<style>\n\t@keyframes pulse {\n\t\t0%,\n\t\t100% {\n\t\t\topacity: 1;\n\t\t}\n\t\t50% {\n\t\t\topacity: 0.6;\n\t\t}\n\t}\n\n\t.pulse {\n\t\topacity: 1;\n\t\tanimation: pulse 1.5s ease;\n\t}\n</style>\n","<script lang=\"ts\">\n\texport let className = 'size-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n>\n\t<path\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t\td=\"M8.625 12a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H8.25m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H12m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0h-.375M21 12c0 4.556-4.03 8.25-9 8.25a9.764 9.764 0 0 1-2.555-.337A5.972 5.972 0 0 1 5.41 20.97a5.969 5.969 0 0 1-.474-.065 4.48 4.48 0 0 0 .978-2.025c.09-.457-.133-.901-.467-1.226C3.93 16.178 3 14.189 3 12c0-4.556 4.03-8.25 9-8.25s9 3.694 9 8.25Z\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\texport let className = 'w-4 h-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n>\n\t<path\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t\td=\"M12 18v-5.25m0 0a6.01 6.01 0 0 0 1.5-.189m-1.5.189a6.01 6.01 0 0 1-1.5-.189m3.75 7.478a12.06 12.06 0 0 1-4.5 0m3.75 2.383a14.406 14.406 0 0 1-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 1 0-7.517 0c.85.493 1.509 1.333 1.509 2.316V18\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\timport { toast } from 'svelte-sonner';\n\n\timport DOMPurify from 'dompurify';\n\timport { marked } from 'marked';\n\n\timport { getContext, tick } from 'svelte';\n\tconst i18n = getContext('i18n');\n\n\timport { chatCompletion } from '$lib/apis/openai';\n\n\timport ChatBubble from '$lib/components/icons/ChatBubble.svelte';\n\timport LightBlub from '$lib/components/icons/LightBlub.svelte';\n\timport Markdown from '../Messages/Markdown.svelte';\n\timport Skeleton from '../Messages/Skeleton.svelte';\n\n\texport let id = '';\n\texport let model = null;\n\texport let messages = [];\n\texport let onAdd = () => {};\n\n\tlet floatingInput = false;\n\n\tlet selectedText = '';\n\tlet floatingInputValue = '';\n\n\tlet prompt = '';\n\tlet responseContent = null;\n\tlet responseDone = false;\n\n\tconst autoScroll = async () => {\n\t\t// Scroll to bottom only if the scroll is at the bottom give 50px buffer\n\t\tconst responseContainer = document.getElementById('response-container');\n\t\tif (\n\t\t\tresponseContainer.scrollHeight - responseContainer.clientHeight <=\n\t\t\tresponseContainer.scrollTop + 50\n\t\t) {\n\t\t\tresponseContainer.scrollTop = responseContainer.scrollHeight;\n\t\t}\n\t};\n\n\tconst askHandler = async () => {\n\t\tif (!model) {\n\t\t\ttoast.error('Model not selected');\n\t\t\treturn;\n\t\t}\n\t\tprompt = `${floatingInputValue}\\n\\`\\`\\`\\n${selectedText}\\n\\`\\`\\``;\n\t\tfloatingInputValue = '';\n\n\t\tresponseContent = '';\n\t\tconst [res, controller] = await chatCompletion(localStorage.token, {\n\t\t\tmodel: model,\n\t\t\tmessages: [\n\t\t\t\t...messages,\n\t\t\t\t{\n\t\t\t\t\trole: 'user',\n\t\t\t\t\tcontent: prompt\n\t\t\t\t}\n\t\t\t].map((message) => ({\n\t\t\t\trole: message.role,\n\t\t\t\tcontent: message.content\n\t\t\t})),\n\t\t\tstream: true // Enable streaming\n\t\t});\n\n\t\tif (res && res.ok) {\n\t\t\tconst reader = res.body.getReader();\n\t\t\tconst decoder = new TextDecoder();\n\n\t\t\tconst processStream = async () => {\n\t\t\t\twhile (true) {\n\t\t\t\t\t// Read data chunks from the response stream\n\t\t\t\t\tconst { done, value } = await reader.read();\n\t\t\t\t\tif (done) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Decode the received chunk\n\t\t\t\t\tconst chunk = decoder.decode(value, { stream: true });\n\n\t\t\t\t\t// Process lines within the chunk\n\t\t\t\t\tconst lines = chunk.split('\\n').filter((line) => line.trim() !== '');\n\n\t\t\t\t\tfor (const line of lines) {\n\t\t\t\t\t\tif (line.startsWith('data: ')) {\n\t\t\t\t\t\t\tif (line.startsWith('data: [DONE]')) {\n\t\t\t\t\t\t\t\tresponseDone = true;\n\n\t\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\t\tautoScroll();\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// Parse the JSON chunk\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\tconst data = JSON.parse(line.slice(6));\n\n\t\t\t\t\t\t\t\t\t// Append the `content` field from the \"choices\" object\n\t\t\t\t\t\t\t\t\tif (data.choices && data.choices[0]?.delta?.content) {\n\t\t\t\t\t\t\t\t\t\tresponseContent += data.choices[0].delta.content;\n\n\t\t\t\t\t\t\t\t\t\tautoScroll();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\t\t\tconsole.error(e);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\t// Process the stream in the background\n\t\t\tawait processStream();\n\t\t} else {\n\t\t\ttoast.error('An error occurred while fetching the explanation');\n\t\t}\n\t};\n\n\tconst explainHandler = async () => {\n\t\tif (!model) {\n\t\t\ttoast.error('Model not selected');\n\t\t\treturn;\n\t\t}\n\t\tprompt = `Explain this section to me in more detail\\n\\n\\`\\`\\`\\n${selectedText}\\n\\`\\`\\``;\n\n\t\tresponseContent = '';\n\t\tconst [res, controller] = await chatCompletion(localStorage.token, {\n\t\t\tmodel: model,\n\t\t\tmessages: [\n\t\t\t\t...messages,\n\t\t\t\t{\n\t\t\t\t\trole: 'user',\n\t\t\t\t\tcontent: prompt\n\t\t\t\t}\n\t\t\t].map((message) => ({\n\t\t\t\trole: message.role,\n\t\t\t\tcontent: message.content\n\t\t\t})),\n\t\t\tstream: true // Enable streaming\n\t\t});\n\n\t\tif (res && res.ok) {\n\t\t\tconst reader = res.body.getReader();\n\t\t\tconst decoder = new TextDecoder();\n\n\t\t\tconst processStream = async () => {\n\t\t\t\twhile (true) {\n\t\t\t\t\t// Read data chunks from the response stream\n\t\t\t\t\tconst { done, value } = await reader.read();\n\t\t\t\t\tif (done) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Decode the received chunk\n\t\t\t\t\tconst chunk = decoder.decode(value, { stream: true });\n\n\t\t\t\t\t// Process lines within the chunk\n\t\t\t\t\tconst lines = chunk.split('\\n').filter((line) => line.trim() !== '');\n\n\t\t\t\t\tfor (const line of lines) {\n\t\t\t\t\t\tif (line.startsWith('data: ')) {\n\t\t\t\t\t\t\tif (line.startsWith('data: [DONE]')) {\n\t\t\t\t\t\t\t\tresponseDone = true;\n\n\t\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\t\tautoScroll();\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// Parse the JSON chunk\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\tconst data = JSON.parse(line.slice(6));\n\n\t\t\t\t\t\t\t\t\t// Append the `content` field from the \"choices\" object\n\t\t\t\t\t\t\t\t\tif (data.choices && data.choices[0]?.delta?.content) {\n\t\t\t\t\t\t\t\t\t\tresponseContent += data.choices[0].delta.content;\n\n\t\t\t\t\t\t\t\t\t\tautoScroll();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\t\t\tconsole.error(e);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\t// Process the stream in the background\n\t\t\tawait processStream();\n\t\t} else {\n\t\t\ttoast.error('An error occurred while fetching the explanation');\n\t\t}\n\t};\n\n\tconst addHandler = async () => {\n\t\tconst messages = [\n\t\t\t{\n\t\t\t\trole: 'user',\n\t\t\t\tcontent: prompt\n\t\t\t},\n\t\t\t{\n\t\t\t\trole: 'assistant',\n\t\t\t\tcontent: responseContent\n\t\t\t}\n\t\t];\n\n\t\tonAdd({\n\t\t\tmodelId: model,\n\t\t\tparentId: id,\n\t\t\tmessages: messages\n\t\t});\n\t};\n\n\texport const closeHandler = () => {\n\t\tresponseContent = null;\n\t\tresponseDone = false;\n\t\tfloatingInput = false;\n\t\tfloatingInputValue = '';\n\t};\n</script>\n\n<div\n\tid={`floating-buttons-${id}`}\n\tclass=\"absolute rounded-lg mt-1 text-xs z-9999\"\n\tstyle=\"display: none\"\n>\n\t{#if responseContent === null}\n\t\t{#if !floatingInput}\n\t\t\t<div\n\t\t\t\tclass=\"flex flex-row gap-0.5 shrink-0 p-1 bg-white dark:bg-gray-850 dark:text-gray-100 text-medium rounded-lg shadow-xl\"\n\t\t\t>\n\t\t\t\t<button\n\t\t\t\t\tclass=\"px-1 hover:bg-gray-50 dark:hover:bg-gray-800 rounded-sm flex items-center gap-1 min-w-fit\"\n\t\t\t\t\ton:click={async () => {\n\t\t\t\t\t\tselectedText = window.getSelection().toString();\n\t\t\t\t\t\tfloatingInput = true;\n\n\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\tconst input = document.getElementById('floating-message-input');\n\t\t\t\t\t\t\tif (input) {\n\t\t\t\t\t\t\t\tinput.focus();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, 0);\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<ChatBubble className=\"size-3 shrink-0\" />\n\n\t\t\t\t\t<div class=\"shrink-0\">Ask</div>\n\t\t\t\t</button>\n\t\t\t\t<button\n\t\t\t\t\tclass=\"px-1 hover:bg-gray-50 dark:hover:bg-gray-800 rounded-sm flex items-center gap-1 min-w-fit\"\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\tselectedText = window.getSelection().toString();\n\t\t\t\t\t\texplainHandler();\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<LightBlub className=\"size-3 shrink-0\" />\n\n\t\t\t\t\t<div class=\"shrink-0\">Explain</div>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t{:else}\n\t\t\t<div\n\t\t\t\tclass=\"py-1 flex dark:text-gray-100 bg-gray-50 dark:bg-gray-800 border dark:border-gray-850 w-72 rounded-full shadow-xl\"\n\t\t\t>\n\t\t\t\t<input\n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\tid=\"floating-message-input\"\n\t\t\t\t\tclass=\"ml-5 bg-transparent outline-hidden w-full flex-1 text-sm\"\n\t\t\t\t\tplaceholder={$i18n.t('Ask a question')}\n\t\t\t\t\tbind:value={floatingInputValue}\n\t\t\t\t\ton:keydown={(e) => {\n\t\t\t\t\t\tif (e.key === 'Enter') {\n\t\t\t\t\t\t\taskHandler();\n\t\t\t\t\t\t}\n\t\t\t\t\t}}\n\t\t\t\t/>\n\n\t\t\t\t<div class=\"ml-1 mr-2\">\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"{floatingInputValue !== ''\n\t\t\t\t\t\t\t? 'bg-black text-white hover:bg-gray-900 dark:bg-white dark:text-black dark:hover:bg-gray-100 '\n\t\t\t\t\t\t\t: 'text-white bg-gray-200 dark:text-gray-900 dark:bg-gray-700 disabled'} transition rounded-full p-1.5 m-0.5 self-center\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\taskHandler();\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\tviewBox=\"0 0 16 16\"\n\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\tclass=\"size-4\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\td=\"M8 14a.75.75 0 0 1-.75-.75V4.56L4.03 7.78a.75.75 0 0 1-1.06-1.06l4.5-4.5a.75.75 0 0 1 1.06 0l4.5 4.5a.75.75 0 0 1-1.06 1.06L8.75 4.56v8.69A.75.75 0 0 1 8 14Z\"\n\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{/if}\n\t{:else}\n\t\t<div class=\"bg-white dark:bg-gray-850 dark:text-gray-100 rounded-xl shadow-xl w-80 max-w-full\">\n\t\t\t<div\n\t\t\t\tclass=\"bg-gray-50/50 dark:bg-gray-800 dark:text-gray-100 text-medium rounded-xl px-3.5 py-3 w-full\"\n\t\t\t>\n\t\t\t\t<div class=\"font-medium\">\n\t\t\t\t\t<Markdown id={`${id}-float-prompt`} content={prompt} />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div\n\t\t\t\tclass=\"bg-white dark:bg-gray-850 dark:text-gray-100 text-medium rounded-xl px-3.5 py-3 w-full\"\n\t\t\t>\n\t\t\t\t<div class=\" max-h-80 overflow-y-auto w-full markdown-prose-xs\" id=\"response-container\">\n\t\t\t\t\t{#if responseContent.trim() === ''}\n\t\t\t\t\t\t<Skeleton size=\"sm\" />\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<Markdown id={`${id}-float-response`} content={responseContent} />\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t{#if responseDone}\n\t\t\t\t\t\t<div class=\"flex justify-end pt-3 text-sm font-medium\">\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"px-3.5 py-1.5 text-sm font-medium bg-black hover:bg-gray-900 text-white dark:bg-white dark:text-black dark:hover:bg-gray-100 transition rounded-full\"\n\t\t\t\t\t\t\t\ton:click={addHandler}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{$i18n.t('Add')}\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t{/if}\n</div>\n","<script>\n\timport { onDestroy, onMount, tick, getContext, createEventDispatcher } from 'svelte';\n\tconst i18n = getContext('i18n');\n\tconst dispatch = createEventDispatcher();\n\n\timport Markdown from './Markdown.svelte';\n\timport { chatId, mobile, showArtifacts, showControls, showOverview } from '$lib/stores';\n\timport FloatingButtons from '../ContentRenderer/FloatingButtons.svelte';\n\timport { createMessagesList } from '$lib/utils';\n\n\texport let id;\n\texport let content;\n\texport let history;\n\texport let model = null;\n\texport let sources = null;\n\n\texport let save = false;\n\texport let floatingButtons = true;\n\n\texport let onSourceClick = () => {};\n\texport let onTaskClick = () => {};\n\n\texport let onAddMessages = () => {};\n\n\tlet contentContainerElement;\n\n\tlet floatingButtonsElement;\n\n\tconst updateButtonPosition = (event) => {\n\t\tconst buttonsContainerElement = document.getElementById(`floating-buttons-${id}`);\n\t\tif (\n\t\t\t!contentContainerElement?.contains(event.target) &&\n\t\t\t!buttonsContainerElement?.contains(event.target)\n\t\t) {\n\t\t\tcloseFloatingButtons();\n\t\t\treturn;\n\t\t}\n\n\t\tsetTimeout(async () => {\n\t\t\tawait tick();\n\n\t\t\tif (!contentContainerElement?.contains(event.target)) return;\n\n\t\t\tlet selection = window.getSelection();\n\n\t\t\tif (selection.toString().trim().length > 0) {\n\t\t\t\tconst range = selection.getRangeAt(0);\n\t\t\t\tconst rect = range.getBoundingClientRect();\n\n\t\t\t\tconst parentRect = contentContainerElement.getBoundingClientRect();\n\n\t\t\t\t// Adjust based on parent rect\n\t\t\t\tconst top = rect.bottom - parentRect.top;\n\t\t\t\tconst left = rect.left - parentRect.left;\n\n\t\t\t\tif (buttonsContainerElement) {\n\t\t\t\t\tbuttonsContainerElement.style.display = 'block';\n\n\t\t\t\t\t// Calculate space available on the right\n\t\t\t\t\tconst spaceOnRight = parentRect.width - left;\n\t\t\t\t\tlet halfScreenWidth = $mobile ? window.innerWidth / 2 : window.innerWidth / 3;\n\n\t\t\t\t\tif (spaceOnRight < halfScreenWidth) {\n\t\t\t\t\t\tconst right = parentRect.right - rect.right;\n\t\t\t\t\t\tbuttonsContainerElement.style.right = `${right}px`;\n\t\t\t\t\t\tbuttonsContainerElement.style.left = 'auto'; // Reset left\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Enough space, position using 'left'\n\t\t\t\t\t\tbuttonsContainerElement.style.left = `${left}px`;\n\t\t\t\t\t\tbuttonsContainerElement.style.right = 'auto'; // Reset right\n\t\t\t\t\t}\n\t\t\t\t\tbuttonsContainerElement.style.top = `${top + 5}px`; // +5 to add some spacing\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tcloseFloatingButtons();\n\t\t\t}\n\t\t}, 0);\n\t};\n\n\tconst closeFloatingButtons = () => {\n\t\tconst buttonsContainerElement = document.getElementById(`floating-buttons-${id}`);\n\t\tif (buttonsContainerElement) {\n\t\t\tbuttonsContainerElement.style.display = 'none';\n\t\t}\n\n\t\tif (floatingButtonsElement) {\n\t\t\tfloatingButtonsElement.closeHandler();\n\t\t}\n\t};\n\n\tconst keydownHandler = (e) => {\n\t\tif (e.key === 'Escape') {\n\t\t\tcloseFloatingButtons();\n\t\t}\n\t};\n\n\tonMount(() => {\n\t\tif (floatingButtons) {\n\t\t\tcontentContainerElement?.addEventListener('mouseup', updateButtonPosition);\n\t\t\tdocument.addEventListener('mouseup', updateButtonPosition);\n\t\t\tdocument.addEventListener('keydown', keydownHandler);\n\t\t}\n\t});\n\n\tonDestroy(() => {\n\t\tif (floatingButtons) {\n\t\t\tcontentContainerElement?.removeEventListener('mouseup', updateButtonPosition);\n\t\t\tdocument.removeEventListener('mouseup', updateButtonPosition);\n\t\t\tdocument.removeEventListener('keydown', keydownHandler);\n\t\t}\n\t});\n</script>\n\n<div bind:this={contentContainerElement}>\n\t<Markdown\n\t\t{id}\n\t\t{content}\n\t\t{model}\n\t\t{save}\n\t\tsourceIds={(sources ?? []).reduce((acc, s) => {\n\t\t\tlet ids = [];\n\t\t\ts.document.forEach((document, index) => {\n\t\t\t\tif (model?.info?.meta?.capabilities?.citations == false) {\n\t\t\t\t\tids.push('N/A');\n\t\t\t\t\treturn ids;\n\t\t\t\t}\n\n\t\t\t\tconst metadata = s.metadata?.[index];\n\t\t\t\tconst id = metadata?.source ?? 'N/A';\n\n\t\t\t\tif (metadata?.name) {\n\t\t\t\t\tids.push(metadata.name);\n\t\t\t\t\treturn ids;\n\t\t\t\t}\n\n\t\t\t\tif (id.startsWith('http://') || id.startsWith('https://')) {\n\t\t\t\t\tids.push(id);\n\t\t\t\t} else {\n\t\t\t\t\tids.push(s?.source?.name ?? id);\n\t\t\t\t}\n\n\t\t\t\treturn ids;\n\t\t\t});\n\n\t\t\tacc = [...acc, ...ids];\n\n\t\t\t// remove duplicates\n\t\t\treturn acc.filter((item, index) => acc.indexOf(item) === index);\n\t\t}, [])}\n\t\t{onSourceClick}\n\t\t{onTaskClick}\n\t\ton:update={(e) => {\n\t\t\tdispatch('update', e.detail);\n\t\t}}\n\t\ton:code={(e) => {\n\t\t\tconst { lang, code } = e.detail;\n\n\t\t\tif (\n\t\t\t\t(['html', 'svg'].includes(lang) || (lang === 'xml' && code.includes('svg'))) &&\n\t\t\t\t!$mobile &&\n\t\t\t\t$chatId\n\t\t\t) {\n\t\t\t\tshowArtifacts.set(true);\n\t\t\t\tshowControls.set(true);\n\t\t\t}\n\t\t}}\n\t/>\n</div>\n\n{#if floatingButtons && model}\n\t<FloatingButtons\n\t\tbind:this={floatingButtonsElement}\n\t\t{id}\n\t\tmodel={model?.id}\n\t\tmessages={createMessagesList(history, id)}\n\t\tonAdd={({ modelId, parentId, messages }) => {\n\t\t\tconsole.log(modelId, parentId, messages);\n\t\t\tonAddMessages({ modelId, parentId, messages });\n\t\t\tcloseFloatingButtons();\n\t\t}}\n\t/>\n{/if}\n","<script lang=\"ts\">\n\timport { toast } from 'svelte-sonner';\n\timport dayjs from 'dayjs';\n\n\timport { createEventDispatcher } from 'svelte';\n\timport { onMount, tick, getContext } from 'svelte';\n\timport type { Writable } from 'svelte/store';\n\timport type { i18n as i18nType } from 'i18next';\n\n\tconst i18n = getContext<Writable<i18nType>>('i18n');\n\n\tconst dispatch = createEventDispatcher();\n\n\timport { createNewFeedback, getFeedbackById, updateFeedbackById } from '$lib/apis/evaluations';\n\timport { getChatById } from '$lib/apis/chats';\n\timport { generateTags } from '$lib/apis';\n\n\timport { config, models, settings, temporaryChatEnabled, TTSWorker, user } from '$lib/stores';\n\timport { synthesizeOpenAISpeech } from '$lib/apis/audio';\n\timport { imageGenerations } from '$lib/apis/images';\n\timport {\n\t\tcopyToClipboard as _copyToClipboard,\n\t\tapproximateToHumanReadable,\n\t\tgetMessageContentParts,\n\t\tsanitizeResponseContent,\n\t\tcreateMessagesList,\n\t\tformatDate\n\t} from '$lib/utils';\n\timport { WEBUI_BASE_URL } from '$lib/constants';\n\n\timport Name from './Name.svelte';\n\timport ProfileImage from './ProfileImage.svelte';\n\timport Skeleton from './Skeleton.svelte';\n\timport Image from '$lib/components/common/Image.svelte';\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\n\timport RateComment from './RateComment.svelte';\n\timport Spinner from '$lib/components/common/Spinner.svelte';\n\timport WebSearchResults from './ResponseMessage/WebSearchResults.svelte';\n\timport Sparkles from '$lib/components/icons/Sparkles.svelte';\n\n\timport DeleteConfirmDialog from '$lib/components/common/ConfirmDialog.svelte';\n\n\timport Error from './Error.svelte';\n\timport Citations from './Citations.svelte';\n\timport CodeExecutions from './CodeExecutions.svelte';\n\timport ContentRenderer from './ContentRenderer.svelte';\n\timport { KokoroWorker } from '$lib/workers/KokoroWorker';\n\n\t// Add new imports for table rendering\n\timport Table from '$lib/components/common/Table.svelte';\n\n\tinterface MessageType {\n\t\tid: string;\n\t\tmodel: string;\n\t\tcontent: string;\n\t\tfiles?: { type: string; url: string }[];\n\t\ttimestamp: number;\n\t\trole: string;\n\t\tstatusHistory?: {\n\t\t\tdone: boolean;\n\t\t\taction: string;\n\t\t\tdescription: string;\n\t\t\turls?: string[];\n\t\t\tquery?: string;\n\t\t}[];\n\t\tstatus?: {\n\t\t\tdone: boolean;\n\t\t\taction: string;\n\t\t\tdescription: string;\n\t\t\turls?: string[];\n\t\t\tquery?: string;\n\t\t};\n\t\tdone: boolean;\n\t\terror?: boolean | { content: string };\n\t\tsources?: string[];\n\t\tcode_executions?: {\n\t\t\tuuid: string;\n\t\t\tname: string;\n\t\t\tcode: string;\n\t\t\tlanguage?: string;\n\t\t\tresult?: {\n\t\t\t\terror?: string;\n\t\t\t\toutput?: string;\n\t\t\t\tfiles?: { name: string; url: string }[];\n\t\t\t};\n\t\t}[];\n\t\tinfo?: {\n\t\t\topenai?: boolean;\n\t\t\tprompt_tokens?: number;\n\t\t\tcompletion_tokens?: number;\n\t\t\ttotal_tokens?: number;\n\t\t\teval_count?: number;\n\t\t\teval_duration?: number;\n\t\t\tprompt_eval_count?: number;\n\t\t\tprompt_eval_duration?: number;\n\t\t\ttotal_duration?: number;\n\t\t\tload_duration?: number;\n\t\t\tusage?: unknown;\n\t\t};\n\t\tannotation?: { type: string; rating: number };\n\t\tisLoading?: boolean;\n\t}\n\n\texport let chatId = '';\n\texport let history;\n\texport let messageId;\n\n\texport let message: MessageType = JSON.parse(JSON.stringify(history.messages[messageId]));\n\t$: if (history.messages) {\n\t\tif (JSON.stringify(message) !== JSON.stringify(history.messages[messageId])) {\n\t\t\tconsole.log(' ResponseMessage updated for message:', messageId);\n\t\t\tmessage = JSON.parse(JSON.stringify(history.messages[messageId]));\n\t\t}\n\t}\n\n\texport let siblings;\n\n\texport let showPreviousMessage: Function;\n\texport let showNextMessage: Function;\n\n\texport let updateChat: Function;\n\texport let editMessage: Function;\n\texport let saveMessage: Function;\n\texport let rateMessage: Function;\n\texport let actionMessage: Function;\n\texport let deleteMessage: Function;\n\n\texport let submitMessage: Function;\n\texport let continueResponse: Function;\n\texport let regenerateResponse: Function;\n\n\texport let addMessages: Function;\n\n\texport let isLastMessage = true;\n\texport let readOnly = false;\n\n\tlet buttonsContainerElement: HTMLDivElement;\n\tlet showDeleteConfirm = false;\n\n\tlet model = null;\n\t$: model = $models.find((m) => m.id === message.model);\n\n\tlet edit = false;\n\tlet editedContent = '';\n\tlet editTextAreaElement: HTMLTextAreaElement;\n\n\tlet audioParts: Record<number, HTMLAudioElement | null> = {};\n\tlet speaking = false;\n\tlet speakingIdx: number | undefined;\n\n\tlet loadingSpeech = false;\n\tlet generatingImage = false;\n\n\tlet showRateComment = false;\n\n\tconst copyToClipboard = async (text) => {\n\t\tconst res = await _copyToClipboard(text);\n\t\tif (res) {\n\t\t\ttoast.success($i18n.t('Copying to clipboard was successful!'));\n\t\t}\n\t};\n\n\tconst playAudio = (idx: number) => {\n\t\treturn new Promise<void>((res) => {\n\t\t\tspeakingIdx = idx;\n\t\t\tconst audio = audioParts[idx];\n\n\t\t\tif (!audio) {\n\t\t\t\treturn res();\n\t\t\t}\n\n\t\t\taudio.play();\n\t\t\taudio.onended = async () => {\n\t\t\t\tawait new Promise((r) => setTimeout(r, 300));\n\n\t\t\t\tif (Object.keys(audioParts).length - 1 === idx) {\n\t\t\t\t\tspeaking = false;\n\t\t\t\t}\n\n\t\t\t\tres();\n\t\t\t};\n\t\t});\n\t};\n\n\tconst toggleSpeakMessage = async () => {\n\t\tif (speaking) {\n\t\t\ttry {\n\t\t\t\tspeechSynthesis.cancel();\n\n\t\t\t\tif (speakingIdx !== undefined && audioParts[speakingIdx]) {\n\t\t\t\t\taudioParts[speakingIdx]!.pause();\n\t\t\t\t\taudioParts[speakingIdx]!.currentTime = 0;\n\t\t\t\t}\n\t\t\t} catch {}\n\n\t\t\tspeaking = false;\n\t\t\tspeakingIdx = undefined;\n\t\t\treturn;\n\t\t}\n\n\t\tif (!(message?.content ?? '').trim().length) {\n\t\t\ttoast.info($i18n.t('No content to speak'));\n\t\t\treturn;\n\t\t}\n\n\t\tspeaking = true;\n\n\t\tif ($config.audio.tts.engine === '') {\n\t\t\tlet voices = [];\n\t\t\tconst getVoicesLoop = setInterval(() => {\n\t\t\t\tvoices = speechSynthesis.getVoices();\n\t\t\t\tif (voices.length > 0) {\n\t\t\t\t\tclearInterval(getVoicesLoop);\n\n\t\t\t\t\tconst voice =\n\t\t\t\t\t\tvoices\n\t\t\t\t\t\t\t?.filter(\n\t\t\t\t\t\t\t\t(v) => v.voiceURI === ($settings?.audio?.tts?.voice ?? $config?.audio?.tts?.voice)\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t?.at(0) ?? undefined;\n\n\t\t\t\t\tconsole.log(voice);\n\n\t\t\t\t\tconst speak = new SpeechSynthesisUtterance(message.content);\n\t\t\t\t\tspeak.rate = $settings.audio?.tts?.playbackRate ?? 1;\n\n\t\t\t\t\tconsole.log(speak);\n\n\t\t\t\t\tspeak.onend = () => {\n\t\t\t\t\t\tspeaking = false;\n\t\t\t\t\t\tif ($settings.conversationMode) {\n\t\t\t\t\t\t\tdocument.getElementById('voice-input-button')?.click();\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t\tif (voice) {\n\t\t\t\t\t\tspeak.voice = voice;\n\t\t\t\t\t}\n\n\t\t\t\t\tspeechSynthesis.speak(speak);\n\t\t\t\t}\n\t\t\t}, 100);\n\t\t} else {\n\t\t\tloadingSpeech = true;\n\n\t\t\tconst messageContentParts: string[] = getMessageContentParts(\n\t\t\t\tmessage.content,\n\t\t\t\t$config?.audio?.tts?.split_on ?? 'punctuation'\n\t\t\t);\n\n\t\t\tif (!messageContentParts.length) {\n\t\t\t\tconsole.log('No content to speak');\n\t\t\t\ttoast.info($i18n.t('No content to speak'));\n\n\t\t\t\tspeaking = false;\n\t\t\t\tloadingSpeech = false;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconsole.debug('Prepared message content for TTS', messageContentParts);\n\n\t\t\taudioParts = messageContentParts.reduce(\n\t\t\t\t(acc, _sentence, idx) => {\n\t\t\t\t\tacc[idx] = null;\n\t\t\t\t\treturn acc;\n\t\t\t\t},\n\t\t\t\t{} as typeof audioParts\n\t\t\t);\n\n\t\t\tlet lastPlayedAudioPromise = Promise.resolve(); // Initialize a promise that resolves immediately\n\n\t\t\tif ($settings.audio?.tts?.engine === 'browser-kokoro') {\n\t\t\t\tif (!$TTSWorker) {\n\t\t\t\t\tawait TTSWorker.set(\n\t\t\t\t\t\tnew KokoroWorker({\n\t\t\t\t\t\t\tdtype: $settings.audio?.tts?.engineConfig?.dtype ?? 'fp32'\n\t\t\t\t\t\t})\n\t\t\t\t\t);\n\n\t\t\t\t\tawait $TTSWorker.init();\n\t\t\t\t}\n\n\t\t\t\tfor (const [idx, sentence] of messageContentParts.entries()) {\n\t\t\t\t\tconst blob = await $TTSWorker\n\t\t\t\t\t\t.generate({\n\t\t\t\t\t\t\ttext: sentence,\n\t\t\t\t\t\t\tvoice: $settings?.audio?.tts?.voice ?? $config?.audio?.tts?.voice\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch((error) => {\n\t\t\t\t\t\t\tconsole.error(error);\n\t\t\t\t\t\t\ttoast.error(`${error}`);\n\n\t\t\t\t\t\t\tspeaking = false;\n\t\t\t\t\t\t\tloadingSpeech = false;\n\t\t\t\t\t\t});\n\n\t\t\t\t\tif (blob) {\n\t\t\t\t\t\tconst audio = new Audio(blob);\n\t\t\t\t\t\taudio.playbackRate = $settings.audio?.tts?.playbackRate ?? 1;\n\n\t\t\t\t\t\taudioParts[idx] = audio;\n\t\t\t\t\t\tloadingSpeech = false;\n\t\t\t\t\t\tlastPlayedAudioPromise = lastPlayedAudioPromise.then(() => playAudio(idx));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (const [idx, sentence] of messageContentParts.entries()) {\n\t\t\t\t\tconst res = await synthesizeOpenAISpeech(\n\t\t\t\t\t\tlocalStorage.token,\n\t\t\t\t\t\t$settings?.audio?.tts?.defaultVoice === $config.audio.tts.voice\n\t\t\t\t\t\t\t? ($settings?.audio?.tts?.voice ?? $config?.audio?.tts?.voice)\n\t\t\t\t\t\t\t: $config?.audio?.tts?.voice,\n\t\t\t\t\t\tsentence\n\t\t\t\t\t).catch((error) => {\n\t\t\t\t\t\tconsole.error(error);\n\t\t\t\t\t\ttoast.error(`${error}`);\n\n\t\t\t\t\t\tspeaking = false;\n\t\t\t\t\t\tloadingSpeech = false;\n\t\t\t\t\t});\n\n\t\t\t\t\tif (res) {\n\t\t\t\t\t\tconst blob = await res.blob();\n\t\t\t\t\t\tconst blobUrl = URL.createObjectURL(blob);\n\t\t\t\t\t\tconst audio = new Audio(blobUrl);\n\t\t\t\t\t\taudio.playbackRate = $settings.audio?.tts?.playbackRate ?? 1;\n\n\t\t\t\t\t\taudioParts[idx] = audio;\n\t\t\t\t\t\tloadingSpeech = false;\n\t\t\t\t\t\tlastPlayedAudioPromise = lastPlayedAudioPromise.then(() => playAudio(idx));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tconst editMessageHandler = async () => {\n\t\tedit = true;\n\t\teditedContent = message.content;\n\n\t\tawait tick();\n\n\t\teditTextAreaElement.style.height = '';\n\t\teditTextAreaElement.style.height = `${editTextAreaElement.scrollHeight}px`;\n\t};\n\n\tconst editMessageConfirmHandler = async () => {\n\t\teditMessage(message.id, editedContent ? editedContent : '', false);\n\n\t\tedit = false;\n\t\teditedContent = '';\n\n\t\tawait tick();\n\t};\n\n\tconst saveAsCopyHandler = async () => {\n\t\teditMessage(message.id, editedContent ? editedContent : '');\n\n\t\tedit = false;\n\t\teditedContent = '';\n\n\t\tawait tick();\n\t};\n\n\tconst cancelEditMessage = async () => {\n\t\tedit = false;\n\t\teditedContent = '';\n\t\tawait tick();\n\t};\n\n\tconst generateImage = async (message: MessageType) => {\n\t\tgeneratingImage = true;\n\t\tconst res = await imageGenerations(localStorage.token, message.content).catch((error) => {\n\t\t\ttoast.error(`${error}`);\n\t\t});\n\t\tconsole.log(res);\n\n\t\tif (res) {\n\t\t\tconst files = res.map((image) => ({\n\t\t\t\ttype: 'image',\n\t\t\t\turl: `${image.url}`\n\t\t\t}));\n\n\t\t\tsaveMessage(message.id, {\n\t\t\t\t...message,\n\t\t\t\tfiles: files\n\t\t\t});\n\t\t}\n\n\t\tgeneratingImage = false;\n\t};\n\n\tlet feedbackLoading = false;\n\n\tconst feedbackHandler = async (rating: number | null = null, details: object | null = null) => {\n\t\tfeedbackLoading = true;\n\t\tconsole.log('Feedback', rating, details);\n\n\t\tconst updatedMessage = {\n\t\t\t...message,\n\t\t\tannotation: {\n\t\t\t\t...(message?.annotation ?? {}),\n\t\t\t\t...(rating !== null ? { rating: rating } : {}),\n\t\t\t\t...(details ? details : {})\n\t\t\t}\n\t\t};\n\n\t\tconst chat = await getChatById(localStorage.token, chatId).catch((error) => {\n\t\t\ttoast.error(`${error}`);\n\t\t});\n\t\tif (!chat) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst messages = createMessagesList(history, message.id);\n\n\t\tlet feedbackItem = {\n\t\t\ttype: 'rating',\n\t\t\tdata: {\n\t\t\t\t...(updatedMessage?.annotation ? updatedMessage.annotation : {}),\n\t\t\t\tmodel_id: message?.selectedModelId ?? message.model,\n\t\t\t\t...(history.messages[message.parentId].childrenIds.length > 1\n\t\t\t\t\t? {\n\t\t\t\t\t\t\tsibling_model_ids: history.messages[message.parentId].childrenIds\n\t\t\t\t\t\t\t\t.filter((id) => id !== message.id)\n\t\t\t\t\t\t\t\t.map((id) => history.messages[id]?.selectedModelId ?? history.messages[id].model)\n\t\t\t\t\t\t}\n\t\t\t\t\t: {})\n\t\t\t},\n\t\t\tmeta: {\n\t\t\t\tarena: message ? message.arena : false,\n\t\t\t\tmodel_id: message.model,\n\t\t\t\tmessage_id: message.id,\n\t\t\t\tmessage_index: messages.length,\n\t\t\t\tchat_id: chatId\n\t\t\t},\n\t\t\tsnapshot: {\n\t\t\t\tchat: chat\n\t\t\t}\n\t\t};\n\n\t\tconst baseModels = [\n\t\t\tfeedbackItem.data.model_id,\n\t\t\t...(feedbackItem.data.sibling_model_ids ?? [])\n\t\t].reduce((acc, modelId) => {\n\t\t\tconst model = $models.find((m) => m.id === modelId);\n\t\t\tif (model) {\n\t\t\t\tacc[model.id] = model?.info?.base_model_id ?? null;\n\t\t\t} else {\n\t\t\t\t// Log or handle cases where corresponding model is not found\n\t\t\t\tconsole.warn(`Model with ID ${modelId} not found`);\n\t\t\t}\n\t\t\treturn acc;\n\t\t}, {});\n\t\tfeedbackItem.meta.base_models = baseModels;\n\n\t\tlet feedback = null;\n\t\tif (message?.feedbackId) {\n\t\t\tfeedback = await updateFeedbackById(\n\t\t\t\tlocalStorage.token,\n\t\t\t\tmessage.feedbackId,\n\t\t\t\tfeedbackItem\n\t\t\t).catch((error) => {\n\t\t\t\ttoast.error(`${error}`);\n\t\t\t});\n\t\t} else {\n\t\t\tfeedback = await createNewFeedback(localStorage.token, feedbackItem).catch((error) => {\n\t\t\t\ttoast.error(`${error}`);\n\t\t\t});\n\n\t\t\tif (feedback) {\n\t\t\t\tupdatedMessage.feedbackId = feedback.id;\n\t\t\t}\n\t\t}\n\n\t\tconsole.log(updatedMessage);\n\t\tsaveMessage(message.id, updatedMessage);\n\n\t\tawait tick();\n\n\t\tif (!details) {\n\t\t\tshowRateComment = true;\n\n\t\t\tif (!updatedMessage.annotation?.tags) {\n\t\t\t\t// attempt to generate tags\n\t\t\t\tconst tags = await generateTags(localStorage.token, message.model, messages, chatId).catch(\n\t\t\t\t\t(error) => {\n\t\t\t\t\t\tconsole.error(error);\n\t\t\t\t\t\treturn [];\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t\tconsole.log(tags);\n\n\t\t\t\tif (tags) {\n\t\t\t\t\tupdatedMessage.annotation.tags = tags;\n\t\t\t\t\tfeedbackItem.data.tags = tags;\n\n\t\t\t\t\tsaveMessage(message.id, updatedMessage);\n\t\t\t\t\tawait updateFeedbackById(\n\t\t\t\t\t\tlocalStorage.token,\n\t\t\t\t\t\tupdatedMessage.feedbackId,\n\t\t\t\t\t\tfeedbackItem\n\t\t\t\t\t).catch((error) => {\n\t\t\t\t\t\ttoast.error(`${error}`);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfeedbackLoading = false;\n\t};\n\n\tconst deleteMessageHandler = async () => {\n\t\tdeleteMessage(message.id);\n\t};\n\n\t$: if (!edit) {\n\t\t(async () => {\n\t\t\tawait tick();\n\t\t})();\n\t}\n\n\tonMount(async () => {\n\t\t// console.log('ResponseMessage mounted');\n\n\t\tawait tick();\n\t\tif (buttonsContainerElement) {\n\t\t\tconsole.log(buttonsContainerElement);\n\t\t\tbuttonsContainerElement.addEventListener('wheel', function (event) {\n\t\t\t\t// console.log(event.deltaY);\n\n\t\t\t\tevent.preventDefault();\n\t\t\t\tif (event.deltaY !== 0) {\n\t\t\t\t\t// Adjust horizontal scroll position based on vertical scroll\n\t\t\t\t\tbuttonsContainerElement.scrollLeft += event.deltaY;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n\n\t// Add debug logging\n\t$: if (message?.content) {\n\t\tconsole.log(` Rendering message ${messageId} content length: ${message.content.length}`);\n\t}\n\n\t// Function to check if a string is JSON\n\tfunction isJsonString(str) {\n\t\ttry {\n\t\t\tconst json = JSON.parse(str);\n\t\t\treturn typeof json === 'object' && json !== null;\n\t\t} catch (e) {\n\t\t\treturn false;\n\t\t}\n\t}\n\t\n\t// Process potential agent response\n\tfunction processAgentResponse(content) {\n\t\tconsole.log('Processing agent response:', content);\n\t\tconsole.log('Type of content:', typeof content);\n\t\tif (!content || typeof content !== 'string') return { isAgent: false, content };\n\t\t\n\t\t// Try to parse as JSON\n\t\tif (isJsonString(content)) {\n\t\t\ttry {\n\t\t\t\tconst parsedContent = JSON.parse(content);\n\t\t\t\t\n\t\t\t\t// Check if it matches the agent response format\n\t\t\t\tif (parsedContent.success && parsedContent.response) {\n\t\t\t\t\tconsole.log(' Detected agent response:', parsedContent.response.type);\n\t\t\t\t\t\n\t\t\t\t\t// For query_chart type, use response.content as the main content\n\t\t\t\t\tif (parsedContent.response.type === 'query_chart') {\n\t\t\t\t\t\treturn { \n\t\t\t\t\t\t\tisAgent: true, \n\t\t\t\t\t\t\ttype: 'query_chart',\n\t\t\t\t\t\t\tcontent: parsedContent.response.content,\n\t\t\t\t\t\t\tdata: parsedContent\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// For query_result type, use response.content as the main content\n\t\t\t\t\tif (parsedContent.response.type === 'query_result') {\n\t\t\t\t\t\treturn { \n\t\t\t\t\t\t\tisAgent: true, \n\t\t\t\t\t\t\ttype: parsedContent.response.type,\n\t\t\t\t\t\t\tcontent: parsedContent.response.content,\n\t\t\t\t\t\t\tdata: parsedContent\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// For other types\n\t\t\t\t\treturn { \n\t\t\t\t\t\tisAgent: true, \n\t\t\t\t\t\ttype: parsedContent.response.type,\n\t\t\t\t\t\tcontent: parsedContent.response.content,\n\t\t\t\t\t\tdata: parsedContent\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// Also check for direct type format in the root object\n\t\t\t\tif (parsedContent.success && (parsedContent.type === 'query_result' || parsedContent.type === 'query_chart')) {\n\t\t\t\t\tconsole.log(' Detected direct query type:', parsedContent.type);\n\t\t\t\t\treturn { \n\t\t\t\t\t\tisAgent: true, \n\t\t\t\t\t\ttype: parsedContent.type,\n\t\t\t\t\t\tcontent: parsedContent.response.content,\n\t\t\t\t\t\tdata: parsedContent\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error('Error parsing potential agent response:', e);\n\t\t\t}\n\t\t}\n\t\t\n\t\treturn { isAgent: false, content };\n\t}\n\t\n\t// Extract processed agent response\n\t$: processedResponse = processAgentResponse(message?.content);\n</script>\n\n<DeleteConfirmDialog\n\tbind:show={showDeleteConfirm}\n\ttitle={$i18n.t('Delete message?')}\n\ton:confirm={() => {\n\t\tdeleteMessageHandler();\n\t}}\n/>\n\n{#key message.id}\n\t<div\n\t\tclass=\" flex w-full message-{message.id}\"\n\t\tid=\"message-{message.id}\"\n\t\tdir={$settings.chatDirection}\n\t>\n\t\t<div class={`shrink-0 ${($settings?.chatDirection ?? 'LTR') === 'LTR' ? 'mr-3' : 'ml-3'}`}>\n\t\t\t<ProfileImage\n\t\t\t\tsrc={model?.info?.meta?.profile_image_url ??\n\t\t\t\t\t($i18n.language === 'dg-DG' ? `/doge.png` : `/static/favicon.png`)}\n\t\t\t\tclassName={'size-8'}\n\t\t\t/>\n\t\t</div>\n\n\t\t<div class=\"flex-auto w-0 pl-1\">\n\t\t\t<Name>\n\t\t\t\t<Tooltip content={model?.name ?? message.model} placement=\"top-start\">\n\t\t\t\t\t<span class=\"line-clamp-1\">\n\t\t\t\t\t\t{model?.name ?? message.model}\n\t\t\t\t\t</span>\n\t\t\t\t</Tooltip>\n\n\t\t\t\t{#if message.timestamp}\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\" self-center text-xs invisible group-hover:visible text-gray-400 font-medium first-letter:capitalize ml-0.5 translate-y-[1px]\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<Tooltip content={dayjs(message.timestamp * 1000).format('LLLL')}>\n\t\t\t\t\t\t\t<span class=\"line-clamp-1\">{formatDate(message.timestamp * 1000)}</span>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\t\t\t</Name>\n\n\t\t\t<div>\n\t\t\t\t{#if message?.files && message.files?.filter((f) => f.type === 'image').length > 0}\n\t\t\t\t\t<div class=\"my-2.5 w-full flex overflow-x-auto gap-2 flex-wrap\">\n\t\t\t\t\t\t{#each message.files as file}\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t{#if file.type === 'image'}\n\t\t\t\t\t\t\t\t\t<Image src={file.url} alt={message.content} />\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/each}\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\n\t\t\t\t<div class=\"chat-{message.role} w-full min-w-full markdown-prose\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t{#if (message?.statusHistory ?? [...(message?.status ? [message?.status] : [])]).length > 0}\n\t\t\t\t\t\t\t{@const status = (\n\t\t\t\t\t\t\t\tmessage?.statusHistory ?? [...(message?.status ? [message?.status] : [])]\n\t\t\t\t\t\t\t).at(-1)}\n\t\t\t\t\t\t\t{#if !status?.hidden}\n\t\t\t\t\t\t\t\t<div class=\"status-description flex items-center gap-2 py-0.5\">\n\t\t\t\t\t\t\t\t\t{#if status?.done === false}\n\t\t\t\t\t\t\t\t\t\t<div class=\"\">\n\t\t\t\t\t\t\t\t\t\t\t<Spinner className=\"size-4\" />\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t\t{#if status?.action === 'web_search' && status?.urls}\n\t\t\t\t\t\t\t\t\t\t<WebSearchResults {status}>\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"flex flex-col justify-center -space-y-0.5\">\n\t\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"{status?.done === false\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t? 'shimmer'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t: ''} text-base line-clamp-1 text-wrap\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<!-- $i18n.t(\"Generating search query\") -->\n\t\t\t\t\t\t\t\t\t\t\t\t\t<!-- $i18n.t(\"No search query generated\") -->\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t<!-- $i18n.t('Searched {{count}} sites') -->\n\t\t\t\t\t\t\t\t\t\t\t\t\t{#if status?.description.includes('{{count}}')}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{$i18n.t(status?.description, {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcount: status?.urls.length\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t\t\t\t\t\t{:else if status?.description === 'No search query generated'}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{$i18n.t('No search query generated')}\n\t\t\t\t\t\t\t\t\t\t\t\t\t{:else if status?.description === 'Generating search query'}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{$i18n.t('Generating search query')}\n\t\t\t\t\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{status?.description}\n\t\t\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</WebSearchResults>\n\t\t\t\t\t\t\t\t\t{:else if status?.action === 'knowledge_search'}\n\t\t\t\t\t\t\t\t\t\t<div class=\"flex flex-col justify-center -space-y-0.5\">\n\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"{status?.done === false\n\t\t\t\t\t\t\t\t\t\t\t\t\t? 'shimmer'\n\t\t\t\t\t\t\t\t\t\t\t\t\t: ''} text-gray-500 dark:text-gray-500 text-base line-clamp-1 text-wrap\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t{$i18n.t(`Searching Knowledge for \"{{searchQuery}}\"`, {\n\t\t\t\t\t\t\t\t\t\t\t\t\tsearchQuery: status.query\n\t\t\t\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t<div class=\"flex flex-col justify-center -space-y-0.5\">\n\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"{status?.done === false\n\t\t\t\t\t\t\t\t\t\t\t\t\t? 'shimmer'\n\t\t\t\t\t\t\t\t\t\t\t\t\t: ''} text-gray-500 dark:text-gray-500 text-base line-clamp-1 text-wrap\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<!-- $i18n.t(`Searching \"{{searchQuery}}\"`) -->\n\t\t\t\t\t\t\t\t\t\t\t\t{#if status?.description.includes('{{searchQuery}}')}\n\t\t\t\t\t\t\t\t\t\t\t\t\t{$i18n.t(status?.description, {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsearchQuery: status?.query\n\t\t\t\t\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t\t\t\t\t{:else if status?.description === 'No search query generated'}\n\t\t\t\t\t\t\t\t\t\t\t\t\t{$i18n.t('No search query generated')}\n\t\t\t\t\t\t\t\t\t\t\t\t{:else if status?.description === 'Generating search query'}\n\t\t\t\t\t\t\t\t\t\t\t\t\t{$i18n.t('Generating search query')}\n\t\t\t\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t\t\t\t{status?.description}\n\t\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t{#if edit === true}\n\t\t\t\t\t\t\t<div class=\"w-full bg-gray-50 dark:bg-gray-800 rounded-3xl px-5 py-3 my-2\">\n\t\t\t\t\t\t\t\t<textarea\n\t\t\t\t\t\t\t\t\tid=\"message-edit-{message.id}\"\n\t\t\t\t\t\t\t\t\tbind:this={editTextAreaElement}\n\t\t\t\t\t\t\t\t\tclass=\" bg-transparent outline-hidden w-full resize-none\"\n\t\t\t\t\t\t\t\t\tbind:value={editedContent}\n\t\t\t\t\t\t\t\t\ton:input={(e) => {\n\t\t\t\t\t\t\t\t\t\te.target.style.height = '';\n\t\t\t\t\t\t\t\t\t\te.target.style.height = `${e.target.scrollHeight}px`;\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\ton:keydown={(e) => {\n\t\t\t\t\t\t\t\t\t\tif (e.key === 'Escape') {\n\t\t\t\t\t\t\t\t\t\t\tdocument.getElementById('close-edit-message-button')?.click();\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tconst isCmdOrCtrlPressed = e.metaKey || e.ctrlKey;\n\t\t\t\t\t\t\t\t\t\tconst isEnterPressed = e.key === 'Enter';\n\n\t\t\t\t\t\t\t\t\t\tif (isCmdOrCtrlPressed && isEnterPressed) {\n\t\t\t\t\t\t\t\t\t\t\tdocument.getElementById('confirm-edit-message-button')?.click();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t\t\t<div class=\" mt-2 mb-1 flex justify-between text-sm font-medium\">\n\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\tid=\"save-new-message-button\"\n\t\t\t\t\t\t\t\t\t\t\tclass=\" px-4 py-2 bg-gray-50 hover:bg-gray-100 dark:bg-gray-800 dark:hover:bg-gray-700 border dark:border-gray-700 text-gray-700 dark:text-gray-200 transition rounded-3xl\"\n\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\tsaveAsCopyHandler();\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t{$i18n.t('Save As Copy')}\n\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t<div class=\"flex space-x-1.5\">\n\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\tid=\"close-edit-message-button\"\n\t\t\t\t\t\t\t\t\t\t\tclass=\"px-4 py-2 bg-white dark:bg-gray-900 hover:bg-gray-100 text-gray-800 dark:text-gray-100 transition rounded-3xl\"\n\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\tcancelEditMessage();\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t{$i18n.t('Cancel')}\n\t\t\t\t\t\t\t\t\t\t</button>\n\n\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\tid=\"confirm-edit-message-button\"\n\t\t\t\t\t\t\t\t\t\t\tclass=\" px-4 py-2 bg-gray-900 dark:bg-white hover:bg-gray-850 text-gray-100 dark:text-gray-800 transition rounded-3xl\"\n\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\teditMessageConfirmHandler();\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t{$i18n.t('Save')}\n\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t<div class=\"w-full flex flex-col relative\" id=\"response-content-container\">\n\t\t\t\t\t\t\t\t{#if message.content === '' && !message.error}\n\t\t\t\t\t\t\t\t\t<Skeleton />\n\t\t\t\t\t\t\t\t{:else if message.content && message.error !== true}\n\t\t\t\t\t\t\t\t\t{#if message.isLoading}\n\t\t\t\t\t\t\t\t\t\t<!-- Agent loading animation -->\n\t\t\t\t\t\t\t\t\t\t<div class=\"agent-loading-animation\">\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"flex items-center\">\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"typing-animation mr-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"agent-loading-text\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{message.content}\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t{:else if processedResponse.isAgent}\n\t\t\t\t\t\t\t\t\t\t{#if (processedResponse.type === 'query_result' || processedResponse.data.type === 'query_result') && (processedResponse.data.results || processedResponse.data.response?.results)}\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"agent-query-results py-3\">\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"mb-4 text-gray-700 dark:text-gray-300\">{processedResponse.content}</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t<!-- Data table with header -->\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"mb-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"flex items-center gap-2 font-medium text-gray-700 dark:text-gray-300 mb-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" class=\"w-4 h-4\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M3.375 19.5h17.25m-17.25 0a1.125 1.125 0 0 1-1.125-1.125M3.375 19.5h7.5c.621 0 1.125-.504 1.125-1.125m-9.75 0V5.625m0 12.75v-1.5c0-.621.504-1.125 1.125-1.125m18.375 2.625V5.625m0 12.75c0 .621-.504 1.125-1.125 1.125m1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125m0 3.75h-7.5A1.125 1.125 0 0 1 12 18.375m9.75-12.75c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125m19.5 0v1.5c0 .621-.504 1.125-1.125 1.125M2.25 5.625v1.5c0 .621.504 1.125 1.125 1.125m0 0h17.25m-17.25 0h7.5c.621 0 1.125.504 1.125 1.125M3.375 8.25c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125m1.125-3.75h7.5c.621 0 1.125.504 1.125 1.125m-9.75 0h9.75\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tData Table\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"overflow-x-auto\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{#if processedResponse.data.results}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Table \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata={processedResponse.data.results.records}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcolumns={processedResponse.data.results.columns}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"border w-full table-improved\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{:else if processedResponse.data.response?.results}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Table \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata={processedResponse.data.response.results.records}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcolumns={processedResponse.data.response.results.columns}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"border w-full table-improved\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t{#if processedResponse.data.results?.sql_query || processedResponse.data.metadata?.sql_query}\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"mt-4 mb-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"flex justify-between items-center mb-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"font-medium text-gray-700 dark:text-gray-300 flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" class=\"w-4 h-4\" stroke-width=\"2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tSQL Query\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"text-xs px-2 py-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-400 transition-colors\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcopyToClipboard(processedResponse.data.results?.sql_query || processedResponse.data.metadata?.sql_query);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"flex items-center gap-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" class=\"w-3.5 h-3.5\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tCopy\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<pre class=\"bg-gray-50 dark:bg-gray-800/70 p-3 rounded-lg overflow-auto text-sm font-mono border border-gray-200 dark:border-gray-700 shadow-inner\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<code class=\"sql-syntax text-gray-800 dark:text-gray-200\">\n{processedResponse.data.results?.sql_query || processedResponse.data.metadata?.sql_query}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</code>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</pre>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{:else if (processedResponse.type === 'query_chart' || processedResponse.data.type === 'query_chart') && processedResponse.data.response?.chart_url}\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"agent-query-chart py-3\">\n\t\t\t\t\t\t\t\t\t\t\t\t<!-- Display text content -->\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"mb-3 text-gray-700 dark:text-gray-300\">{processedResponse.content}</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t<!-- Display chart image with enhanced styling and download button -->\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"mb-4 relative\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"absolute top-2 right-2 flex gap-2 z-10\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<a \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thref={processedResponse.data.response.chart_url} \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdownload=\"chart.png\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"p-1.5 bg-gray-100/80 dark:bg-gray-700/80 backdrop-blur-sm rounded shadow-sm hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Download chart\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke-width=\"1.5\" stroke=\"currentColor\" class=\"w-4 h-4\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<a \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thref={processedResponse.data.response.chart_url} \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"p-1.5 bg-gray-100/80 dark:bg-gray-700/80 backdrop-blur-sm rounded shadow-sm hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Open in new tab\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke-width=\"1.5\" stroke=\"currentColor\" class=\"w-4 h-4\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M13.5 6H5.25A2.25 2.25 0 003 8.25v10.5A2.25 2.25 0 005.25 21h10.5A2.25 2.25 0 0018 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<img \n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsrc={processedResponse.data.response.chart_url} \n\t\t\t\t\t\t\t\t\t\t\t\t\t\talt=\"Data visualization chart\" \n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"max-w-full h-auto border border-gray-200 dark:border-gray-700 rounded-lg shadow-sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t<!-- Display data table if available with enhanced section header -->\n\t\t\t\t\t\t\t\t\t\t\t\t{#if processedResponse.data.results?.records}\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"mt-4 mb-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"flex items-center gap-2 font-medium text-gray-700 dark:text-gray-300 mb-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" class=\"w-4 h-4\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M3.375 19.5h17.25m-17.25 0a1.125 1.125 0 0 1-1.125-1.125M3.375 19.5h7.5c.621 0 1.125-.504 1.125-1.125m-9.75 0V5.625m0 12.75v-1.5c0-.621.504-1.125 1.125-1.125m18.375 2.625V5.625m0 12.75c0 .621-.504 1.125-1.125 1.125m1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125m0 3.75h-7.5A1.125 1.125 0 0 1 12 18.375m9.75-12.75c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125m19.5 0v1.5c0 .621-.504 1.125-1.125 1.125M2.25 5.625v1.5c0 .621.504 1.125 1.125 1.125m0 0h17.25m-17.25 0h7.5c.621 0 1.125.504 1.125 1.125M3.375 8.25c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125m1.125-3.75h7.5c.621 0 1.125.504 1.125 1.125m-9.75 0h9.75\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tData Table\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"overflow-x-auto\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Table \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata={processedResponse.data.results.records}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcolumns={processedResponse.data.results.columns}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"border w-full table-improved\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmaxPreviewRows={12}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t<!-- Display SQL query if available -->\n\t\t\t\t\t\t\t\t\t\t\t\t{#if processedResponse.data.results?.sql_query || processedResponse.data.metadata?.sql_query}\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"mt-4 mb-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"flex justify-between items-center mb-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"font-medium text-gray-700 dark:text-gray-300 flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" class=\"w-4 h-4\" stroke-width=\"2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tSQL Query\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"text-xs px-2 py-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-400 transition-colors\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcopyToClipboard(processedResponse.data.results?.sql_query || processedResponse.data.metadata?.sql_query);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"flex items-center gap-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" class=\"w-3.5 h-3.5\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tCopy\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<pre class=\"bg-gray-50 dark:bg-gray-800/70 p-3 rounded-lg overflow-auto text-sm font-mono border border-gray-200 dark:border-gray-700 shadow-inner\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<code class=\"sql-syntax text-gray-800 dark:text-gray-200\">\n{processedResponse.data.results?.sql_query || processedResponse.data.metadata?.sql_query}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</code>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</pre>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{:else if processedResponse.type === 'chart' && processedResponse.data.response.chart_url}\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"agent-chart py-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"mb-2\">{processedResponse.content}</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<img \n\t\t\t\t\t\t\t\t\t\t\t\t\tsrc={processedResponse.data.response.chart_url} \n\t\t\t\t\t\t\t\t\t\t\t\t\talt=\"Chart\" \n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"max-w-full h-auto border dark:border-gray-700 rounded\"\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t\t<!-- Regular text response or fallback -->\n\t\t\t\t\t\t\t\t\t<ContentRenderer\n\t\t\t\t\t\t\t\t\t\tid={message.id}\n\t\t\t\t\t\t\t\t\t\t{history}\n\t\t\t\t\t\t\t\t\t\t\t\tcontent={processedResponse.isAgent ? processedResponse.content : message.content}\n\t\t\t\t\t\t\t\t\t\tsources={message.sources}\n\t\t\t\t\t\t\t\t\t\tfloatingButtons={message?.done}\n\t\t\t\t\t\t\t\t\t\tsave={!readOnly}\n\t\t\t\t\t\t\t\t\t\t{model}\n\t\t\t\t\t\t\t\t\t\tonTaskClick={async (e) => {\n\t\t\t\t\t\t\t\t\t\t\tconsole.log(e);\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\tonSourceClick={async (id, idx) => {\n\t\t\t\t\t\t\t\t\t\t\tconsole.log(id, idx);\n\t\t\t\t\t\t\t\t\t\t\tlet sourceButton = document.getElementById(`source-${message.id}-${idx}`);\n\t\t\t\t\t\t\t\t\t\t\tconst sourcesCollapsible = document.getElementById(`collapsible-sources`);\n\n\t\t\t\t\t\t\t\t\t\t\tif (sourceButton) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsourceButton.scrollIntoView({ behavior: 'smooth' });\n\t\t\t\t\t\t\t\t\t\t\t} else if (sourcesCollapsible) {\n\t\t\t\t\t\t\t\t\t\t\t\t// Open sources collapsible so we can click the source button\n\t\t\t\t\t\t\t\t\t\t\t\tsourcesCollapsible\n\t\t\t\t\t\t\t\t\t\t\t\t\t.querySelector('div:first-child')\n\t\t\t\t\t\t\t\t\t\t\t\t\t.dispatchEvent(new PointerEvent('pointerup', {}));\n\n\t\t\t\t\t\t\t\t\t\t\t\t// Wait for next frame to ensure DOM updates\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tawait new Promise((resolve) => requestAnimationFrame(resolve));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tawait new Promise((resolve) => requestAnimationFrame(resolve));\n\n\t\t\t\t\t\t\t\t\t\t\t\tsourceButton = document.getElementById(`source-${message.id}-${idx}`);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (sourceButton) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsourceButton.scrollIntoView({ behavior: 'smooth' });\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\tonAddMessages={({ modelId, parentId, messages }) => {\n\t\t\t\t\t\t\t\t\t\t\taddMessages({ modelId, parentId, messages });\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\ton:update={(e) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tmessage.content = e.detail.content;\n\t\t\t\t\t\t\t\t\t\t\t\t\tdispatch('update', message);\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t<!-- Not an agent response, use normal rendering -->\n\t\t\t\t\t\t\t\t\t\t<ContentRenderer\n\t\t\t\t\t\t\t\t\t\t\tid={message.id}\n\t\t\t\t\t\t\t\t\t\t\t{history}\n\t\t\t\t\t\t\t\t\t\t\tcontent={message.content}\n\t\t\t\t\t\t\t\t\t\t\tsources={message.sources}\n\t\t\t\t\t\t\t\t\t\t\tfloatingButtons={message?.done}\n\t\t\t\t\t\t\t\t\t\t\tsave={!readOnly}\n\t\t\t\t\t\t\t\t\t\t\t{model}\n\t\t\t\t\t\t\t\t\t\t\tonTaskClick={async (e) => {\n\t\t\t\t\t\t\t\t\t\t\t\tconsole.log(e);\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\tonSourceClick={async (id, idx) => {\n\t\t\t\t\t\t\t\t\t\t\t\tconsole.log(id, idx);\n\t\t\t\t\t\t\t\t\t\t\t\tlet sourceButton = document.getElementById(`source-${message.id}-${idx}`);\n\t\t\t\t\t\t\t\t\t\t\t\tconst sourcesCollapsible = document.getElementById(`collapsible-sources`);\n\n\t\t\t\t\t\t\t\t\t\t\t\tif (sourceButton) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tsourceButton.scrollIntoView({ behavior: 'smooth' });\n\t\t\t\t\t\t\t\t\t\t\t\t} else if (sourcesCollapsible) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t// Open sources collapsible so we can click the source button\n\t\t\t\t\t\t\t\t\t\t\t\t\tsourcesCollapsible\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.querySelector('div:first-child')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.dispatchEvent(new PointerEvent('pointerup', {}));\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t// Wait for next frame to ensure DOM updates\n\t\t\t\t\t\t\t\t\t\t\t\t\tawait new Promise((resolve) => requestAnimationFrame(resolve));\n\t\t\t\t\t\t\t\t\t\t\t\t\tawait new Promise((resolve) => requestAnimationFrame(resolve));\n\n\t\t\t\t\t\t\t\t\t\t\t\t\tsourceButton = document.getElementById(`source-${message.id}-${idx}`);\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (sourceButton) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsourceButton.scrollIntoView({ behavior: 'smooth' });\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\tonAddMessages={({ modelId, parentId, messages }) => {\n\t\t\t\t\t\t\t\t\t\t\t\taddMessages({ modelId, parentId, messages });\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\ton:update={(e) => {\n\t\t\t\t\t\t\t\t\t\t\t\tmessage.content = e.detail.content;\n\t\t\t\t\t\t\t\t\t\t\t\tdispatch('update', message);\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t\t{#if message?.error && message.error !== true}\n\t\t\t\t\t\t\t\t\t\t<Error content={message.error.content} />\n\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t{#if (message?.sources || message?.citations) && (model?.info?.meta?.capabilities?.citations ?? true)}\n\t\t\t\t\t\t\t\t\t<Citations id={message?.id} sources={message?.sources ?? message?.citations} />\n\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t{#if message.code_executions}\n\t\t\t\t\t\t\t\t\t\t<CodeExecutions id={message?.id} code_executions={message.code_executions} />\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t{#if !edit}\n\t\t\t\t\t<div\n\t\t\t\t\t\tbind:this={buttonsContainerElement}\n\t\t\t\t\t\tclass=\"flex justify-start overflow-x-auto buttons text-gray-600 dark:text-gray-500 mt-0.5\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{#if message.done || siblings.length > 1}\n\t\t\t\t\t\t\t{#if siblings.length > 1}\n\t\t\t\t\t\t\t\t<div class=\"flex self-center min-w-fit\" dir=\"ltr\">\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\tclass=\"self-center p-1 hover:bg-black/5 dark:hover:bg-white/5 dark:hover:text-white hover:text-black rounded-md transition\"\n\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\tshowPreviousMessage(message);\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\tstroke-width=\"2.5\"\n\t\t\t\t\t\t\t\t\t\t\tclass=\"size-3.5\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\td=\"M15.75 19.5 8.25 12l7.5-7.5\"\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t</button>\n\n\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\tclass=\"text-sm tracking-widest font-semibold self-center dark:text-gray-100 min-w-fit\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{siblings.indexOf(message.id) + 1}/{siblings.length}\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\tclass=\"self-center p-1 hover:bg-black/5 dark:hover:bg-white/5 dark:hover:text-white hover:text-black rounded-md transition\"\n\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\tshowNextMessage(message);\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\tstroke-width=\"2.5\"\n\t\t\t\t\t\t\t\t\t\t\tclass=\"size-3.5\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\td=\"m8.25 4.5 7.5 7.5-7.5 7.5\"\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t{#if message.done}\n\t\t\t\t\t\t\t\t{#if !readOnly}\n\t\t\t\t\t\t\t\t\t{#if $user.role === 'user' ? ($user?.permissions?.chat?.edit ?? true) : true}\n\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Edit')} placement=\"bottom\">\n\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"{isLastMessage\n\t\t\t\t\t\t\t\t\t\t\t\t\t? 'visible'\n\t\t\t\t\t\t\t\t\t\t\t\t\t: 'invisible group-hover:visible'} p-1.5 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg dark:hover:text-white hover:text-black transition\"\n\t\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\teditMessageHandler();\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-width=\"2.3\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"w-4 h-4\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Copy')} placement=\"bottom\">\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\tclass=\"{isLastMessage\n\t\t\t\t\t\t\t\t\t\t\t? 'visible'\n\t\t\t\t\t\t\t\t\t\t\t: 'invisible group-hover:visible'} p-1.5 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg dark:hover:text-white hover:text-black transition copy-response-button\"\n\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\tcopyToClipboard(message.content);\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\tstroke-width=\"2.3\"\n\t\t\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\tclass=\"w-4 h-4\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\td=\"M15.666 3.888A2.25 2.25 0 0013.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 01-.75.75H9a.75.75 0 01-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 01-2.25 2.25H6.75A2.25 2.25 0 014.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 011.927-.184\"\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Read Aloud')} placement=\"bottom\">\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\tid=\"speak-button-{message.id}\"\n\t\t\t\t\t\t\t\t\t\tclass=\"{isLastMessage\n\t\t\t\t\t\t\t\t\t\t\t? 'visible'\n\t\t\t\t\t\t\t\t\t\t\t: 'invisible group-hover:visible'} p-1.5 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg dark:hover:text-white hover:text-black transition\"\n\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\tif (!loadingSpeech) {\n\t\t\t\t\t\t\t\t\t\t\t\ttoggleSpeakMessage();\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{#if loadingSpeech}\n\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\" w-4 h-4\"\n\t\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<style>\n\t\t\t\t\t\t\t\t\t\t\t\t\t.spinner_S1WN {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tanimation: spinner_MGfb 0.8s linear infinite;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tanimation-delay: -0.8s;\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t.spinner_Km9P {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tanimation-delay: -0.65s;\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t.spinner_JApP {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tanimation-delay: -0.5s;\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t@keyframes spinner_MGfb {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t93.75%,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t100% {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\topacity: 0.2;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t</style>\n\t\t\t\t\t\t\t\t\t\t\t\t<circle class=\"spinner_S1WN\" cx=\"4\" cy=\"12\" r=\"3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t<circle class=\"spinner_S1WN spinner_Km9P\" cx=\"12\" cy=\"12\" r=\"3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t<circle class=\"spinner_S1WN spinner_JApP\" cx=\"20\" cy=\"12\" r=\"3\" />\n\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t{:else if speaking}\n\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\t\tstroke-width=\"2.3\"\n\t\t\t\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"w-4 h-4\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M17.25 9.75 19.5 12m0 0 2.25 2.25M19.5 12l2.25-2.25M19.5 12l-2.25 2.25m-10.5-6 4.72-4.72a.75.75 0 0 1 1.28.53v15.88a.75.75 0 0 1-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.009 9.009 0 0 1 2.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75Z\"\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\t\tstroke-width=\"2.3\"\n\t\t\t\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"w-4 h-4\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M19.114 5.636a9 9 0 010 12.728M16.463 8.288a5.25 5.25 0 010 7.424M6.75 8.25l4.72-4.72a.75.75 0 0 1 1.28.53v15.88a.75.75 0 0 1-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.01 9.01 0 0 1 2.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75z\"\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t\t\t\t{#if $config?.features.enable_image_generation && ($user.role === 'admin' || $user?.permissions?.features?.image_generation) && !readOnly}\n\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Generate Image')} placement=\"bottom\">\n\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\tclass=\"{isLastMessage\n\t\t\t\t\t\t\t\t\t\t\t\t? 'visible'\n\t\t\t\t\t\t\t\t\t\t\t\t: 'invisible group-hover:visible'}  p-1.5 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg dark:hover:text-white hover:text-black transition\"\n\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\tif (!generatingImage) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tgenerateImage(message);\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t{#if generatingImage}\n\t\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\" w-4 h-4\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<style>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.spinner_S1WN {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tanimation: spinner_MGfb 0.8s linear infinite;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tanimation-delay: -0.8s;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.spinner_Km9P {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tanimation-delay: -0.65s;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.spinner_JApP {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tanimation-delay: -0.5s;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t@keyframes spinner_MGfb {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t93.75%,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t100% {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\topacity: 0.2;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</style>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<circle class=\"spinner_S1WN\" cx=\"4\" cy=\"12\" r=\"3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t<circle class=\"spinner_S1WN spinner_Km9P\" cx=\"12\" cy=\"12\" r=\"3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t<circle class=\"spinner_S1WN spinner_JApP\" cx=\"20\" cy=\"12\" r=\"3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-width=\"2.3\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"w-4 h-4\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t{#if message.usage}\n\t\t\t\t\t\t\t\t\t<Tooltip\n\t\t\t\t\t\t\t\t\t\tcontent={message.usage\n\t\t\t\t\t\t\t\t\t\t\t? `<pre>${sanitizeResponseContent(\n\t\t\t\t\t\t\t\t\t\t\t\t\tJSON.stringify(message.usage, null, 2)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.replace(/\"([^(\")\"]+)\":/g, '$1:')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.slice(1, -1)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.split('\\n')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.map((line) => line.slice(2))\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.map((line) => (line.endsWith(',') ? line.slice(0, -1) : line))\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.join('\\n')\n\t\t\t\t\t\t\t\t\t\t\t\t)}</pre>`\n\t\t\t\t\t\t\t\t\t\t\t: ''}\n\t\t\t\t\t\t\t\t\t\tplacement=\"bottom\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\tclass=\" {isLastMessage\n\t\t\t\t\t\t\t\t\t\t\t\t? 'visible'\n\t\t\t\t\t\t\t\t\t\t\t\t: 'invisible group-hover:visible'} p-1.5 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg dark:hover:text-white hover:text-black transition whitespace-pre-wrap\"\n\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\tconsole.log(message);\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\tid=\"info-{message.id}\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\t\tstroke-width=\"2.3\"\n\t\t\t\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"w-4 h-4\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M11.25 11.25l.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0zm-9-3.75h.008v.008H12V8.25z\"\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t{#if !readOnly}\n\t\t\t\t\t\t\t\t\t{#if !$temporaryChatEnabled && ($config?.features.enable_message_rating ?? true)}\n\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Good Response')} placement=\"bottom\">\n\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"{isLastMessage\n\t\t\t\t\t\t\t\t\t\t\t\t\t? 'visible'\n\t\t\t\t\t\t\t\t\t\t\t\t\t: 'invisible group-hover:visible'} p-1.5 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg {(\n\t\t\t\t\t\t\t\t\t\t\t\t\tmessage?.annotation?.rating ?? ''\n\t\t\t\t\t\t\t\t\t\t\t\t).toString() === '1'\n\t\t\t\t\t\t\t\t\t\t\t\t\t? 'bg-gray-100 dark:bg-gray-800'\n\t\t\t\t\t\t\t\t\t\t\t\t\t: ''} dark:hover:text-white hover:text-black transition disabled:cursor-progress disabled:hover:bg-transparent\"\n\t\t\t\t\t\t\t\t\t\t\t\tdisabled={feedbackLoading}\n\t\t\t\t\t\t\t\t\t\t\t\ton:click={async () => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tawait feedbackHandler(1);\n\t\t\t\t\t\t\t\t\t\t\t\t\twindow.setTimeout(() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdocument\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.getElementById(`message-feedback-${message.id}`)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t?.scrollIntoView();\n\t\t\t\t\t\t\t\t\t\t\t\t\t}, 0);\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-width=\"2.3\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"w-4 h-4\"\n\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Bad Response')} placement=\"bottom\">\n\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"{isLastMessage\n\t\t\t\t\t\t\t\t\t\t\t\t\t? 'visible'\n\t\t\t\t\t\t\t\t\t\t\t\t\t: 'invisible group-hover:visible'} p-1.5 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg {(\n\t\t\t\t\t\t\t\t\t\t\t\t\tmessage?.annotation?.rating ?? ''\n\t\t\t\t\t\t\t\t\t\t\t\t).toString() === '-1'\n\t\t\t\t\t\t\t\t\t\t\t\t\t? 'bg-gray-100 dark:bg-gray-800'\n\t\t\t\t\t\t\t\t\t\t\t\t\t: ''} dark:hover:text-white hover:text-black transition disabled:cursor-progress disabled:hover:bg-transparent\"\n\t\t\t\t\t\t\t\t\t\t\t\tdisabled={feedbackLoading}\n\t\t\t\t\t\t\t\t\t\t\t\ton:click={async () => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tawait feedbackHandler(-1);\n\t\t\t\t\t\t\t\t\t\t\t\t\twindow.setTimeout(() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdocument\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.getElementById(`message-feedback-${message.id}`)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t?.scrollIntoView();\n\t\t\t\t\t\t\t\t\t\t\t\t\t}, 0);\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-width=\"2.3\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"w-4 h-4\"\n\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M10 15v4a3 3 0 0 0 3 3l4-9V2H5.72a2 2 0 0 0-2 1.7l-1.38 9a2 2 0 0 0 2 2.3zm7-13h2.67A2.31 2.31 0 0 1 22 4v7a2.31 2.31 0 0 1-2.33 2H17\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t\t{#if isLastMessage}\n\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Continue Response')} placement=\"bottom\">\n\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\tid=\"continue-response-button\"\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"{isLastMessage\n\t\t\t\t\t\t\t\t\t\t\t\t\t? 'visible'\n\t\t\t\t\t\t\t\t\t\t\t\t\t: 'invisible group-hover:visible'} p-1.5 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg dark:hover:text-white hover:text-black transition regenerate-response-button\"\n\t\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tcontinueResponse();\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-width=\"2.3\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"w-4 h-4\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M15.91 11.672a.375.375 0 0 1 0 .656l-5.603 3.113a.375.375 0 0 1-.557-.328V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75\" />\n\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Regenerate')} placement=\"bottom\">\n\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\tclass=\"{isLastMessage\n\t\t\t\t\t\t\t\t\t\t\t\t? 'visible'\n\t\t\t\t\t\t\t\t\t\t\t\t: 'invisible group-hover:visible'} p-1.5 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg dark:hover:text-white hover:text-black transition regenerate-response-button\"\n\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\tshowRateComment = false;\n\t\t\t\t\t\t\t\t\t\t\t\tregenerateResponse(message);\n\n\t\t\t\t\t\t\t\t\t\t\t\t(model?.actions ?? []).forEach((action) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tdispatch('action', {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tid: action.id,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tevent: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tid: 'regenerate-response',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmessageId: message.id\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\t\tstroke-width=\"2.3\"\n\t\t\t\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"w-4 h-4\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99\"\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t\t\t\t\t{#if siblings.length > 1}\n\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Delete')} placement=\"bottom\">\n\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\tid=\"continue-response-button\"\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"{isLastMessage\n\t\t\t\t\t\t\t\t\t\t\t\t\t? 'visible'\n\t\t\t\t\t\t\t\t\t\t\t\t\t: 'invisible group-hover:visible'} p-1.5 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg dark:hover:text-white hover:text-black transition regenerate-response-button\"\n\t\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tshowDeleteConfirm = true;\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"w-4 h-4\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2 2 0 0 1-2 2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t\t{#if isLastMessage}\n\t\t\t\t\t\t\t\t\t\t{#each model?.actions ?? [] as action}\n\t\t\t\t\t\t\t\t\t\t\t<Tooltip content={action.name} placement=\"bottom\">\n\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"{isLastMessage\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t? 'visible'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t: 'invisible group-hover:visible'} p-1.5 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg dark:hover:text-white hover:text-black transition\"\n\t\t\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tactionMessage(action.id, message);\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{#if action.icon_url}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"size-4\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsrc={action.icon_url}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"w-4 h-4 {action.icon_url.includes('svg')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? 'dark:invert-[80%]'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: ''}\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle=\"fill: currentColor;\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\talt={action.name}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Sparkles strokeWidth=\"2.1\" className=\"size-4\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{#if message.done && showRateComment}\n\t\t\t\t\t\t<RateComment\n\t\t\t\t\t\t\tbind:message\n\t\t\t\t\t\t\tbind:show={showRateComment}\n\t\t\t\t\t\t\ton:save={async (e) => {\n\t\t\t\t\t\t\t\tawait feedbackHandler(null, {\n\t\t\t\t\t\t\t\t\t...e.detail\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t{/if}\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t</div>\n\t</div>\n{/key}\n\n<style>\n\t.buttons::-webkit-scrollbar {\n\t\tdisplay: none; /* for Chrome, Safari and Opera */\n\t}\n\n\t.buttons {\n\t\t-ms-overflow-style: none; /* IE and Edge */\n\t\tscrollbar-width: none; /* Firefox */\n\t}\n\t\n\t/* Table styling improvements */\n\t:global(.table-improved) {\n\t\twidth: calc(100% + 1rem) !important;\n\t\tmax-width: none !important;\n\t\tmargin-left: -0.5rem;\n\t\tmargin-right: -0.5rem;\n\t}\n\t\n\t:global(.table-improved thead) {\n\t\tbackground-color: #e8f4ff !important; /* Light blue header */\n\t}\n\t\n\t:global(.dark .table-improved thead) {\n\t\tbackground-color: #1e3a5f !important; /* Dark theme blue header */\n\t}\n\t\n\t:global(.table-improved th) {\n\t\tfont-weight: 600;\n\t\tpadding: 0.75rem 1rem !important;\n\t}\n\t\n\t:global(.table-improved td) {\n\t\tpadding: 0.625rem 1rem !important;\n\t}\n\n\t/* Agent loading animation styles */\n\t.agent-loading-animation {\n\t\tpadding: 0.5rem 0;\n\t}\n\n\t.agent-loading-text {\n\t\tfont-size: 1rem;\n\t\tline-height: 1.5;\n\t\tcolor: var(--text-primary);\n\t}\n\n\t.typing-animation {\n\t\tdisplay: inline-flex;\n\t\talign-items: center;\n\t\tmargin-right: 0.5rem;\n\t}\n\n\t.typing-animation span {\n\t\theight: 0.5rem;\n\t\twidth: 0.5rem;\n\t\tmargin: 0 0.1rem;\n\t\tbackground-color: #4b5563;\n\t\tborder-radius: 50%;\n\t\tdisplay: inline-block;\n\t\topacity: 0.6;\n\t}\n\n\t:global(.dark) .typing-animation span {\n\t\tbackground-color: #9ca3af;\n\t}\n\n\t.typing-animation span:nth-child(1) {\n\t\tanimation: pulse 1.5s infinite ease-in-out;\n\t}\n\n\t.typing-animation span:nth-child(2) {\n\t\tanimation: pulse 1.5s infinite ease-in-out 0.3s;\n\t}\n\n\t.typing-animation span:nth-child(3) {\n\t\tanimation: pulse 1.5s infinite ease-in-out 0.6s;\n\t}\n\n\t@keyframes pulse {\n\t\t0%, 100% {\n\t\t\ttransform: scale(0.75);\n\t\t\topacity: 0.4;\n\t\t}\n\t\t50% {\n\t\t\ttransform: scale(1);\n\t\t\topacity: 1;\n\t\t}\n\t}\n</style>\n","<script lang=\"ts\">\n\timport dayjs from 'dayjs';\n\timport { onMount, tick, getContext } from 'svelte';\n\timport { createEventDispatcher } from 'svelte';\n\n\timport { mobile, settings } from '$lib/stores';\n\n\timport { generateMoACompletion } from '$lib/apis';\n\timport { updateChatById } from '$lib/apis/chats';\n\timport { createOpenAITextStream } from '$lib/apis/streaming';\n\n\timport ResponseMessage from './ResponseMessage.svelte';\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\n\timport Merge from '$lib/components/icons/Merge.svelte';\n\n\timport Markdown from './Markdown.svelte';\n\timport Name from './Name.svelte';\n\timport Skeleton from './Skeleton.svelte';\n\timport localizedFormat from 'dayjs/plugin/localizedFormat';\n\tconst i18n = getContext('i18n');\n\tdayjs.extend(localizedFormat);\n\n\texport let chatId;\n\texport let history;\n\texport let messageId;\n\n\texport let isLastMessage;\n\texport let readOnly = false;\n\n\texport let updateChat: Function;\n\texport let editMessage: Function;\n\texport let saveMessage: Function;\n\texport let rateMessage: Function;\n\texport let actionMessage: Function;\n\n\texport let submitMessage: Function;\n\texport let deleteMessage: Function;\n\n\texport let continueResponse: Function;\n\texport let regenerateResponse: Function;\n\texport let mergeResponses: Function;\n\n\texport let addMessages: Function;\n\n\texport let triggerScroll: Function;\n\n\tconst dispatch = createEventDispatcher();\n\n\tlet currentMessageId;\n\tlet parentMessage;\n\tlet groupedMessageIds = {};\n\tlet groupedMessageIdsIdx = {};\n\n\tlet message = JSON.parse(JSON.stringify(history.messages[messageId]));\n\t$: if (history.messages) {\n\t\tif (JSON.stringify(message) !== JSON.stringify(history.messages[messageId])) {\n\t\t\tmessage = JSON.parse(JSON.stringify(history.messages[messageId]));\n\t\t}\n\t}\n\n\tconst showPreviousMessage = async (modelIdx) => {\n\t\tgroupedMessageIdsIdx[modelIdx] = Math.max(0, groupedMessageIdsIdx[modelIdx] - 1);\n\n\t\tlet messageId = groupedMessageIds[modelIdx].messageIds[groupedMessageIdsIdx[modelIdx]];\n\t\tconsole.log(messageId);\n\n\t\tlet messageChildrenIds = history.messages[messageId].childrenIds;\n\n\t\twhile (messageChildrenIds.length !== 0) {\n\t\t\tmessageId = messageChildrenIds.at(-1);\n\t\t\tmessageChildrenIds = history.messages[messageId].childrenIds;\n\t\t}\n\n\t\thistory.currentId = messageId;\n\n\t\tawait tick();\n\t\tawait updateChat();\n\t\ttriggerScroll();\n\t};\n\n\tconst showNextMessage = async (modelIdx) => {\n\t\tgroupedMessageIdsIdx[modelIdx] = Math.min(\n\t\t\tgroupedMessageIds[modelIdx].messageIds.length - 1,\n\t\t\tgroupedMessageIdsIdx[modelIdx] + 1\n\t\t);\n\n\t\tlet messageId = groupedMessageIds[modelIdx].messageIds[groupedMessageIdsIdx[modelIdx]];\n\t\tconsole.log(messageId);\n\n\t\tlet messageChildrenIds = history.messages[messageId].childrenIds;\n\n\t\twhile (messageChildrenIds.length !== 0) {\n\t\t\tmessageId = messageChildrenIds.at(-1);\n\t\t\tmessageChildrenIds = history.messages[messageId].childrenIds;\n\t\t}\n\n\t\thistory.currentId = messageId;\n\n\t\tawait tick();\n\t\tawait updateChat();\n\t\ttriggerScroll();\n\t};\n\n\tconst initHandler = async () => {\n\t\tconsole.log('multiresponse:initHandler');\n\t\tawait tick();\n\n\t\tcurrentMessageId = messageId;\n\t\tparentMessage = history.messages[messageId].parentId\n\t\t\t? history.messages[history.messages[messageId].parentId]\n\t\t\t: null;\n\n\t\tgroupedMessageIds = parentMessage?.models.reduce((a, model, modelIdx) => {\n\t\t\t// Find all messages that are children of the parent message and have the same model\n\t\t\tlet modelMessageIds = parentMessage?.childrenIds\n\t\t\t\t.map((id) => history.messages[id])\n\t\t\t\t.filter((m) => m?.modelIdx === modelIdx)\n\t\t\t\t.map((m) => m.id);\n\n\t\t\t// Legacy support for messages that don't have a modelIdx\n\t\t\t// Find all messages that are children of the parent message and have the same model\n\t\t\tif (modelMessageIds.length === 0) {\n\t\t\t\tlet modelMessages = parentMessage?.childrenIds\n\t\t\t\t\t.map((id) => history.messages[id])\n\t\t\t\t\t.filter((m) => m?.model === model);\n\n\t\t\t\tmodelMessages.forEach((m) => {\n\t\t\t\t\tm.modelIdx = modelIdx;\n\t\t\t\t});\n\n\t\t\t\tmodelMessageIds = modelMessages.map((m) => m.id);\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\t...a,\n\t\t\t\t[modelIdx]: { messageIds: modelMessageIds }\n\t\t\t};\n\t\t}, {});\n\n\t\tgroupedMessageIdsIdx = parentMessage?.models.reduce((a, model, modelIdx) => {\n\t\t\tconst idx = groupedMessageIds[modelIdx].messageIds.findIndex((id) => id === messageId);\n\t\t\tif (idx !== -1) {\n\t\t\t\treturn {\n\t\t\t\t\t...a,\n\t\t\t\t\t[modelIdx]: idx\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\treturn {\n\t\t\t\t\t...a,\n\t\t\t\t\t[modelIdx]: groupedMessageIds[modelIdx].messageIds.length - 1\n\t\t\t\t};\n\t\t\t}\n\t\t}, {});\n\n\t\tconsole.log(groupedMessageIds, groupedMessageIdsIdx);\n\n\t\tawait tick();\n\t};\n\n\tconst mergeResponsesHandler = async () => {\n\t\tconst responses = Object.keys(groupedMessageIds).map((modelIdx) => {\n\t\t\tconst { messageIds } = groupedMessageIds[modelIdx];\n\t\t\tconst messageId = messageIds[groupedMessageIdsIdx[modelIdx]];\n\n\t\t\treturn history.messages[messageId].content;\n\t\t});\n\t\tmergeResponses(messageId, responses, chatId);\n\t};\n\n\tonMount(async () => {\n\t\tawait initHandler();\n\t\tawait tick();\n\n\t\tconst messageElement = document.getElementById(`message-${messageId}`);\n\t\tif (messageElement) {\n\t\t\tmessageElement.scrollIntoView({ block: 'start' });\n\t\t}\n\t});\n</script>\n\n{#if parentMessage}\n\t<div>\n\t\t<div\n\t\t\tclass=\"flex snap-x snap-mandatory overflow-x-auto scrollbar-hidden\"\n\t\t\tid=\"responses-container-{chatId}-{parentMessage.id}\"\n\t\t>\n\t\t\t{#each Object.keys(groupedMessageIds) as modelIdx}\n\t\t\t\t{#if groupedMessageIdsIdx[modelIdx] !== undefined && groupedMessageIds[modelIdx].messageIds.length > 0}\n\t\t\t\t\t<!-- svelte-ignore a11y-no-static-element-interactions -->\n\t\t\t\t\t<!-- svelte-ignore a11y-click-events-have-key-events -->\n\t\t\t\t\t{@const _messageId =\n\t\t\t\t\t\tgroupedMessageIds[modelIdx].messageIds[groupedMessageIdsIdx[modelIdx]]}\n\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\" snap-center w-full max-w-full m-1 border {history.messages[messageId]\n\t\t\t\t\t\t\t?.modelIdx == modelIdx\n\t\t\t\t\t\t\t? `border-gray-100 dark:border-gray-850 border-[1.5px] ${\n\t\t\t\t\t\t\t\t\t$mobile ? 'min-w-full' : 'min-w-80'\n\t\t\t\t\t\t\t\t}`\n\t\t\t\t\t\t\t: `border-gray-100 dark:border-gray-850 border-dashed ${\n\t\t\t\t\t\t\t\t\t$mobile ? 'min-w-full' : 'min-w-80'\n\t\t\t\t\t\t\t\t}`} transition-all p-5 rounded-2xl\"\n\t\t\t\t\t\ton:click={async () => {\n\t\t\t\t\t\t\tif (messageId != _messageId) {\n\t\t\t\t\t\t\t\tlet currentMessageId = _messageId;\n\t\t\t\t\t\t\t\tlet messageChildrenIds = history.messages[currentMessageId].childrenIds;\n\t\t\t\t\t\t\t\twhile (messageChildrenIds.length !== 0) {\n\t\t\t\t\t\t\t\t\tcurrentMessageId = messageChildrenIds.at(-1);\n\t\t\t\t\t\t\t\t\tmessageChildrenIds = history.messages[currentMessageId].childrenIds;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\thistory.currentId = currentMessageId;\n\n\t\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\t\tawait updateChat();\n\t\t\t\t\t\t\t\ttriggerScroll();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t{#key history.currentId}\n\t\t\t\t\t\t\t{#if message}\n\t\t\t\t\t\t\t\t<ResponseMessage\n\t\t\t\t\t\t\t\t\t{chatId}\n\t\t\t\t\t\t\t\t\t{history}\n\t\t\t\t\t\t\t\t\tmessageId={_messageId}\n\t\t\t\t\t\t\t\t\tisLastMessage={true}\n\t\t\t\t\t\t\t\t\tsiblings={groupedMessageIds[modelIdx].messageIds}\n\t\t\t\t\t\t\t\t\tshowPreviousMessage={() => showPreviousMessage(modelIdx)}\n\t\t\t\t\t\t\t\t\tshowNextMessage={() => showNextMessage(modelIdx)}\n\t\t\t\t\t\t\t\t\t{updateChat}\n\t\t\t\t\t\t\t\t\t{editMessage}\n\t\t\t\t\t\t\t\t\t{saveMessage}\n\t\t\t\t\t\t\t\t\t{rateMessage}\n\t\t\t\t\t\t\t\t\t{deleteMessage}\n\t\t\t\t\t\t\t\t\t{actionMessage}\n\t\t\t\t\t\t\t\t\t{submitMessage}\n\t\t\t\t\t\t\t\t\t{continueResponse}\n\t\t\t\t\t\t\t\t\tregenerateResponse={async (message) => {\n\t\t\t\t\t\t\t\t\t\tregenerateResponse(message);\n\t\t\t\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\t\t\t\tgroupedMessageIdsIdx[modelIdx] =\n\t\t\t\t\t\t\t\t\t\t\tgroupedMessageIds[modelIdx].messageIds.length - 1;\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t{addMessages}\n\t\t\t\t\t\t\t\t\t{readOnly}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t{/key}\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\t\t\t{/each}\n\t\t</div>\n\n\t\t{#if !readOnly}\n\t\t\t{#if !Object.keys(groupedMessageIds).find((modelIdx) => {\n\t\t\t\tconst { messageIds } = groupedMessageIds[modelIdx];\n\t\t\t\tconst _messageId = messageIds[groupedMessageIdsIdx[modelIdx]];\n\t\t\t\treturn !history.messages[_messageId]?.done ?? false;\n\t\t\t})}\n\t\t\t\t<div class=\"flex justify-end\">\n\t\t\t\t\t<div class=\"w-full\">\n\t\t\t\t\t\t{#if history.messages[messageId]?.merged?.status}\n\t\t\t\t\t\t\t{@const message = history.messages[messageId]?.merged}\n\n\t\t\t\t\t\t\t<div class=\"w-full rounded-xl pl-5 pr-2 py-2\">\n\t\t\t\t\t\t\t\t<Name>\n\t\t\t\t\t\t\t\t\tMerged Response\n\n\t\t\t\t\t\t\t\t\t{#if message.timestamp}\n\t\t\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\t\t\tclass=\" self-center invisible group-hover:visible text-gray-400 text-xs font-medium uppercase ml-0.5 -mt-0.5\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t{dayjs(message.timestamp * 1000).format('LT')}\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t</Name>\n\n\t\t\t\t\t\t\t\t<div class=\"mt-1 markdown-prose w-full min-w-full\">\n\t\t\t\t\t\t\t\t\t{#if (message?.content ?? '') === ''}\n\t\t\t\t\t\t\t\t\t\t<Skeleton />\n\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t<Markdown id={`merged`} content={message.content ?? ''} />\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{#if isLastMessage}\n\t\t\t\t\t\t<div class=\" shrink-0 text-gray-600 dark:text-gray-500 mt-1\">\n\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Merge Responses')} placement=\"bottom\">\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\tid=\"merge-response-button\"\n\t\t\t\t\t\t\t\t\tclass=\"{true\n\t\t\t\t\t\t\t\t\t\t? 'visible'\n\t\t\t\t\t\t\t\t\t\t: 'invisible group-hover:visible'} p-1 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg dark:hover:text-white hover:text-black transition regenerate-response-button\"\n\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\tmergeResponsesHandler();\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<Merge className=\" size-5 \" />\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t{/if}\n\t</div>\n{/if}\n","<script lang=\"ts\">\n\timport dayjs from 'dayjs';\n\timport { toast } from 'svelte-sonner';\n\timport { tick, getContext, onMount } from 'svelte';\n\n\timport { models, settings } from '$lib/stores';\n\timport { user as _user } from '$lib/stores';\n\timport { copyToClipboard as _copyToClipboard, formatDate } from '$lib/utils';\n\n\timport Name from './Name.svelte';\n\timport ProfileImage from './ProfileImage.svelte';\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\n\timport FileItem from '$lib/components/common/FileItem.svelte';\n\timport Markdown from './Markdown.svelte';\n\timport Image from '$lib/components/common/Image.svelte';\n\timport DeleteConfirmDialog from '$lib/components/common/ConfirmDialog.svelte';\n\n\timport localizedFormat from 'dayjs/plugin/localizedFormat';\n\n\tconst i18n = getContext('i18n');\n\tdayjs.extend(localizedFormat);\n\n\texport let user;\n\n\texport let history;\n\texport let messageId;\n\n\texport let siblings;\n\n\texport let showPreviousMessage: Function;\n\texport let showNextMessage: Function;\n\n\texport let editMessage: Function;\n\texport let deleteMessage: Function;\n\n\texport let isFirstMessage: boolean;\n\texport let readOnly: boolean;\n\n\tlet showDeleteConfirm = false;\n\n\tlet edit = false;\n\tlet editedContent = '';\n\tlet messageEditTextAreaElement: HTMLTextAreaElement;\n\n\tlet message = JSON.parse(JSON.stringify(history.messages[messageId]));\n\t$: if (history.messages) {\n\t\tif (JSON.stringify(message) !== JSON.stringify(history.messages[messageId])) {\n\t\t\tmessage = JSON.parse(JSON.stringify(history.messages[messageId]));\n\t\t}\n\t}\n\n\tconst copyToClipboard = async (text) => {\n\t\tconst res = await _copyToClipboard(text);\n\t\tif (res) {\n\t\t\ttoast.success($i18n.t('Copying to clipboard was successful!'));\n\t\t}\n\t};\n\n\tconst editMessageHandler = async () => {\n\t\tedit = true;\n\t\teditedContent = message.content;\n\n\t\tawait tick();\n\n\t\tmessageEditTextAreaElement.style.height = '';\n\t\tmessageEditTextAreaElement.style.height = `${messageEditTextAreaElement.scrollHeight}px`;\n\n\t\tmessageEditTextAreaElement?.focus();\n\t};\n\n\tconst editMessageConfirmHandler = async (submit = true) => {\n\t\teditMessage(message.id, editedContent, submit);\n\n\t\tedit = false;\n\t\teditedContent = '';\n\t};\n\n\tconst cancelEditMessage = () => {\n\t\tedit = false;\n\t\teditedContent = '';\n\t};\n\n\tconst deleteMessageHandler = async () => {\n\t\tdeleteMessage(message.id);\n\t};\n\n\tonMount(() => {\n\t\t// console.log('UserMessage mounted');\n\t});\n</script>\n\n<DeleteConfirmDialog\n\tbind:show={showDeleteConfirm}\n\ttitle={$i18n.t('Delete message?')}\n\ton:confirm={() => {\n\t\tdeleteMessageHandler();\n\t}}\n/>\n\n<div class=\" flex w-full user-message\" dir={$settings.chatDirection} id=\"message-{message.id}\">\n\t{#if !($settings?.chatBubble ?? true)}\n\t\t<div class={`shrink-0 ${($settings?.chatDirection ?? 'LTR') === 'LTR' ? 'mr-3' : 'ml-3'}`}>\n\t\t\t<ProfileImage\n\t\t\t\tsrc={message.user\n\t\t\t\t\t? ($models.find((m) => m.id === message.user)?.info?.meta?.profile_image_url ??\n\t\t\t\t\t\t'/user.png')\n\t\t\t\t\t: (user?.profile_image_url ?? '/user.png')}\n\t\t\t\tclassName={'size-8'}\n\t\t\t/>\n\t\t</div>\n\t{/if}\n\t<div class=\"flex-auto w-0 max-w-full pl-1\">\n\t\t{#if !($settings?.chatBubble ?? true)}\n\t\t\t<div>\n\t\t\t\t<Name>\n\t\t\t\t\t{#if message.user}\n\t\t\t\t\t\t{$i18n.t('You')}\n\t\t\t\t\t\t<span class=\" text-gray-500 text-sm font-medium\">{message?.user ?? ''}</span>\n\t\t\t\t\t{:else if $settings.showUsername || $_user.name !== user.name}\n\t\t\t\t\t\t{user.name}\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t{$i18n.t('You')}\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t{#if message.timestamp}\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\" self-center text-xs invisible group-hover:visible text-gray-400 font-medium first-letter:capitalize ml-0.5 translate-y-[1px]\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Tooltip content={dayjs(message.timestamp * 1000).format('LLLL')}>\n\t\t\t\t\t\t\t\t<span class=\"line-clamp-1\">{formatDate(message.timestamp * 1000)}</span>\n\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/if}\n\t\t\t\t</Name>\n\t\t\t</div>\n\t\t{/if}\n\n\t\t<div class=\"chat-{message.role} w-full min-w-full markdown-prose\">\n\t\t\t{#if message.files}\n\t\t\t\t<div class=\"mt-2.5 mb-1 w-full flex flex-col justify-end overflow-x-auto gap-1 flex-wrap\">\n\t\t\t\t\t{#each message.files as file}\n\t\t\t\t\t\t<div class={($settings?.chatBubble ?? true) ? 'self-end' : ''}>\n\t\t\t\t\t\t\t{#if file.type === 'image'}\n\t\t\t\t\t\t\t\t<Image src={file.url} imageClassName=\" max-h-96 rounded-lg\" />\n\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t<FileItem\n\t\t\t\t\t\t\t\t\titem={file}\n\t\t\t\t\t\t\t\t\turl={file.url}\n\t\t\t\t\t\t\t\t\tname={file.name}\n\t\t\t\t\t\t\t\t\ttype={file.type}\n\t\t\t\t\t\t\t\t\tsize={file?.size}\n\t\t\t\t\t\t\t\t\tcolorClassName=\"bg-white dark:bg-gray-850 \"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/each}\n\t\t\t\t</div>\n\t\t\t{/if}\n\n\t\t\t{#if message.content !== ''}\n\t\t\t\t{#if edit === true}\n\t\t\t\t\t<div class=\" w-full bg-gray-50 dark:bg-gray-800 rounded-3xl px-5 py-3 mb-2\">\n\t\t\t\t\t\t<div class=\"max-h-96 overflow-auto\">\n\t\t\t\t\t\t\t<textarea\n\t\t\t\t\t\t\t\tid=\"message-edit-{message.id}\"\n\t\t\t\t\t\t\t\tbind:this={messageEditTextAreaElement}\n\t\t\t\t\t\t\t\tclass=\" bg-transparent outline-hidden w-full resize-none\"\n\t\t\t\t\t\t\t\tbind:value={editedContent}\n\t\t\t\t\t\t\t\ton:input={(e) => {\n\t\t\t\t\t\t\t\t\te.target.style.height = '';\n\t\t\t\t\t\t\t\t\te.target.style.height = `${e.target.scrollHeight}px`;\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\ton:keydown={(e) => {\n\t\t\t\t\t\t\t\t\tif (e.key === 'Escape') {\n\t\t\t\t\t\t\t\t\t\tdocument.getElementById('close-edit-message-button')?.click();\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tconst isCmdOrCtrlPressed = e.metaKey || e.ctrlKey;\n\t\t\t\t\t\t\t\t\tconst isEnterPressed = e.key === 'Enter';\n\n\t\t\t\t\t\t\t\t\tif (isCmdOrCtrlPressed && isEnterPressed) {\n\t\t\t\t\t\t\t\t\t\tdocument.getElementById('confirm-edit-message-button')?.click();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class=\" mt-2 mb-1 flex justify-between text-sm font-medium\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tid=\"save-edit-message-button\"\n\t\t\t\t\t\t\t\t\tclass=\" px-4 py-2 bg-gray-50 hover:bg-gray-100 dark:bg-gray-800 dark:hover:bg-gray-700 border dark:border-gray-700 text-gray-700 dark:text-gray-200 transition rounded-3xl\"\n\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\teditMessageConfirmHandler(false);\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{$i18n.t('Save')}\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div class=\"flex space-x-1.5\">\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tid=\"close-edit-message-button\"\n\t\t\t\t\t\t\t\t\tclass=\"px-4 py-2 bg-white dark:bg-gray-900 hover:bg-gray-100 text-gray-800 dark:text-gray-100 transition rounded-3xl\"\n\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\tcancelEditMessage();\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{$i18n.t('Cancel')}\n\t\t\t\t\t\t\t\t</button>\n\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tid=\"confirm-edit-message-button\"\n\t\t\t\t\t\t\t\t\tclass=\" px-4 py-2 bg-gray-900 dark:bg-white hover:bg-gray-850 text-gray-100 dark:text-gray-800 transition rounded-3xl\"\n\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\teditMessageConfirmHandler();\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{$i18n.t('Send')}\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t{:else}\n\t\t\t\t\t<div class=\"w-full\">\n\t\t\t\t\t\t<div class=\"flex {($settings?.chatBubble ?? true) ? 'justify-end pb-1' : 'w-full'}\">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\"rounded-3xl {($settings?.chatBubble ?? true)\n\t\t\t\t\t\t\t\t\t? `max-w-[90%] px-5 py-2  bg-gray-50 dark:bg-gray-850 ${\n\t\t\t\t\t\t\t\t\t\t\tmessage.files ? 'rounded-tr-lg' : ''\n\t\t\t\t\t\t\t\t\t\t}`\n\t\t\t\t\t\t\t\t\t: ' w-full'}\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{#if message.content}\n\t\t\t\t\t\t\t\t\t<Markdown id={message.id} content={message.content} />\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\" flex {($settings?.chatBubble ?? true)\n\t\t\t\t\t\t\t\t? 'justify-end'\n\t\t\t\t\t\t\t\t: ''}  text-gray-600 dark:text-gray-500\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{#if !($settings?.chatBubble ?? true)}\n\t\t\t\t\t\t\t\t{#if siblings.length > 1}\n\t\t\t\t\t\t\t\t\t<div class=\"flex self-center\" dir=\"ltr\">\n\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\tclass=\"self-center p-1 hover:bg-black/5 dark:hover:bg-white/5 dark:hover:text-white hover:text-black rounded-md transition\"\n\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\tshowPreviousMessage(message);\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\tstroke-width=\"2.5\"\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"size-3.5\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M15.75 19.5 8.25 12l7.5-7.5\"\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t</button>\n\n\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\tclass=\"text-sm tracking-widest font-semibold self-center dark:text-gray-100\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t{siblings.indexOf(message.id) + 1}/{siblings.length}\n\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\tclass=\"self-center p-1 hover:bg-black/5 dark:hover:bg-white/5 dark:hover:text-white hover:text-black rounded-md transition\"\n\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\tshowNextMessage(message);\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\tstroke-width=\"2.5\"\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"size-3.5\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\td=\"m8.25 4.5 7.5 7.5-7.5 7.5\"\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t{#if !readOnly}\n\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Edit')} placement=\"bottom\">\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\tclass=\"invisible group-hover:visible p-1.5 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg dark:hover:text-white hover:text-black transition edit-user-message-button\"\n\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\teditMessageHandler();\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\tstroke-width=\"2.3\"\n\t\t\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\tclass=\"w-4 h-4\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\td=\"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125\"\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Copy')} placement=\"bottom\">\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tclass=\"invisible group-hover:visible p-1.5 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg dark:hover:text-white hover:text-black transition\"\n\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\tcopyToClipboard(message.content);\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\tstroke-width=\"2.3\"\n\t\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\tclass=\"w-4 h-4\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\t\td=\"M15.666 3.888A2.25 2.25 0 0013.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 01-.75.75H9a.75.75 0 01-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 01-2.25 2.25H6.75A2.25 2.25 0 014.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 011.927-.184\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t\t\t{#if !isFirstMessage && !readOnly}\n\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Delete')} placement=\"bottom\">\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\tclass=\"invisible group-hover:visible p-1 rounded-sm dark:hover:text-white hover:text-black transition\"\n\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\tshowDeleteConfirm = true;\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\tclass=\"w-4 h-4\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\td=\"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0\"\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t{#if $settings?.chatBubble ?? true}\n\t\t\t\t\t\t\t\t{#if siblings.length > 1}\n\t\t\t\t\t\t\t\t\t<div class=\"flex self-center\" dir=\"ltr\">\n\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\tclass=\"self-center p-1 hover:bg-black/5 dark:hover:bg-white/5 dark:hover:text-white hover:text-black rounded-md transition\"\n\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\tshowPreviousMessage(message);\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\tstroke-width=\"2.5\"\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"size-3.5\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M15.75 19.5 8.25 12l7.5-7.5\"\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t</button>\n\n\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\tclass=\"text-sm tracking-widest font-semibold self-center dark:text-gray-100\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t{siblings.indexOf(message.id) + 1}/{siblings.length}\n\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\tclass=\"self-center p-1 hover:bg-black/5 dark:hover:bg-white/5 dark:hover:text-white hover:text-black rounded-md transition\"\n\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\tshowNextMessage(message);\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\tstroke-width=\"2.5\"\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"size-3.5\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\td=\"m8.25 4.5 7.5 7.5-7.5 7.5\"\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\t\t\t{/if}\n\t\t</div>\n\t</div>\n</div>\n","<script lang=\"ts\">\n\timport { toast } from 'svelte-sonner';\n\n\timport { tick, getContext, onMount, createEventDispatcher } from 'svelte';\n\tconst dispatch = createEventDispatcher();\n\tconst i18n = getContext('i18n');\n\n\timport { settings } from '$lib/stores';\n\timport { copyToClipboard } from '$lib/utils';\n\n\timport MultiResponseMessages from './MultiResponseMessages.svelte';\n\timport ResponseMessage from './ResponseMessage.svelte';\n\timport UserMessage from './UserMessage.svelte';\n\n\texport let chatId;\n\texport let idx = 0;\n\n\texport let history;\n\texport let messageId;\n\n\texport let user;\n\n\texport let showPreviousMessage;\n\texport let showNextMessage;\n\texport let updateChat;\n\n\texport let editMessage;\n\texport let saveMessage;\n\texport let deleteMessage;\n\texport let rateMessage;\n\texport let actionMessage;\n\texport let submitMessage;\n\n\texport let regenerateResponse;\n\texport let continueResponse;\n\texport let mergeResponses;\n\n\texport let addMessages;\n\texport let triggerScroll;\n\texport let readOnly = false;\n</script>\n\n<div\n\tclass=\"flex flex-col justify-between px-5 mb-3 w-full {($settings?.widescreenMode ?? null)\n\t\t? 'max-w-full'\n\t\t: 'max-w-5xl'} mx-auto rounded-lg group\"\n>\n\t{#if history.messages[messageId]}\n\t\t{#if history.messages[messageId].role === 'user'}\n\t\t\t<UserMessage\n\t\t\t\t{user}\n\t\t\t\t{history}\n\t\t\t\t{messageId}\n\t\t\t\tisFirstMessage={idx === 0}\n\t\t\t\tsiblings={history.messages[messageId].parentId !== null\n\t\t\t\t\t? (history.messages[history.messages[messageId].parentId]?.childrenIds ?? [])\n\t\t\t\t\t: (Object.values(history.messages)\n\t\t\t\t\t\t\t.filter((message) => message.parentId === null)\n\t\t\t\t\t\t\t.map((message) => message.id) ?? [])}\n\t\t\t\t{showPreviousMessage}\n\t\t\t\t{showNextMessage}\n\t\t\t\t{editMessage}\n\t\t\t\t{deleteMessage}\n\t\t\t\t{readOnly}\n\t\t\t/>\n\t\t{:else if (history.messages[history.messages[messageId].parentId]?.models?.length ?? 1) === 1}\n\t\t\t<ResponseMessage\n\t\t\t\t{chatId}\n\t\t\t\t{history}\n\t\t\t\t{messageId}\n\t\t\t\tisLastMessage={messageId === history.currentId}\n\t\t\t\tsiblings={history.messages[history.messages[messageId].parentId]?.childrenIds ?? []}\n\t\t\t\t{showPreviousMessage}\n\t\t\t\t{showNextMessage}\n\t\t\t\t{updateChat}\n\t\t\t\t{editMessage}\n\t\t\t\t{saveMessage}\n\t\t\t\t{rateMessage}\n\t\t\t\t{actionMessage}\n\t\t\t\t{submitMessage}\n\t\t\t\t{deleteMessage}\n\t\t\t\t{continueResponse}\n\t\t\t\t{regenerateResponse}\n\t\t\t\t{addMessages}\n\t\t\t\t{readOnly}\n\t\t\t/>\n\t\t{:else}\n\t\t\t<MultiResponseMessages\n\t\t\t\tbind:history\n\t\t\t\t{chatId}\n\t\t\t\t{messageId}\n\t\t\t\tisLastMessage={messageId === history?.currentId}\n\t\t\t\t{updateChat}\n\t\t\t\t{editMessage}\n\t\t\t\t{saveMessage}\n\t\t\t\t{rateMessage}\n\t\t\t\t{actionMessage}\n\t\t\t\t{submitMessage}\n\t\t\t\t{deleteMessage}\n\t\t\t\t{continueResponse}\n\t\t\t\t{regenerateResponse}\n\t\t\t\t{mergeResponses}\n\t\t\t\t{triggerScroll}\n\t\t\t\t{addMessages}\n\t\t\t\t{readOnly}\n\t\t\t/>\n\t\t{/if}\n\t{/if}\n</div>\n","<script lang=\"ts\">\n\texport let className = 'w-4 h-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n>\n\t<path\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t\td=\"M3.98 8.223A10.477 10.477 0 0 0 1.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.451 10.451 0 0 1 12 4.5c4.756 0 8.773 3.162 10.065 7.498a10.522 10.522 0 0 1-4.293 5.774M6.228 6.228 3 3m3.228 3.228 3.65 3.65m7.894 7.894L21 21m-3.228-3.228-3.65-3.65m0 0a3 3 0 1 0-4.243-4.243m4.242 4.242L9.88 9.88\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\timport { WEBUI_BASE_URL } from '$lib/constants';\n\timport { marked } from 'marked';\n\n\timport { config, user, models as _models, temporaryChatEnabled } from '$lib/stores';\n\timport { onMount, getContext } from 'svelte';\n\n\timport { blur, fade } from 'svelte/transition';\n\n\timport Suggestions from './Suggestions.svelte';\n\timport { sanitizeResponseContent } from '$lib/utils';\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\n\timport EyeSlash from '$lib/components/icons/EyeSlash.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let modelIds = [];\n\texport let models = [];\n\texport let atSelectedModel;\n\n\texport let submitPrompt;\n\n\tlet mounted = false;\n\tlet selectedModelIdx = 0;\n\n\t$: if (modelIds.length > 0) {\n\t\tselectedModelIdx = models.length - 1;\n\t}\n\n\t$: models = modelIds.map((id) => $_models.find((m) => m.id === id));\n\n\tonMount(() => {\n\t\tmounted = true;\n\t});\n</script>\n\n{#key mounted}\n\t<div class=\"m-auto w-full max-w-6xl px-8 lg:px-20\">\n\t\t<div class=\"flex justify-start\">\n\t\t\t<div class=\"flex -space-x-4 mb-0.5\" in:fade={{ duration: 200 }}>\n\t\t\t\t{#each models as model, modelIdx}\n\t\t\t\t\t<button\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\tselectedModelIdx = modelIdx;\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<Tooltip\n\t\t\t\t\t\t\tcontent={marked.parse(\n\t\t\t\t\t\t\t\tsanitizeResponseContent(models[selectedModelIdx]?.info?.meta?.description ?? '')\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\tplacement=\"right\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\tcrossorigin=\"anonymous\"\n\t\t\t\t\t\t\t\tsrc={model?.info?.meta?.profile_image_url ??\n\t\t\t\t\t\t\t\t\t($i18n.language === 'dg-DG'\n\t\t\t\t\t\t\t\t\t\t? `/doge.png`\n\t\t\t\t\t\t\t\t\t\t: `static/favicon.png`)}\n\t\t\t\t\t\t\t\tclass=\" size-[2.7rem] rounded-full border-[1px] border-gray-200 dark:border-none\"\n\t\t\t\t\t\t\t\talt=\"logo\"\n\t\t\t\t\t\t\t\tdraggable=\"false\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t</button>\n\t\t\t\t{/each}\n\t\t\t</div>\n\t\t</div>\n\n\t\t{#if $temporaryChatEnabled}\n\t\t\t<Tooltip\n\t\t\t\tcontent=\"This chat won't appear in history and your messages will not be saved.\"\n\t\t\t\tclassName=\"w-fit\"\n\t\t\t\tplacement=\"top-start\"\n\t\t\t>\n\t\t\t\t<div class=\"flex items-center gap-2 text-gray-500 font-medium text-lg my-2 w-fit\">\n\t\t\t\t\t<EyeSlash strokeWidth=\"2.5\" className=\"size-5\" /> Temporary Chat\n\t\t\t\t</div>\n\t\t\t</Tooltip>\n\t\t{/if}\n\n\t\t<div\n\t\t\tclass=\" mt-2 mb-4 text-3xl text-gray-800 dark:text-gray-100 font-medium text-left flex items-center gap-4 font-primary\"\n\t\t>\n\t\t\t<div>\n\t\t\t\t<div class=\" capitalize line-clamp-1\" in:fade={{ duration: 200 }}>\n\t\t\t\t\t{#if models[selectedModelIdx]?.name}\n\t\t\t\t\t\t{models[selectedModelIdx]?.name}\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t{$i18n.t('Hello, {{name}}', { name: $user.name })}\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\n\t\t\t\t<div in:fade={{ duration: 200, delay: 200 }}>\n\t\t\t\t\t{#if models[selectedModelIdx]?.info?.meta?.description ?? null}\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\"mt-0.5 text-base font-normal text-gray-500 dark:text-gray-400 line-clamp-3 markdown\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{@html marked.parse(\n\t\t\t\t\t\t\t\tsanitizeResponseContent(models[selectedModelIdx]?.info?.meta?.description)\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{#if models[selectedModelIdx]?.info?.meta?.user}\n\t\t\t\t\t\t\t<div class=\"mt-0.5 text-sm font-normal text-gray-400 dark:text-gray-500\">\n\t\t\t\t\t\t\t\tBy\n\t\t\t\t\t\t\t\t{#if models[selectedModelIdx]?.info?.meta?.user.community}\n\t\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\t\thref=\"https://openwebui.com/m/{models[selectedModelIdx]?.info?.meta?.user\n\t\t\t\t\t\t\t\t\t\t\t.username}\"\n\t\t\t\t\t\t\t\t\t\t>{models[selectedModelIdx]?.info?.meta?.user.name\n\t\t\t\t\t\t\t\t\t\t\t? models[selectedModelIdx]?.info?.meta?.user.name\n\t\t\t\t\t\t\t\t\t\t\t: `@${models[selectedModelIdx]?.info?.meta?.user.username}`}</a\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t{models[selectedModelIdx]?.info?.meta?.user.name}\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<div class=\" font-medium text-gray-400 dark:text-gray-500 line-clamp-1 font-p\">\n\t\t\t\t\t\t\t{$i18n.t('How can I help you today?')}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t\t<span class=\"text-lg\">\n\t\t\t\t\t{$i18n.t(\"Hi! I'm Kneron Analytics Agent, your financial analysis assistant. I can analyze statements, identify trends, calculate metrics and generate reports. What financial data would you like to examine - balance sheets, income statements, cash flows, or other information?\")}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<!-- <div class=\" w-full font-primary\" in:fade={{ duration: 200, delay: 300 }}>\n\t\t\t<Suggestions\n\t\t\t\tclassName=\"grid grid-cols-2\"\n\t\t\t\tsuggestionPrompts={atSelectedModel?.info?.meta?.suggestion_prompts ??\n\t\t\t\t\tmodels[selectedModelIdx]?.info?.meta?.suggestion_prompts ??\n\t\t\t\t\t$config?.default_prompt_suggestions ??\n\t\t\t\t\t[]}\n\t\t\t\ton:select={(e) => {\n\t\t\t\t\tsubmitPrompt(e.detail);\n\t\t\t\t}}\n\t\t\t/>\n\t\t</div> -->\n\t</div>\n{/key}\n","<script lang=\"ts\">\n\timport { v4 as uuidv4 } from 'uuid';\n\timport {\n\t\tchats,\n\t\tconfig,\n\t\tsettings,\n\t\tuser as _user,\n\t\tmobile,\n\t\tcurrentChatPage,\n\t\ttemporaryChatEnabled\n\t} from '$lib/stores';\n\timport { tick, getContext, onMount, createEventDispatcher } from 'svelte';\n\tconst dispatch = createEventDispatcher();\n\n\timport { toast } from 'svelte-sonner';\n\timport { getChatList, updateChatById } from '$lib/apis/chats';\n\timport { copyToClipboard, findWordIndices } from '$lib/utils';\n\n\timport Message from './Messages/Message.svelte';\n\timport Loader from '../common/Loader.svelte';\n\timport Spinner from '../common/Spinner.svelte';\n\n\timport ChatPlaceholder from './ChatPlaceholder.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let className = 'h-full flex pt-8';\n\n\texport let chatId = '';\n\texport let user = $_user;\n\n\texport let prompt;\n\texport let history = {};\n\texport let selectedModels;\n\texport let atSelectedModel;\n\n\tlet messages = [];\n\n\texport let sendPrompt: Function;\n\texport let continueResponse: Function;\n\texport let regenerateResponse: Function;\n\texport let mergeResponses: Function;\n\n\texport let chatActionHandler: Function;\n\texport let showMessage: Function = () => {};\n\texport let submitMessage: Function = () => {};\n\texport let addMessages: Function = () => {};\n\n\texport let readOnly = false;\n\n\texport let bottomPadding = false;\n\texport let autoScroll;\n\n\tlet messagesCount = 20;\n\tlet messagesLoading = false;\n\n\tconst loadMoreMessages = async () => {\n\t\t// scroll slightly down to disable continuous loading\n\t\tconst element = document.getElementById('messages-container');\n\t\telement.scrollTop = element.scrollTop + 100;\n\n\t\tmessagesLoading = true;\n\t\tmessagesCount += 20;\n\n\t\tawait tick();\n\n\t\tmessagesLoading = false;\n\t};\n\n\t$: if (history.currentId) {\n\t\tlet _messages = [];\n\t\t\n\t\t// Get all messages and sort them chronologically\n\t\tif (history.messages) {\n\t\t\t_messages = Object.values(history.messages)\n\t\t\t\t.sort((a: any, b: any) => {\n\t\t\t\t\t// First try to sort by timestamp if available\n\t\t\t\t\tif (a.timestamp && b.timestamp) {\n\t\t\t\t\t\treturn a.timestamp - b.timestamp;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// If timestamps aren't available, use parent-child relationships\n\t\t\t\t\t// Messages with no parent (root messages) come first\n\t\t\t\t\tif (a.parentId === null && b.parentId !== null) return -1;\n\t\t\t\t\tif (a.parentId !== null && b.parentId === null) return 1;\n\t\t\t\t\t\n\t\t\t\t\t// For messages with the same parent status, preserve existing order\n\t\t\t\t\treturn 0;\n\t\t\t\t});\n\t\t\t\n\t\t\t// Limit to messagesCount if needed\n\t\t\tif (_messages.length > messagesCount) {\n\t\t\t\t_messages = _messages.slice(-messagesCount);\n\t\t\t}\n\t\t}\n\t\t\n\t\tmessages = _messages;\n\t} else {\n\t\tmessages = [];\n\t}\n\n\t$: if (autoScroll && bottomPadding) {\n\t\t(async () => {\n\t\t\tawait tick();\n\t\t\tscrollToBottom();\n\t\t})();\n\t}\n\n\tconst scrollToBottom = () => {\n\t\tconst element = document.getElementById('messages-container');\n\t\telement.scrollTop = element.scrollHeight;\n\t};\n\n\tconst updateChat = async () => {\n\t\tif (!$temporaryChatEnabled) {\n\t\t\thistory = history;\n\t\t\tawait tick();\n\t\t\tawait updateChatById(localStorage.token, chatId, {\n\t\t\t\thistory: history,\n\t\t\t\tmessages: messages\n\t\t\t});\n\n\t\t\tcurrentChatPage.set(1);\n\t\t\tawait chats.set(await getChatList(localStorage.token, $currentChatPage));\n\t\t}\n\t};\n\n\tconst showPreviousMessage = async (message) => {\n\t\tif (message.parentId !== null) {\n\t\t\tlet messageId =\n\t\t\t\thistory.messages[message.parentId].childrenIds[\n\t\t\t\t\tMath.max(history.messages[message.parentId].childrenIds.indexOf(message.id) - 1, 0)\n\t\t\t\t];\n\n\t\t\tif (message.id !== messageId) {\n\t\t\t\tlet messageChildrenIds = history.messages[messageId].childrenIds;\n\n\t\t\t\twhile (messageChildrenIds.length !== 0) {\n\t\t\t\t\tmessageId = messageChildrenIds.at(-1);\n\t\t\t\t\tmessageChildrenIds = history.messages[messageId].childrenIds;\n\t\t\t\t}\n\n\t\t\t\thistory.currentId = messageId;\n\t\t\t}\n\t\t} else {\n\t\t\tlet childrenIds = Object.values(history.messages)\n\t\t\t\t.filter((message) => message.parentId === null)\n\t\t\t\t.map((message) => message.id);\n\t\t\tlet messageId = childrenIds[Math.max(childrenIds.indexOf(message.id) - 1, 0)];\n\n\t\t\tif (message.id !== messageId) {\n\t\t\t\tlet messageChildrenIds = history.messages[messageId].childrenIds;\n\n\t\t\t\twhile (messageChildrenIds.length !== 0) {\n\t\t\t\t\tmessageId = messageChildrenIds.at(-1);\n\t\t\t\t\tmessageChildrenIds = history.messages[messageId].childrenIds;\n\t\t\t\t}\n\n\t\t\t\thistory.currentId = messageId;\n\t\t\t}\n\t\t}\n\n\t\tawait tick();\n\n\t\tif ($settings?.scrollOnBranchChange ?? true) {\n\t\t\tconst element = document.getElementById('messages-container');\n\t\t\tautoScroll = element.scrollHeight - element.scrollTop <= element.clientHeight + 50;\n\n\t\t\tsetTimeout(() => {\n\t\t\t\tscrollToBottom();\n\t\t\t}, 100);\n\t\t}\n\t};\n\n\tconst showNextMessage = async (message) => {\n\t\tif (message.parentId !== null) {\n\t\t\tlet messageId =\n\t\t\t\thistory.messages[message.parentId].childrenIds[\n\t\t\t\t\tMath.min(\n\t\t\t\t\t\thistory.messages[message.parentId].childrenIds.indexOf(message.id) + 1,\n\t\t\t\t\t\thistory.messages[message.parentId].childrenIds.length - 1\n\t\t\t\t\t)\n\t\t\t\t];\n\n\t\t\tif (message.id !== messageId) {\n\t\t\t\tlet messageChildrenIds = history.messages[messageId].childrenIds;\n\n\t\t\t\twhile (messageChildrenIds.length !== 0) {\n\t\t\t\t\tmessageId = messageChildrenIds.at(-1);\n\t\t\t\t\tmessageChildrenIds = history.messages[messageId].childrenIds;\n\t\t\t\t}\n\n\t\t\t\thistory.currentId = messageId;\n\t\t\t}\n\t\t} else {\n\t\t\tlet childrenIds = Object.values(history.messages)\n\t\t\t\t.filter((message) => message.parentId === null)\n\t\t\t\t.map((message) => message.id);\n\t\t\tlet messageId =\n\t\t\t\tchildrenIds[Math.min(childrenIds.indexOf(message.id) + 1, childrenIds.length - 1)];\n\n\t\t\tif (message.id !== messageId) {\n\t\t\t\tlet messageChildrenIds = history.messages[messageId].childrenIds;\n\n\t\t\t\twhile (messageChildrenIds.length !== 0) {\n\t\t\t\t\tmessageId = messageChildrenIds.at(-1);\n\t\t\t\t\tmessageChildrenIds = history.messages[messageId].childrenIds;\n\t\t\t\t}\n\n\t\t\t\thistory.currentId = messageId;\n\t\t\t}\n\t\t}\n\n\t\tawait tick();\n\n\t\tif ($settings?.scrollOnBranchChange ?? true) {\n\t\t\tconst element = document.getElementById('messages-container');\n\t\t\tautoScroll = element.scrollHeight - element.scrollTop <= element.clientHeight + 50;\n\n\t\t\tsetTimeout(() => {\n\t\t\t\tscrollToBottom();\n\t\t\t}, 100);\n\t\t}\n\t};\n\n\tconst rateMessage = async (messageId, rating) => {\n\t\thistory.messages[messageId].annotation = {\n\t\t\t...history.messages[messageId].annotation,\n\t\t\trating: rating\n\t\t};\n\n\t\tawait updateChat();\n\t};\n\n\tconst editMessage = async (messageId, content, submit = true) => {\n\t\tif (history.messages[messageId].role === 'user') {\n\t\t\tif (submit) {\n\t\t\t\t// New user message\n\t\t\t\tlet userPrompt = content;\n\t\t\t\tlet userMessageId = uuidv4();\n\n\t\t\t\tlet userMessage = {\n\t\t\t\t\tid: userMessageId,\n\t\t\t\t\tparentId: history.messages[messageId].parentId,\n\t\t\t\t\tchildrenIds: [],\n\t\t\t\t\trole: 'user',\n\t\t\t\t\tcontent: userPrompt,\n\t\t\t\t\t...(history.messages[messageId].files && { files: history.messages[messageId].files }),\n\t\t\t\t\tmodels: selectedModels\n\t\t\t\t};\n\n\t\t\t\tlet messageParentId = history.messages[messageId].parentId;\n\n\t\t\t\tif (messageParentId !== null) {\n\t\t\t\t\thistory.messages[messageParentId].childrenIds = [\n\t\t\t\t\t\t...history.messages[messageParentId].childrenIds,\n\t\t\t\t\t\tuserMessageId\n\t\t\t\t\t];\n\t\t\t\t}\n\n\t\t\t\thistory.messages[userMessageId] = userMessage;\n\t\t\t\thistory.currentId = userMessageId;\n\n\t\t\t\tawait tick();\n\t\t\t\tawait sendPrompt(history, userPrompt, userMessageId);\n\t\t\t} else {\n\t\t\t\t// Edit user message\n\t\t\t\thistory.messages[messageId].content = content;\n\t\t\t\tawait updateChat();\n\t\t\t}\n\t\t} else {\n\t\t\tif (submit) {\n\t\t\t\t// New response message\n\t\t\t\tconst responseMessageId = uuidv4();\n\t\t\t\tconst message = history.messages[messageId];\n\t\t\t\tconst parentId = message.parentId;\n\n\t\t\t\tconst responseMessage = {\n\t\t\t\t\t...message,\n\t\t\t\t\tid: responseMessageId,\n\t\t\t\t\tparentId: parentId,\n\t\t\t\t\tchildrenIds: [],\n\t\t\t\t\tfiles: undefined,\n\t\t\t\t\tcontent: content,\n\t\t\t\t\ttimestamp: Math.floor(Date.now() / 1000) // Unix epoch\n\t\t\t\t};\n\n\t\t\t\thistory.messages[responseMessageId] = responseMessage;\n\t\t\t\thistory.currentId = responseMessageId;\n\n\t\t\t\t// Append messageId to childrenIds of parent message\n\t\t\t\tif (parentId !== null) {\n\t\t\t\t\thistory.messages[parentId].childrenIds = [\n\t\t\t\t\t\t...history.messages[parentId].childrenIds,\n\t\t\t\t\t\tresponseMessageId\n\t\t\t\t\t];\n\t\t\t\t}\n\n\t\t\t\tawait updateChat();\n\t\t\t} else {\n\t\t\t\t// Edit response message\n\t\t\t\thistory.messages[messageId].originalContent = history.messages[messageId].content;\n\t\t\t\thistory.messages[messageId].content = content;\n\t\t\t\tawait updateChat();\n\t\t\t}\n\t\t}\n\t};\n\n\tconst actionMessage = async (actionId, message, event = null) => {\n\t\tawait chatActionHandler(chatId, actionId, message.model, message.id, event);\n\t};\n\n\tconst saveMessage = async (messageId, message) => {\n\t\thistory.messages[messageId] = message;\n\t\tawait updateChat();\n\t};\n\n\tconst deleteMessage = async (messageId) => {\n\t\tconst messageToDelete = history.messages[messageId];\n\t\tconst parentMessageId = messageToDelete.parentId;\n\t\tconst childMessageIds = messageToDelete.childrenIds ?? [];\n\n\t\t// Collect all grandchildren\n\t\tconst grandchildrenIds = childMessageIds.flatMap(\n\t\t\t(childId) => history.messages[childId]?.childrenIds ?? []\n\t\t);\n\n\t\t// Update parent's children\n\t\tif (parentMessageId && history.messages[parentMessageId]) {\n\t\t\thistory.messages[parentMessageId].childrenIds = [\n\t\t\t\t...history.messages[parentMessageId].childrenIds.filter((id) => id !== messageId),\n\t\t\t\t...grandchildrenIds\n\t\t\t];\n\t\t}\n\n\t\t// Update grandchildren's parent\n\t\tgrandchildrenIds.forEach((grandchildId) => {\n\t\t\tif (history.messages[grandchildId]) {\n\t\t\t\thistory.messages[grandchildId].parentId = parentMessageId;\n\t\t\t}\n\t\t});\n\n\t\t// Delete the message and its children\n\t\t[messageId, ...childMessageIds].forEach((id) => {\n\t\t\tdelete history.messages[id];\n\t\t});\n\n\t\tawait tick();\n\n\t\tshowMessage({ id: parentMessageId });\n\n\t\t// Update the chat\n\t\tawait updateChat();\n\t};\n\n\tconst triggerScroll = () => {\n\t\tif (autoScroll) {\n\t\t\tconst element = document.getElementById('messages-container');\n\t\t\tautoScroll = element.scrollHeight - element.scrollTop <= element.clientHeight + 50;\n\t\t\tsetTimeout(() => {\n\t\t\t\tscrollToBottom();\n\t\t\t}, 100);\n\t\t}\n\t};\n</script>\n\n<div class={className}>\n\t{#if Object.keys(history?.messages ?? {}).length == 0}\n\t\t<ChatPlaceholder\n\t\t\tmodelIds={selectedModels}\n\t\t\t{atSelectedModel}\n\t\t\tsubmitPrompt={async (p) => {\n\t\t\t\tlet text = p;\n\n\t\t\t\tif (p.includes('{{CLIPBOARD}}')) {\n\t\t\t\t\tconst clipboardText = await navigator.clipboard.readText().catch((err) => {\n\t\t\t\t\t\ttoast.error($i18n.t('Failed to read clipboard contents'));\n\t\t\t\t\t\treturn '{{CLIPBOARD}}';\n\t\t\t\t\t});\n\n\t\t\t\t\ttext = p.replaceAll('{{CLIPBOARD}}', clipboardText);\n\t\t\t\t}\n\n\t\t\t\tprompt = text;\n\n\t\t\t\tawait tick();\n\n\t\t\t\tconst chatInputContainerElement = document.getElementById('chat-input-container');\n\t\t\t\tif (chatInputContainerElement) {\n\t\t\t\t\tprompt = p;\n\n\t\t\t\t\tchatInputContainerElement.style.height = '';\n\t\t\t\t\tchatInputContainerElement.style.height =\n\t\t\t\t\t\tMath.min(chatInputContainerElement.scrollHeight, 200) + 'px';\n\t\t\t\t\tchatInputContainerElement.focus();\n\t\t\t\t}\n\n\t\t\t\tawait tick();\n\t\t\t}}\n\t\t/>\n\t{:else}\n\t\t<div class=\"w-full pt-2\">\n\t\t\t{#key chatId}\n\t\t\t\t<div class=\"w-full\">\n\t\t\t\t\t{#if messages.at(0)?.parentId !== null}\n\t\t\t\t\t\t<Loader\n\t\t\t\t\t\t\ton:visible={(e) => {\n\t\t\t\t\t\t\t\tconsole.log('visible');\n\t\t\t\t\t\t\t\tif (!messagesLoading) {\n\t\t\t\t\t\t\t\t\tloadMoreMessages();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class=\"w-full flex justify-center py-1 text-xs animate-pulse items-center gap-2\">\n\t\t\t\t\t\t\t\t<Spinner className=\" size-4\" />\n\t\t\t\t\t\t\t\t<div class=\" \">Loading...</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</Loader>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t{#each messages as message, messageIdx (message.id)}\n\t\t\t\t\t\t<Message\n\t\t\t\t\t\t\t{chatId}\n\t\t\t\t\t\t\tbind:history\n\t\t\t\t\t\t\tmessageId={message.id}\n\t\t\t\t\t\t\tidx={messageIdx}\n\t\t\t\t\t\t\t{user}\n\t\t\t\t\t\t\t{showPreviousMessage}\n\t\t\t\t\t\t\t{showNextMessage}\n\t\t\t\t\t\t\t{updateChat}\n\t\t\t\t\t\t\t{editMessage}\n\t\t\t\t\t\t\t{deleteMessage}\n\t\t\t\t\t\t\t{rateMessage}\n\t\t\t\t\t\t\t{actionMessage}\n\t\t\t\t\t\t\t{saveMessage}\n\t\t\t\t\t\t\t{submitMessage}\n\t\t\t\t\t\t\t{regenerateResponse}\n\t\t\t\t\t\t\t{continueResponse}\n\t\t\t\t\t\t\t{mergeResponses}\n\t\t\t\t\t\t\t{addMessages}\n\t\t\t\t\t\t\t{triggerScroll}\n\t\t\t\t\t\t\t{readOnly}\n\t\t\t\t\t\t/>\n\t\t\t\t\t{/each}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"pb-12\" />\n\t\t\t\t{#if bottomPadding}\n\t\t\t\t\t<div class=\"  pb-6\" />\n\t\t\t\t{/if}\n\t\t\t{/key}\n\t\t</div>\n\t{/if}\n</div>\n"],"names":["tags","document","sources","id","chatId","user","models","message","uuidv4"],"mappings":"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"}