{"version":3,"file":"_page.svelte.js","sources":["../../../../../../../node_modules/svelte-chartjs/dist/utils/svelte.js","../../../../../../../node_modules/svelte-chartjs/dist/Chart.svelte","../../../../../../../src/routes/(app)/analysis-chat/+page.svelte"],"sourcesContent":["import { SvelteComponent, bubble, listen, current_component, } from 'svelte/internal';\nimport { onMount, onDestroy } from 'svelte';\nconst eventPrefix = /^on/;\nconst events = [];\nObject.keys(globalThis).forEach(key => {\n    if (eventPrefix.test(key)) {\n        events.push(key.replace(eventPrefix, ''));\n    }\n});\nexport function useForwardEvents(getRef) {\n    const component = current_component;\n    const destructors = [];\n    function forward(e) {\n        bubble(component, e);\n    }\n    onMount(() => {\n        const ref = getRef();\n        events.forEach(ref instanceof Element\n            ? event => destructors.push(listen(ref, event, forward))\n            : event => destructors.push(ref.$on(event, forward)));\n    });\n    onDestroy(() => {\n        while (destructors.length) {\n            destructors.pop()();\n        }\n    });\n}\n","<script>import { onMount, afterUpdate, onDestroy } from \"svelte\";\nimport { Chart as ChartJS } from \"chart.js\";\nimport { useForwardEvents } from \"./utils/index.js\";\nfunction clean(props2) {\n  let { data: data2, type: type2, options: options2, plugins: plugins2, children, $$scope, $$slots, ...rest } = props2;\n  return rest;\n}\nexport let type;\nexport let data = {\n  datasets: []\n};\nexport let options = {};\nexport let plugins = [];\nexport let updateMode = void 0;\nexport let chart = null;\nlet canvasRef;\nlet props = clean($$props);\nonMount(() => {\n  chart = new ChartJS(canvasRef, {\n    type,\n    data,\n    options,\n    plugins\n  });\n});\nafterUpdate(() => {\n  if (!chart)\n    return;\n  chart.data = data;\n  Object.assign(chart.options, options);\n  chart.update(updateMode);\n});\nonDestroy(() => {\n  if (chart)\n    chart.destroy();\n  chart = null;\n});\nuseForwardEvents(() => canvasRef);\n</script>\n\n<canvas bind:this={canvasRef} {...props} />\n","<script lang=\"ts\">\n\timport { onMount } from 'svelte';\n\timport { goto } from '$app/navigation';\n\timport { get, writable } from 'svelte/store';\n\timport { user, showSidebar } from '$lib/stores';\n\timport i18n from '$lib/i18n';\n\timport { Chart } from 'svelte-chartjs';\n\timport type { ChartData, ChartTypeRegistry } from 'chart.js';\n\timport {\n\t\tChart as ChartJS,\n\t\tLineController,\n\t\tLineElement,\n\t\tPointElement,\n\t\tLinearScale,\n\t\tTitle,\n\t\tCategoryScale,\n\t\tTooltip,\n\t\tLegend\n\t} from 'chart.js';\n\timport Table from '$lib/components/common/Table.svelte';\n\timport { createDocxTemplateReport, downloadDocxDocument } from '$lib/utils/docxTemplateUtils';\n\timport { WEBUI_BASE_URL } from '$lib/constants';\n\timport { getApiConfig } from '$lib/utils/api-config';\n\n\t// Initialize API config\n\tlet apiConfig = {\n\t\tbaseUrl: WEBUI_BASE_URL,\n\t\tuserToken: '',\n\t\tlanguageLocal: 'en'\n\t};\n\n\tChartJS.register(\n\t\tLineController,\n\t\tLineElement,\n\t\tPointElement,\n\t\tLinearScale,\n\t\tTitle,\n\t\tCategoryScale,\n\t\tTooltip,\n\t\tLegend\n\t);\n\n\tinterface Message {\n\t\trole: string;\n\t\tcontent: string;\n\t\tmetadata?: any;\n\t\tresults?: {\n\t\t\tcolumns: string[];\n\t\t\trecords: [string, number][];\n\t\t};\n\t}\n\n\tinterface AnalysisChartData extends ChartData<'line'> {\n\t\tlabels: string[];\n\t\tdatasets: {\n\t\t\tlabel: string;\n\t\t\tdata: number[];\n\t\t\tborderColor: string;\n\t\t\ttension: number;\n\t\t}[];\n\t}\n\n\tlet messages: Message[] = [];\n\tlet input = '';\n\tlet isLoading = false;\n\tlet error = '';\n\tlet isDownloading = false;\n\n\tonMount(async () => {\n\t\t// Initialize API config\n\t\ttry {\n\t\t\tapiConfig = await getApiConfig(i18n);\n\t\t\tconsole.log('API config initialized:', apiConfig);\n\t\t} catch (error) {\n\t\t\tconsole.error('Failed to initialize API config:', error);\n\t\t}\n\t});\n\n\tasync function handleSubmit() {\n\t\tif (!input.trim()) return;\n\t\tif (!input.startsWith('@analysis')) {\n\t\t\terror = 'Please start your message with @analysis';\n\t\t\treturn;\n\t\t}\n\n\t\tconsole.log('[DEBUG] Submitting input:', input);\n\n\t\tisLoading = true;\n\t\terror = '';\n\t\tmessages = [];\n\n\t\ttry {\n\t\t\tconst token = localStorage.getItem('token');\n\t\t\tif (!token) {\n\t\t\t\tthrow new Error('No authentication token found');\n\t\t\t}\n\n\t\t\tconst requestBody = {\n\t\t\t\tconversation_id: 'analysis_stream',\n\t\t\t\tmessage: input\n\t\t\t};\n\t\t\tconst requestHeaders = {\n\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t'Authorization': `Bearer ${apiConfig.userToken}`,\n\t\t\t\t'Accept-Language': apiConfig.languageLocal\n\t\t\t};\n\t\t\tconsole.log('[DEBUG] Sending fetch to proxy/api/analysis/stream', requestBody, requestHeaders);\n\n\t\t\tconst response = await fetch(`${WEBUI_BASE_URL}/proxy/api/analysis/stream`, {\n\t\t\t\tmethod: 'POST',\n\t\t\t\theaders: requestHeaders,\n\t\t\t\tbody: JSON.stringify(requestBody)\n\t\t\t});\n\n\t\t\tconsole.log('[DEBUG] Response status:', response.status);\n\n\t\t\tif (!response.ok) {\n\t\t\t\tthrow new Error('Failed to fetch analysis');\n\t\t\t}\n\n\t\t\tconst reader = response.body?.getReader();\n\t\t\tif (!reader) throw new Error('No reader available');\n\n\t\t\tconst decoder = new TextDecoder();\n\t\t\tlet buffer = '';\n\n\t\t\twhile (true) {\n\t\t\t\tconst { done, value } = await reader.read();\n\t\t\t\tif (done) break;\n\n\t\t\t\tbuffer += decoder.decode(value, { stream: true });\n\t\t\t\tconst lines = buffer.split('\\n');\n\t\t\t\tbuffer = lines.pop() || '';\n\n\t\t\t\tfor (const line of lines) {\n\t\t\t\t\tif (!line.trim()) continue;\n\t\t\t\t\tconsole.log('[DEBUG] Received line:', line);\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst data = JSON.parse(line);\n\t\t\t\t\t\tif (data.type === 'node') {\n\t\t\t\t\t\t\tconst newMessage = {\n\t\t\t\t\t\t\t\trole: 'assistant',\n\t\t\t\t\t\t\t\tcontent: data.content,\n\t\t\t\t\t\t\t\tmetadata: data.metadata,\n\t\t\t\t\t\t\t\tresults: data.results\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tconsole.log('[DEBUG] Adding message:', newMessage);\n\t\t\t\t\t\t\tmessages = [...messages, newMessage];\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tconsole.error('[DEBUG] Error parsing line:', e, line);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error('[DEBUG] Error in handleSubmit:', e);\n\t\t\terror = e instanceof Error ? e.message : 'An error occurred';\n\t\t} finally {\n\t\t\tisLoading = false;\n\t\t\tinput = '';\n\t\t}\n\t}\n\n\tfunction formatChartData(results: Message['results']): AnalysisChartData | null {\n\t\tif (!results || !results.records) return null;\n\t\tconst chartData: AnalysisChartData = {\n\t\t\tlabels: results.records.map((r) => r[0]),\n\t\t\tdatasets: [{\n\t\t\t\tlabel: 'Value',\n\t\t\t\tdata: results.records.map((r) => r[1]),\n\t\t\t\tborderColor: 'rgb(75, 192, 192)',\n\t\t\t\ttension: 0.1\n\t\t\t}]\n\t\t};\n\t\treturn chartData;\n\t}\n\n\tfunction toTableObjects(columns: string[], records: [string, number][]) {\n\t\treturn records.map(row => {\n\t\t\tconst obj: Record<string, any> = {};\n\t\t\tcolumns.forEach((col, i) => {\n\t\t\t\tobj[col] = row[i];\n\t\t\t});\n\t\t\treturn obj;\n\t\t});\n\t}\n\n\tasync function downloadWordReport() {\n\t\ttry {\n\t\t\tconsole.log('[DOCX DEBUG] Starting Word document download with Docxtemplater');\n\t\t\tisDownloading = true;\n\t\t\t\n\t\t\t// Combine all message contents for the report\n\t\t\tconst combinedContent = messages.map(message => {\n\t\t\t\t// Clean HTML tags and format the content\n\t\t\t\treturn message.content.replace(/<[^>]+>/g, '');\n\t\t\t}).join('\\n\\n');\n\t\t\t\n\t\t\t// Use the first message's results for the table, if available\n\t\t\tconst tableData = messages.find(msg => msg.results?.columns && msg.results.records)?.results;\n\t\t\t\n\t\t\t// Create the document using our new utility function\n\t\t\tconst blob = await createDocxTemplateReport(\n\t\t\t\tcombinedContent,\n\t\t\t\t'Analysis Report',\n\t\t\t\ttableData\n\t\t\t);\n\t\t\t\n\t\t\t// Generate filename with timestamp\n\t\t\tconst timestamp = new Date().toISOString().replace(/[-:.]/g, '').substring(0, 14);\n\t\t\tconst filename = `analysis_report_${timestamp}.docx`;\n\t\t\t\n\t\t\t// Download the document\n\t\t\tdownloadDocxDocument(blob, filename);\n\t\t\t\n\t\t\tconsole.log('[DOCX DEBUG] Download complete');\n\t\t} catch (error) {\n\t\t\tconsole.error('[DOCX DEBUG] Error in downloadWordReport:', error);\n\t\t\talert('Failed to download report. Please try again.');\n\t\t} finally {\n\t\t\tisDownloading = false;\n\t\t}\n\t}\n\n\tfunction toggleSidebar() {\n\t\tshowSidebar.update(value => !value);\n\t}\n</script>\n\n<div class=\"flex flex-row w-full h-full max-h-[100dvh]\">\n\t<div class=\"flex-1 flex flex-col h-full\">\n\t\t<div class=\"flex items-center justify-between px-4 pt-4 pb-2\">\n\t\t\t<div class=\"flex items-center gap-4\">\n\t\t\t\t<!-- Sidebar Toggle Button -->\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"cursor-pointer p-[7px] flex rounded-xl hover:bg-gray-100 dark:hover:bg-gray-900 transition\"\n\t\t\t\t\t\ton:click={toggleSidebar}\n\t\t\t\t\t\taria-label=\"Toggle Sidebar\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"m-auto self-center\">\n\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\tclass=\"size-5\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\td=\"M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25H12\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</button>\n\t\t\t\t<h1 class=\"text-2xl font-bold\">Analysis Report</h1>\n\t\t\t</div>\n\n\t\t\t<button \n\t\t\t\ton:click={downloadWordReport} \n\t\t\t\tclass=\"px-4 py-2 bg-blue-100 text-blue-700 border border-blue-200 rounded-lg hover:bg-blue-200 dark:bg-blue-800/30 dark:text-blue-300 dark:border-blue-700 dark:hover:bg-blue-700/50 transition flex items-center\"\n\t\t\t\tdisabled={isDownloading || messages.length === 0}\n\t\t\t>\n\t\t\t\t{#if isDownloading}\n\t\t\t\t\t<svg class=\"animate-spin h-5 w-5 mr-2 text-blue-600 dark:text-blue-400\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\n\t\t\t\t\t\t<circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle>\n\t\t\t\t\t\t<path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z\"></path>\n\t\t\t\t\t</svg>\n\t\t\t\t\t<span>Downloading...</span>\n\t\t\t\t{:else}\n\t\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-5 w-5 mr-2 text-blue-600 dark:text-blue-400\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n\t\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4\" />\n\t\t\t\t\t</svg>\n\t\t\t\t\t<span>Download as Word</span>\n\t\t\t\t{/if}\n\t\t\t</button>\n\t\t</div>\n\n\t\t<!-- 下面内容保持不变 -->\n\t\t<div class=\"flex-1 overflow-y-auto p-4 space-y-4\">\n\t\t\t{#each messages as message}\n\t\t\t\t<div class=\"bg-white dark:bg-gray-800 rounded-xl p-0 shadow-md overflow-hidden border border-gray-100 dark:border-gray-700 mb-6\">\n\t\t\t\t\t<!-- 提取并显示标题 -->\n\t\t\t\t\t{#if message.content.match(/\\*\\*Analysis for - (.*?)\\*\\*/)}\n\t\t\t\t\t\t<div class=\"bg-gray-50 dark:bg-gray-700 px-5 py-3 border-b border-gray-200 dark:border-gray-700\">\n\t\t\t\t\t\t\t<h2 class=\"text-xl font-bold text-gray-800 dark:text-gray-200\">\n\t\t\t\t\t\t\t\t{message.content.match(/\\*\\*Analysis for - (.*?)\\*\\*/)[1]}\n\t\t\t\t\t\t\t</h2>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/if}\n\t\t\t\t\t\n\t\t\t\t\t<!-- 内容区域 -->\n\t\t\t\t\t<div class=\"p-0\">\n\t\t\t\t\t\t<!-- Summary 部分 -->\n\t\t\t\t\t\t{#if message.content.includes('**Summary')}\n\t\t\t\t\t\t\t<div class=\"px-4 py-4 border-b border-gray-100 dark:border-gray-700\">\n\t\t\t\t\t\t\t\t<div class=\"flex items-start\">\n\t\t\t\t\t\t\t\t\t<div class=\"bg-blue-100 dark:bg-blue-800/30 p-2 rounded-lg mr-3\">\n\t\t\t\t\t\t\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-5 w-5 text-blue-600 dark:text-blue-400\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n\t\t\t\t\t\t\t\t\t\t\t<path d=\"M9 2a1 1 0 000 2h2a1 1 0 100-2H9z\" />\n\t\t\t\t\t\t\t\t\t\t\t<path fill-rule=\"evenodd\" d=\"M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z\" clip-rule=\"evenodd\" />\n\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class=\"flex-1\">\n\t\t\t\t\t\t\t\t\t\t<h3 class=\"font-semibold text-blue-800 dark:text-blue-300 mb-2\">Summary</h3>\n\t\t\t\t\t\t\t\t\t\t<div class=\"text-gray-700 dark:text-gray-300\">\n\t\t\t\t\t\t\t\t\t\t\t{#if message.content.match(/\\*\\*Summary\\*\\*:?\\s*(.*?)(?:\\n\\n\\*\\*Trends And Insights|\\*\\*Trends And Insights)/s)}\n\t\t\t\t\t\t\t\t\t\t\t\t{@html message.content\n\t\t\t\t\t\t\t\t\t\t\t\t\t.match(/\\*\\*Summary\\*\\*:?\\s*(.*?)(?:\\n\\n\\*\\*Trends And Insights|\\*\\*Trends And Insights)/s)[1]\n\t\t\t\t\t\t\t\t\t\t\t\t\t.replace(/\\*\\*(.*?)\\*\\*/g, '<strong>\\$1</strong>')\n\t\t\t\t\t\t\t\t\t\t\t\t\t.split(';')\n\t\t\t\t\t\t\t\t\t\t\t\t\t.map(line => line.trim())\n\t\t\t\t\t\t\t\t\t\t\t\t\t.join('<br>')}\n\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\n\t\t\t\t\t\t<!-- Trends And Insights 部分 -->\n\t\t\t\t\t\t{#if message.content.includes('**Trends And Insights')}\n\t\t\t\t\t\t\t<div class=\"bg-purple-50 dark:bg-purple-900/10 px-4 py-4 border-b border-gray-100 dark:border-gray-700\">\n\t\t\t\t\t\t\t\t<div class=\"flex items-start\">\n\t\t\t\t\t\t\t\t\t<div class=\"bg-purple-100 dark:bg-purple-800/30 p-2 rounded-lg mr-3\">\n\t\t\t\t\t\t\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-5 w-5 text-purple-600 dark:text-purple-400\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n\t\t\t\t\t\t\t\t\t\t\t<path fill-rule=\"evenodd\" d=\"M3 3a1 1 0 000 2v8a2 2 0 002 2h2.586l-1.293 1.293a1 1 0 101.414 1.414L10 15.414l2.293 2.293a1 1 0 001.414-1.414L12.414 15H15a2 2 0 002-2V5a1 1 0 100-2H3zm11.707 4.707a1 1 0 00-1.414-1.414L10 9.586 8.707 8.293a1 1 0 00-1.414 0l-2 2a1 1 0 101.414 1.414L8 10.414l1.293 1.293a1 1 0 001.414 0l4-4z\" clip-rule=\"evenodd\" />\n\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class=\"flex-1\">\n\t\t\t\t\t\t\t\t\t\t<h3 class=\"font-semibold text-purple-800 dark:text-purple-300 mb-2\">Trends And Insights</h3>\n\t\t\t\t\t\t\t\t\t\t<div class=\"text-gray-700 dark:text-gray-300\">\n\t\t\t\t\t\t\t\t\t\t\t{#if message.content.match(/\\*\\*Trends And Insights\\*\\*:?\\s*(.*?)(?:\\n\\n\\*\\*Journal Entries|\\*\\*Journal Entries)/s)}\n\t\t\t\t\t\t\t\t\t\t\t\t<ul class=\"list-disc pl-5 space-y-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{#each message.content\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.match(/\\*\\*Trends And Insights\\*\\*:?\\s*(.*?)(?:\\n\\n\\*\\*Journal Entries|\\*\\*Journal Entries)/s)[1]\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.replace(/^\\*\\s*/, '')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.split(/;\\s*|\\n\\*\\s*/)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.filter(item => item.trim()) as item}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<li>{@html item.replace(/\\*\\*(.*?)\\*\\*/g, '<strong>\\$1</strong>')}</li>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\n\t\t\t\t\t\t<!-- Journal Entries Analysis 部分 -->\n\t\t\t\t\t\t{#if message.content.includes('**Journal Entries Analysis')}\n\t\t\t\t\t\t\t<div class=\"bg-green-50 dark:bg-green-900/10 px-4 py-4 border-b border-gray-100 dark:border-gray-700\">\n\t\t\t\t\t\t\t\t<div class=\"flex items-start\">\n\t\t\t\t\t\t\t\t\t<div class=\"bg-green-100 dark:bg-green-800/30 p-2 rounded-lg mr-3\">\n\t\t\t\t\t\t\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-5 w-5 text-green-600 dark:text-green-400\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n\t\t\t\t\t\t\t\t\t\t\t<path fill-rule=\"evenodd\" d=\"M6 2a2 2 0 00-2 2v12a2 2 0 002 2h8a2 2 0 002-2V7.414A2 2 0 0015.414 6L12 2.586A2 2 0 0010.586 2H6zm2 10a1 1 0 10-2 0v3a1 1 0 102 0v-3zm2-3a1 1 0 011 1v5a1 1 0 11-2 0v-5a1 1 0 011-1zm4-1a1 1 0 10-2 0v7a1 1 0 102 0V8z\" clip-rule=\"evenodd\" />\n\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class=\"flex-1\">\n\t\t\t\t\t\t\t\t\t\t<h3 class=\"font-semibold text-green-800 dark:text-green-300 mb-2\">Journal Entries</h3>\n\t\t\t\t\t\t\t\t\t\t<div class=\"text-gray-700 dark:text-gray-300\">\n\t\t\t\t\t\t\t\t\t\t\t{#if message.content.match(/\\*\\*Journal Entries Analysis\\*\\*:?\\s*(.*?)(?:\\n\\n\\*\\*Recommendations|\\*\\*Recommendations)/s)}\n\t\t\t\t\t\t\t\t\t\t\t\t<ul class=\"list-disc pl-5 space-y-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{#each message.content\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.match(/\\*\\*Journal Entries Analysis\\*\\*:?\\s*(.*?)(?:\\n\\n\\*\\*Recommendations|\\*\\*Recommendations)/s)[1]\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.replace(/^\\*\\s*/, '')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.split(/;\\s*|\\n\\*\\s*/)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.filter(item => item.trim()) as item}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<li>{@html item.replace(/\\*\\*(.*?)\\*\\*/g, '<strong>\\$1</strong>')}</li>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\n\t\t\t\t\t\t<!-- Recommendations 部分 -->\n\t\t\t\t\t\t{#if message.content.includes('**Recommendations')}\n\t\t\t\t\t\t<div class=\"bg-amber-50 dark:bg-amber-900/10 px-4 py-4\">\n\t\t\t\t\t\t\t<div class=\"flex items-start\">\n\t\t\t\t\t\t\t\t<div class=\"bg-amber-100 dark:bg-amber-800/30 p-2 rounded-lg mr-3\">\n\t\t\t\t\t\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-5 w-5 text-amber-600 dark:text-amber-400\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n\t\t\t\t\t\t\t\t\t\t<path d=\"M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z\" />\n\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"flex-1\">\n\t\t\t\t\t\t\t\t\t<h3 class=\"font-semibold text-amber-800 dark:text-amber-300 mb-2\">Recommendations</h3>\n\t\t\t\t\t\t\t\t\t<div class=\"text-gray-700 dark:text-gray-300\">\n\t\t\t\t\t\t\t\t\t\t{#if message.content.match(/\\*\\*Recommendations\\*\\*:?\\s*(.*?)$/s)}\n\t\t\t\t\t\t\t\t\t\t\t<ul class=\"list-disc pl-5 space-y-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t{#each message.content\n\t\t\t\t\t\t\t\t\t\t\t\t\t.match(/\\*\\*Recommendations\\*\\*:?\\s*(.*?)$/s)[1]\n\t\t\t\t\t\t\t\t\t\t\t\t\t.split(/;\\s*|\\n\\*\\s*/)\n\t\t\t\t\t\t\t\t\t\t\t\t\t.filter(rec => rec.trim()) as recommendation}\n\t\t\t\t\t\t\t\t\t\t\t\t\t<li>{@html recommendation.replace(/\\*\\*(.*?)\\*\\*/g, '<strong>\\$1</strong>')}</li>\n\t\t\t\t\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\n\t\t\t\t\t\t{#if !message.content.includes('**Summary') && !message.content.includes('**Trends And Insights') && \n\t\t\t\t\t\t\t!message.content.includes('**Journal Entries Analysis') && !message.content.includes('**Recommendations')}\n\t\t\t\t\t\t\t<div class=\"px-5 py-4\">\n\t\t\t\t\t\t\t\t<div class=\"prose dark:prose-invert max-w-none\">\n\t\t\t\t\t\t\t\t\t{@html message.content.replace(/;/g, '<br>').replace(/\\*\\*(.*?)\\*\\*/g, '<strong>\\$1</strong>')}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t\t{#if message.results}\n\t\t\t\t\t\t<div class=\"mt-4\">\n\t\t\t\t\t\t\t{#if message.results.records}\n\t\t\t\t\t\t\t\t<div class=\"flex items-center gap-2 font-medium text-gray-700 dark:text-gray-300 mb-2\">\n\t\t\t\t\t\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" class=\"w-4 h-4\">\n\t\t\t\t\t\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M3.375 19.5h17.25m-17.25 0a1.125 1.125 0 0 1-1.125-1.125M3.375 19.5h7.5c.621 0 1.125-.504 1.125-1.125m-9.75 0V5.625m0 12.75v-1.5c0-.621.504-1.125 1.125-1.125m18.375 2.625V5.625m0 12.75c0 .621-.504 1.125-1.125 1.125m1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125m0 3.75h-7.5A1.125 1.125 0 0 1 12 18.375m9.75-12.75c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125m19.5 0v1.5c0 .621-.504 1.125-1.125 1.125M2.25 5.625v1.5c0 .621.504 1.125 1.125 1.125m0 0h17.25m-17.25 0h7.5c.621 0 1.125.504 1.125 1.125M3.375 8.25c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125m1.125-3.75h7.5c.621 0 1.125.504 1.125 1.125m-9.75 0h9.75\" />\n\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\tData Table\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"overflow-x-auto\">\n\t\t\t\t\t\t\t\t\t<Table \n\t\t\t\t\t\t\t\t\t\tdata={toTableObjects(message.results.columns, message.results.records)}\n\t\t\t\t\t\t\t\t\t\tcolumns={message.results.columns}\n\t\t\t\t\t\t\t\t\t\tclassName=\"border w-full table-improved\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"mt-4 h-64\">\n\t\t\t\t\t\t\t\t\t{#if message.results}\n\t\t\t\t\t\t\t\t\t\t{#await Promise.resolve(formatChartData(message.results)) then chartData}\n\t\t\t\t\t\t\t\t\t\t\t{#if chartData}\n\t\t\t\t\t\t\t\t\t\t\t\t<Chart\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"line\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tdata={chartData}\n\t\t\t\t\t\t\t\t\t\t\t\t\toptions={{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tresponsive: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmaintainAspectRatio: false\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t{/await}\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t{/each}\n\t\t</div>\n\n\t\t<div class=\"bg-white dark:bg-gray-900\">\n\t\t\t<div class=\"max-w-6xl px-2.5 mx-auto inset-x-0\">\n\t\t\t  <form on:submit|preventDefault={handleSubmit} class=\"w-full flex gap-1.5\">\n\t\t\t\t<div class=\"flex-1 flex flex-col relative w-full rounded-3xl px-1 bg-gray-600/5 dark:bg-gray-400/5 dark:text-gray-100\">\n\t\t\t\t  <div class=\"px-2.5\">\n\t\t\t\t\t<input\n\t\t\t\t\t  type=\"text\"\n\t\t\t\t\t  bind:value={input}\n\t\t\t\t\t  placeholder=\"Send a message starting with @analysis\"\n\t\t\t\t\t  class=\"scrollbar-hidden bg-transparent dark:text-gray-100 outline-hidden w-full pt-3 px-1 resize-none h-fit\"\n\t\t\t\t\t  disabled={isLoading}\n\t\t\t\t\t/>\n\t\t\t\t  </div>\n\t\t\t\t  \n\t\t\t\t  <div class=\"flex justify-between mt-1.5 mb-2.5 mx-0.5 max-w-full\">\n\t\t\t\t\t<div class=\"ml-1 self-end gap-0.5 flex items-center flex-1 max-w-[80%]\">\n\t\t\t\t\t  <!-- This space can remain empty to match the layout -->\n\t\t\t\t\t</div>\n\t\t\t\t\t\n\t\t\t\t\t<div class=\"self-end flex space-x-1 mr-1 shrink-0\">\n\t\t\t\t\t  <div class=\"flex items-center\">\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t  type=\"submit\"\n\t\t\t\t\t\t  class=\"{!isLoading \n\t\t\t\t\t\t\t? 'bg-black text-white hover:bg-gray-900 dark:bg-white dark:text-black dark:hover:bg-gray-100' \n\t\t\t\t\t\t\t: 'text-white bg-gray-200 dark:text-gray-900 dark:bg-gray-700'} \n\t\t\t\t\t\t\ttransition rounded-full p-1.5 self-center\"\n\t\t\t\t\t\t  disabled={isLoading}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t  {#if isLoading}\n\t\t\t\t\t\t\t<div class=\"flex items-center\">\n\t\t\t\t\t\t\t  <svg class=\"animate-spin h-5 w-5 mr-2\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\n\t\t\t\t\t\t\t\t<circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle>\n\t\t\t\t\t\t\t\t<path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z\"></path>\n\t\t\t\t\t\t\t  </svg>\n\t\t\t\t\t\t\t  <span>Processing...</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t  {:else}\n\t\t\t\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 16 16\" fill=\"currentColor\" class=\"size-5\">\n\t\t\t\t\t\t\t  <path fill-rule=\"evenodd\" d=\"M8 14a.75.75 0 0 1-.75-.75V4.56L4.03 7.78a.75.75 0 0 1-1.06-1.06l4.5-4.5a.75.75 0 0 1 1.06 0l4.5 4.5a.75.75 0 0 1-1.06 1.06L8.75 4.56v8.69A.75.75 0 0 1 8 14Z\" clip-rule=\"evenodd\"/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t  {/if}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t  </div>\n\t\t\t\t\t</div>\n\t\t\t\t  </div>\n\t\t\t\t</div>\n\t\t\t  </form>\n\t\t\t  \n\t\t\t  {#if error}\n\t\t\t\t<p class=\"mt-2 text-red-500 text-sm\">{error}</p>\n\t\t\t  {/if}\n\t\t\t</div>\n\t\t  </div>\n\t</div>\n</div>\n\n\n<style>\n:global(.table-improved) {\n\twidth: calc(100% + 1rem) !important;\n\tmax-width: none !important;\n\tmargin-left: -0.5rem;\n\tmargin-right: -0.5rem;\n}\n:global(.table-improved thead) {\n\tbackground-color: #e8f4ff !important;\n}\n:global(.dark .table-improved thead) {\n\tbackground-color: #1e3a5f !important;\n}\n:global(.table-improved th) {\n\tfont-weight: 600;\n\tpadding: 0.75rem 1rem !important;\n}\n:global(.table-improved td) {\n\tpadding: 0.625rem 1rem !important;\n}\n</style> "],"names":["ChartJS"],"mappings":"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","x_google_ignoreList":[0,1]}