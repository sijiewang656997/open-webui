{"version":3,"file":"_page.svelte.js","sources":["../../../../../../../../src/lib/components/workspace/Knowledge.svelte","../../../../../../../../src/routes/(app)/workspace/knowledge/+page.svelte"],"sourcesContent":["<script lang=\"ts\">\n\timport Fuse from 'fuse.js';\n\n\timport dayjs from 'dayjs';\n\timport relativeTime from 'dayjs/plugin/relativeTime';\n\tdayjs.extend(relativeTime);\n\n\timport { toast } from 'svelte-sonner';\n\timport { onMount, getContext } from 'svelte';\n\tconst i18n = getContext('i18n');\n\n\timport { WEBUI_NAME, knowledge } from '$lib/stores';\n\timport {\n\t\tgetKnowledgeBases,\n\t\tdeleteKnowledgeById,\n\t\tgetKnowledgeBaseList\n\t} from '$lib/apis/knowledge';\n\n\timport { goto } from '$app/navigation';\n\n\timport DeleteConfirmDialog from '../common/ConfirmDialog.svelte';\n\timport ItemMenu from './Knowledge/ItemMenu.svelte';\n\timport Badge from '../common/Badge.svelte';\n\timport Search from '../icons/Search.svelte';\n\timport Plus from '../icons/Plus.svelte';\n\timport Spinner from '../common/Spinner.svelte';\n\timport { capitalizeFirstLetter } from '$lib/utils';\n\timport Tooltip from '../common/Tooltip.svelte';\n\n\tlet loaded = false;\n\n\tlet query = '';\n\tlet selectedItem = null;\n\tlet showDeleteConfirm = false;\n\n\tlet fuse = null;\n\n\tlet knowledgeBases = [];\n\tlet filteredItems = [];\n\n\t$: if (knowledgeBases) {\n\t\tfuse = new Fuse(knowledgeBases, {\n\t\t\tkeys: ['name', 'description']\n\t\t});\n\t}\n\n\t$: if (fuse) {\n\t\tfilteredItems = query\n\t\t\t? fuse.search(query).map((e) => {\n\t\t\t\t\treturn e.item;\n\t\t\t\t})\n\t\t\t: knowledgeBases;\n\t}\n\n\tconst deleteHandler = async (item) => {\n\t\tconst res = await deleteKnowledgeById(localStorage.token, item.id).catch((e) => {\n\t\t\ttoast.error(`${e}`);\n\t\t});\n\n\t\tif (res) {\n\t\t\tknowledgeBases = await getKnowledgeBaseList(localStorage.token);\n\t\t\tknowledge.set(await getKnowledgeBases(localStorage.token));\n\t\t\ttoast.success($i18n.t('Knowledge deleted successfully.'));\n\t\t}\n\t};\n\n\tonMount(async () => {\n\t\tknowledgeBases = await getKnowledgeBaseList(localStorage.token);\n\t\tloaded = true;\n\t});\n</script>\n\n<svelte:head>\n\t<title>\n\t\t{$i18n.t('Knowledge')} | {$WEBUI_NAME}\n\t</title>\n</svelte:head>\n\n{#if loaded}\n\t<DeleteConfirmDialog\n\t\tbind:show={showDeleteConfirm}\n\t\ton:confirm={() => {\n\t\t\tdeleteHandler(selectedItem);\n\t\t}}\n\t/>\n\n\t<div class=\"flex flex-col gap-1 my-1.5\">\n\t\t<div class=\"flex justify-between items-center\">\n\t\t\t<div class=\"flex md:self-center text-xl font-medium px-0.5 items-center\">\n\t\t\t\t{$i18n.t('Knowledge')}\n\t\t\t\t<div class=\"flex self-center w-[1px] h-6 mx-2.5 bg-gray-50 dark:bg-gray-850\" />\n\t\t\t\t<span class=\"text-lg font-medium text-gray-500 dark:text-gray-300\"\n\t\t\t\t\t>{filteredItems.length}</span\n\t\t\t\t>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class=\" flex w-full space-x-2\">\n\t\t\t<div class=\"flex flex-1\">\n\t\t\t\t<div class=\" self-center ml-1 mr-3\">\n\t\t\t\t\t<Search className=\"size-3.5\" />\n\t\t\t\t</div>\n\t\t\t\t<input\n\t\t\t\t\tclass=\" w-full text-sm py-1 rounded-r-xl outline-hidden bg-transparent\"\n\t\t\t\t\tbind:value={query}\n\t\t\t\t\tplaceholder={$i18n.t('Search Knowledge')}\n\t\t\t\t/>\n\t\t\t</div>\n\n\t\t\t<div>\n\t\t\t\t<button\n\t\t\t\t\tclass=\" px-2 py-2 rounded-xl hover:bg-gray-700/10 dark:hover:bg-gray-100/10 dark:text-gray-300 dark:hover:text-white transition font-medium text-sm flex items-center space-x-1\"\n\t\t\t\t\taria-label={$i18n.t('Create Knowledge')}\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\tgoto('/workspace/knowledge/create');\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<Plus className=\"size-3.5\" />\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n\t<div class=\"mb-5 grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-2\">\n\t\t{#each filteredItems as item}\n\t\t\t<button\n\t\t\t\tclass=\" flex space-x-4 cursor-pointer text-left w-full px-3 py-2 hover:bg-gray-50 dark:hover:bg-gray-850 transition rounded-xl\"\n\t\t\t\ton:click={() => {\n\t\t\t\t\tif (item?.meta?.document) {\n\t\t\t\t\t\ttoast.error(\n\t\t\t\t\t\t\t$i18n.t(\n\t\t\t\t\t\t\t\t'Only collections can be edited, create a new knowledge base to edit/add documents.'\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tgoto(`/workspace/knowledge/${item.id}`);\n\t\t\t\t\t}\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<div class=\" w-full\">\n\t\t\t\t\t<div class=\"flex items-center justify-between -mt-1\">\n\t\t\t\t\t\t{#if item?.meta?.document}\n\t\t\t\t\t\t\t<Badge type=\"muted\" content={$i18n.t('Document')} />\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t<Badge type=\"success\" content={$i18n.t('Collection')} />\n\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t<div class=\" flex self-center -mr-1 translate-y-1\">\n\t\t\t\t\t\t\t<ItemMenu\n\t\t\t\t\t\t\t\ton:delete={() => {\n\t\t\t\t\t\t\t\t\tselectedItem = item;\n\t\t\t\t\t\t\t\t\tshowDeleteConfirm = true;\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\" self-center flex-1 px-1 mb-1\">\n\t\t\t\t\t\t<div class=\" font-semibold line-clamp-1 h-fit\">{item.name}</div>\n\n\t\t\t\t\t\t<div class=\" text-xs overflow-hidden text-ellipsis line-clamp-1\">\n\t\t\t\t\t\t\t{item.description}\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class=\"mt-3 flex justify-between\">\n\t\t\t\t\t\t\t<div class=\"text-xs text-gray-500\">\n\t\t\t\t\t\t\t\t<Tooltip\n\t\t\t\t\t\t\t\t\tcontent={item?.user?.email ?? $i18n.t('Deleted User')}\n\t\t\t\t\t\t\t\t\tclassName=\"flex shrink-0\"\n\t\t\t\t\t\t\t\t\tplacement=\"top-start\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{$i18n.t('By {{name}}', {\n\t\t\t\t\t\t\t\t\t\tname: capitalizeFirstLetter(\n\t\t\t\t\t\t\t\t\t\t\titem?.user?.name ?? item?.user?.email ?? $i18n.t('Deleted User')\n\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\" text-xs text-gray-500 line-clamp-1\">\n\t\t\t\t\t\t\t\t{$i18n.t('Updated')}\n\t\t\t\t\t\t\t\t{dayjs(item.updated_at * 1000).fromNow()}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</button>\n\t\t{/each}\n\t</div>\n\n\t<div class=\" text-gray-500 text-xs mt-1 mb-2\">\n\t\tâ“˜ {$i18n.t(\"Use '#' in the prompt input to load and include your knowledge.\")}\n\t</div>\n{:else}\n\t<div class=\"w-full h-full flex justify-center items-center\">\n\t\t<Spinner />\n\t</div>\n{/if}\n","<script>\n\timport { onMount } from 'svelte';\n\timport { knowledge } from '$lib/stores';\n\n\timport { getKnowledgeBases } from '$lib/apis/knowledge';\n\timport Knowledge from '$lib/components/workspace/Knowledge.svelte';\n\n\tonMount(async () => {\n\t\tawait Promise.all([\n\t\t\t(async () => {\n\t\t\t\tknowledge.set(await getKnowledgeBases(localStorage.token));\n\t\t\t})()\n\t\t]);\n\t});\n</script>\n\n{#if $knowledge !== null}\n\t<Knowledge />\n{/if}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;AAKC,QAAM,OAAO,YAAY;AAInB,QAAA,OAAO,WAAW,MAAM;;AA4B1B,MAAA,iBAAA,CAAA;;;;;;;;AAGG,UAAA,gBAAA;AACN,YAAW,KAAK,gBAAA,EACf,MAAO,CAAA,QAAQ,aAAa,EAAA,CAAA;AAAA;;AAgC5B,iBAAA,GAAA,SAAA,QAAA,oCAAA,SAAA,QAAA,WAAA,OAAA,MAAM,EAAE,WAAW,CAAM,CAAA,MAAA,OAAA,WAAW;;;;;;;;;;AC1DlC,SAAA,GAAA,eAAe;;"}