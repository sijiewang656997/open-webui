{"version":3,"file":"_page.svelte.js","sources":["../../../../../../../src/routes/s/[id]/+page.svelte"],"sourcesContent":["<script lang=\"ts\">\n\timport { onMount, tick, getContext } from 'svelte';\n\timport { goto } from '$app/navigation';\n\timport { page } from '$app/stores';\n\n\timport dayjs from 'dayjs';\n\n\timport { settings, chatId, WEBUI_NAME, models, config } from '$lib/stores';\n\timport { convertMessagesToHistory, createMessagesList } from '$lib/utils';\n\n\timport { getChatByShareId, cloneSharedChatById } from '$lib/apis/chats';\n\n\timport Messages from '$lib/components/chat/Messages.svelte';\n\timport Navbar from '$lib/components/layout/Navbar.svelte';\n\n\timport { getUserById } from '$lib/apis/users';\n\timport { getModels } from '$lib/apis';\n\timport { toast } from 'svelte-sonner';\n\timport localizedFormat from 'dayjs/plugin/localizedFormat';\n\n\tconst i18n = getContext('i18n');\n\tdayjs.extend(localizedFormat);\n\n\tlet loaded = false;\n\n\tlet autoScroll = true;\n\tlet processing = '';\n\tlet messagesContainerElement: HTMLDivElement;\n\n\t// let chatId = $page.params.id;\n\tlet showModelSelector = false;\n\tlet selectedModels = [''];\n\n\tlet chat = null;\n\tlet user = null;\n\n\tlet title = '';\n\tlet files = [];\n\n\tlet messages = [];\n\tlet history = {\n\t\tmessages: {},\n\t\tcurrentId: null\n\t};\n\n\t$: messages = createMessagesList(history, history.currentId);\n\n\t$: if ($page.params.id) {\n\t\t(async () => {\n\t\t\tif (await loadSharedChat()) {\n\t\t\t\tawait tick();\n\t\t\t\tloaded = true;\n\t\t\t} else {\n\t\t\t\tawait goto('/');\n\t\t\t}\n\t\t})();\n\t}\n\n\t//////////////////////////\n\t// Web functions\n\t//////////////////////////\n\n\tconst loadSharedChat = async () => {\n\t\tawait models.set(\n\t\t\tawait getModels(\n\t\t\t\tlocalStorage.token,\n\t\t\t\t$config?.features?.enable_direct_connections && ($settings?.directConnections ?? null)\n\t\t\t)\n\t\t);\n\t\tawait chatId.set($page.params.id);\n\t\tchat = await getChatByShareId(localStorage.token, $chatId).catch(async (error) => {\n\t\t\tawait goto('/');\n\t\t\treturn null;\n\t\t});\n\n\t\tif (chat) {\n\t\t\tuser = await getUserById(localStorage.token, chat.user_id).catch((error) => {\n\t\t\t\tconsole.error(error);\n\t\t\t\treturn null;\n\t\t\t});\n\n\t\t\tconst chatContent = chat.chat;\n\n\t\t\tif (chatContent) {\n\t\t\t\tconsole.log(chatContent);\n\n\t\t\t\tselectedModels =\n\t\t\t\t\t(chatContent?.models ?? undefined) !== undefined\n\t\t\t\t\t\t? chatContent.models\n\t\t\t\t\t\t: [chatContent.models ?? ''];\n\t\t\t\thistory =\n\t\t\t\t\t(chatContent?.history ?? undefined) !== undefined\n\t\t\t\t\t\t? chatContent.history\n\t\t\t\t\t\t: convertMessagesToHistory(chatContent.messages);\n\t\t\t\ttitle = chatContent.title;\n\n\t\t\t\tautoScroll = true;\n\t\t\t\tawait tick();\n\n\t\t\t\tif (messages.length > 0) {\n\t\t\t\t\thistory.messages[messages.at(-1).id].done = true;\n\t\t\t\t}\n\t\t\t\tawait tick();\n\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\t};\n\n\tconst cloneSharedChat = async () => {\n\t\tif (!chat) return;\n\n\t\tconst res = await cloneSharedChatById(localStorage.token, chat.id).catch((error) => {\n\t\t\ttoast.error(`${error}`);\n\t\t\treturn null;\n\t\t});\n\n\t\tif (res) {\n\t\t\tgoto(`/c/${res.id}`);\n\t\t}\n\t};\n</script>\n\n<svelte:head>\n\t<title>\n\t\t{title\n\t\t\t? `${title.length > 30 ? `${title.slice(0, 30)}...` : title} | ${$WEBUI_NAME}`\n\t\t\t: `${$WEBUI_NAME}`}\n\t</title>\n</svelte:head>\n\n{#if loaded}\n\t<div\n\t\tclass=\"h-screen max-h-[100dvh] w-full flex flex-col text-gray-700 dark:text-gray-100 bg-white dark:bg-gray-900\"\n\t>\n\t\t<div class=\"flex flex-col flex-auto justify-center relative\">\n\t\t\t<div class=\" flex flex-col w-full flex-auto overflow-auto h-0\" id=\"messages-container\">\n\t\t\t\t<div class=\"pt-5 px-2 w-full max-w-5xl mx-auto\">\n\t\t\t\t\t<div class=\"px-3\">\n\t\t\t\t\t\t<div class=\" text-2xl font-semibold line-clamp-1\">\n\t\t\t\t\t\t\t{title}\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class=\"flex text-sm justify-between items-center mt-1\">\n\t\t\t\t\t\t\t<div class=\"text-gray-400\">\n\t\t\t\t\t\t\t\t{dayjs(chat.chat.timestamp).format('LLL')}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\" h-full w-full flex flex-col py-2\">\n\t\t\t\t\t<div class=\"\">\n\t\t\t\t\t\t<Messages\n\t\t\t\t\t\t\tclassName=\"h-full flex pt-4 pb-8\"\n\t\t\t\t\t\t\t{user}\n\t\t\t\t\t\t\tchatId={$chatId}\n\t\t\t\t\t\t\treadOnly={true}\n\t\t\t\t\t\t\t{selectedModels}\n\t\t\t\t\t\t\t{processing}\n\t\t\t\t\t\t\tbind:history\n\t\t\t\t\t\t\tbind:messages\n\t\t\t\t\t\t\tbind:autoScroll\n\t\t\t\t\t\t\tbottomPadding={files.length > 0}\n\t\t\t\t\t\t\tsendPrompt={() => {}}\n\t\t\t\t\t\t\tcontinueResponse={() => {}}\n\t\t\t\t\t\t\tregenerateResponse={() => {}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div\n\t\t\t\tclass=\"absolute bottom-0 right-0 left-0 flex justify-center w-full bg-linear-to-b from-transparent to-white dark:to-gray-900\"\n\t\t\t>\n\t\t\t\t<div class=\"pb-5\">\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"px-4 py-2 text-sm font-medium bg-black hover:bg-gray-900 text-white dark:bg-white dark:text-black dark:hover:bg-gray-100 transition rounded-full\"\n\t\t\t\t\t\ton:click={cloneSharedChat}\n\t\t\t\t\t>\n\t\t\t\t\t\t{$i18n.t('Clone Chat')}\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n{/if}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;IA0BK,aAAa;;;;;;;;;;;;;AANX,QAAA,OAAO,WAAW,MAAM;;AAC9B,QAAM,OAAO,eAAe;MAExB,SAAS;MAET,aAAa;AAMb,MAAA,iBAAA,CAAkB,EAAE;MAEpB,OAAO;MACP,OAAO;MAEP,QAAQ;AACR,MAAA,QAAA,CAAA;AAEA,MAAA,WAAA,CAAA;AACA,MAAA,UAAA,EACH,cACA,WAAW,KAAA;AAoBN,QAAA,iBAAA,YAAA;UACC,OAAO,IAAA,MACN,UACL,aAAa,OACb,SAAS,UAAU,8BAA8B,WAAW,qBAAqB,KAAA,CAAA;UAG7E,OAAO,IAAI,MAAM,OAAO,EAAE;AAChC,WAAA,MAAa,iBAAiB,aAAa,OAAO,OAAO,EAAE,MAAa,OAAA,UAAA;AACjE,YAAA,KAAQ;AACP,aAAA;AAAA;AAGJ,QAAA,MAAA;AACH,aAAA,MAAa,YAAY,aAAa,OAAO,KAAK,OAAO,EAAE,MAAO,WAAA;AACjE,gBAAQ,MAAM,KAAK;AACZ,eAAA;AAAA;AAGF,YAAA,cAAc,KAAK;AAErB,UAAA,aAAA;AACH,gBAAQ,IAAI,WAAW;AAEvB,0BACE,aAAa,sBAAyB,SACpC,YAAY,SACX,CAAA,YAAY,UAAU,EAAE;AAC7B,mBACE,aAAa,uBAA0B,SACrC,YAAY,UACZ,yBAAyB,YAAY,QAAQ;AACjD,gBAAQ,YAAY;AAEpB,qBAAa;AACP,cAAA,KAAA;AAEF,YAAA,SAAS,SAAS,GAAA;AACrB,kBAAQ,SAAS,SAAS,GAAA,EAAK,EAAE,EAAE,EAAE,OAAO;AAAA;AAEvC,cAAA,KAAA;AAEC,eAAA;AAAA;AAEA,eAAA;AAAA;;;;;;;;;AA7DP,eAAW,mBAAmB,SAAS,QAAQ,SAAS;;AAEpD,UAAA,MAAM,OAAO,IAAA;;AAER,cAAA,MAAA,eAAA,GAAA;AACH,kBAAA,KAAA;AACN,qBAAS;AAAA;AAEH,kBAAA,KAAQ;AAAA;;;;AA0Ef,iBAAA,GAAA,SAAA,QAAA,qCAAA,SAAA,QAAA,WAAA,OAAA,QACK,GAAA,MAAM,SAAS,QAAQ,MAAM,MAAM,GAAG,EAAE,CAAS,QAAA,KAAK,MAAM,WAAW,KACvE,GAAA,WAAW,4DAId,8YASG,KAAK,CAAA,iGAAA,OAKJ,MAAM,KAAK,KAAK,SAAS,EAAE,OAAO,KAAK,CAAA,CAAA,wFAAA,mBAAA,UAAA,UAAA,EAAA;AAAA;;;;gBAWjC;AAAA,kBACE;AAAA;;uBAMK,MAAM,SAAS;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;wVAiB9B,MAAM,EAAE,YAAY,CAAA,CAAA;;;;;;;;;;"}