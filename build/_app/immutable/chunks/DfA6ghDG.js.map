{"version":3,"file":"DfA6ghDG.js","sources":["../../../../../../src/lib/components/icons/Info.svelte","../../../../../../src/lib/components/common/FileItemModal.svelte"],"sourcesContent":["<script lang=\"ts\">\n\texport let className = 'size-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n>\n\t<path\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t\td=\"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\timport { getContext, onMount } from 'svelte';\n\timport { formatFileSize, getLineCount } from '$lib/utils';\n\timport { WEBUI_API_BASE_URL } from '$lib/constants';\n\n\tconst i18n = getContext('i18n');\n\n\timport Modal from './Modal.svelte';\n\timport XMark from '../icons/XMark.svelte';\n\timport Info from '../icons/Info.svelte';\n\timport Switch from './Switch.svelte';\n\timport Tooltip from './Tooltip.svelte';\n\timport ExcelViewer from './ExcelViewer.svelte';\n\n\texport let item;\n\texport let show = false;\n\texport let edit = false;\n\n\tlet enableFullContent = false;\n    let excelData = null;\n    let isExcelModified = false;\n\n\t$: isPDF =\n\t\titem?.meta?.content_type === 'application/pdf' ||\n\t\t(item?.name && item?.name.toLowerCase().endsWith('.pdf'));\n\t\t\n\t$: isExcel =\n\t\titem?.meta?.content_type?.includes('spreadsheet') ||\n\t\titem?.meta?.content_type?.includes('excel') ||\n\t\titem?.meta?.content_type?.includes('ms-excel') ||\n\t\t(item?.name && /\\.(xlsx|xls|xlsm|xlsb|xltx|xlt|csv|ods)$/i.test(item?.name));\n\n    function handleExcelDataChange(event) {\n        excelData = event.detail.data;\n        isExcelModified = true;\n    }\n\n    // 保留Excel文件保存功能\n    async function saveExcelFile() {\n        if (!excelData || !item || !item.id) return;\n\n        try {\n            const isSaving = true;\n            \n            const formData = new FormData();\n            \n            \n            // 假设excelData是一个Blob对象或可以转换为Blob的数据\n\n            // 假设excelData是一个Blob对象或可以转换为Blob的数据\n            const excelBlob = new Blob([excelData], { \n                type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' \n            });\n            \n            formData.append('file', excelBlob, item.name);\n            \n            // 发送到服务器的API端点\n            const response = await fetch(`${WEBUI_API_BASE_URL}/files/${item.id}/update`, {\n                method: 'PUT',\n                body: formData\n            });\n            \n            if (!response.ok) {\n                throw new Error('Failed to save file');\n            }\n            \n            // 保存成功\n            isExcelModified = false;\n            alert('Excel file saved successfully!');\n        } catch (error) {\n            console.error('Error saving Excel file:', error);\n            alert('Failed to save Excel file: ' + error.message);\n        }\n    }\n\n\tonMount(() => {\n\t\tconsole.log(item);\n\t\tif (item?.context === 'full') {\n\t\t\tenableFullContent = true;\n\t\t}\n\t});\n</script>\n\n<!-- 保持Modal可拖动功能 -->\n<Modal bind:show size=\"lg\" draggable={true} className=\"bg-gray-50 dark:bg-gray-900 rounded-2xl\">\n    <div class=\"font-primary px-6 py-5 w-full flex flex-col justify-center dark:text-gray-400\">\n        <div class=\"pb-2\">\n            <div class=\"flex items-start justify-between\">\n                <div>\n                    <div class=\"font-medium text-lg dark:text-gray-100\">\n                        <a\n                            href=\"#\"\n                            class=\"hover:underline line-clamp-1\"\n                            on:click|preventDefault={() => {\n                                if (!isPDF && !isExcel && item.url) {\n                                    window.open(\n                                        item.type === 'file' ? `${item.url}/content` : `${item.url}`,\n                                        '_blank'\n                                    );\n                                }\n                            }}\n                        >\n                            {item?.name ?? 'File'}\n                        </a>\n                    </div>\n                </div>\n                \n                <!-- 保留Excel保存按钮 -->\n                {#if isExcel && isExcelModified}\n                <div class=\"ml-auto mr-2\">\n                    <button \n                        class=\"px-3 py-1 bg-blue-600 text-white rounded-md text-sm hover:bg-blue-700\"\n                        on:click={saveExcelFile}\n                    >\n                        Save\n                    </button>\n                </div>\n                {/if}\n                \n                <div>\n                    <button\n                        on:click={() => {\n                            // 保留未保存提示\n                            if (isExcel && isExcelModified) {\n                                if (confirm('You have unsaved changes. Do you want to leave without saving?')) {\n                                    show = false;\n                                }\n                            } else {\n                                show = false;\n                            }\n                        }}\n                    >\n                        <XMark />\n                    </button>\n                </div>\n            </div>\n            \n            <div>\n                <div class=\"flex flex-col items-center md:flex-row gap-1 justify-between w-full\">\n                    <div class=\"flex flex-wrap text-sm gap-1 text-gray-500\">\n                        {#if item.size}\n                            <div class=\"capitalize shrink-0\">{formatFileSize(item.size)}</div>\n                            •\n                        {/if}\n                        \n                        {#if item?.file?.data?.content}\n                            <div class=\"capitalize shrink-0\">\n                                {getLineCount(item?.file?.data?.content ?? '')} extracted lines\n                            </div>\n                            \n                            <div class=\"flex items-center gap-1 shrink-0\">\n                                <Info />\n                                Formatting may be inconsistent from source.\n                            </div>\n                        {/if}\n                    </div>\n                    \n                    {#if edit}\n                        <div>\n                            <Tooltip\n                                content={enableFullContent\n                                    ? 'Inject the entire content as context for comprehensive processing, this is recommended for complex queries.'\n                                    : 'Default to segmented retrieval for focused and relevant content extraction, this is recommended for most cases.'}\n                            >\n                                <div class=\"flex items-center gap-1.5 text-xs\">\n                                    {#if enableFullContent}\n                                        Using Entire Document\n                                    {:else}\n                                        Using Focused Retrieval\n                                    {/if}\n                                    <Switch\n                                        bind:state={enableFullContent}\n                                        on:change={(e) => {\n                                            item.context = e.detail ? 'full' : undefined;\n                                        }}\n                                    />\n                                </div>\n                            </Tooltip>\n                        </div>\n                    {/if}\n                </div>\n            </div>\n        </div>\n        \n        <div class=\"max-h-[75vh] overflow-auto\">\n            {#if isPDF}\n                <iframe\n                    title={item?.name}\n                    src={`${WEBUI_API_BASE_URL}/files/${item.id}/content`}\n                    class=\"w-full h-[70vh] border-0 rounded-lg mt-4\"\n                />\n            {:else if isExcel}\n                <!-- 保留Excel编辑功能 -->\n                <ExcelViewer \n                    src={`${WEBUI_API_BASE_URL}/files/${item.id}/content`}\n                    fileName={item.name}\n                    editable={true}\n                    on:datachange={handleExcelDataChange}\n                />\n            {:else}\n                <div class=\"max-h-96 overflow-scroll scrollbar-hidden text-xs whitespace-pre-wrap\">\n                    {item?.file?.data?.content ?? 'No content'}\n                </div>\n            {/if}\n        </div>\n    </div>\n</Modal>\n\n<style>\n    :global(.scrollbar-hidden::-webkit-scrollbar) {\n        display: none;\n    }\n    \n    :global(.scrollbar-hidden) {\n        -ms-overflow-style: none;\n        scrollbar-width: none;\n    }\n</style>"],"names":["ctx","insert_hydration","target","svg","anchor","append_hydration","path","className","$$props","strokeWidth","div","button","formatFileSize","set_data","t0","t0_value","getLineCount","_c","_b","_a","div0","div1","dirty","tooltip_changes","create_if_block_3","t_value","t","WEBUI_API_BASE_URL","excelviewer_changes","attr","iframe","iframe_title_value","iframe_src_value","if_block0","create_if_block_6","if_block1","create_if_block_5","if_block2","_d","create_if_block_4","create_if_block_2","div9","div7","div3","div2","div6","div5","div4","div8","getContext","item","show","edit","enableFullContent","excelData","isExcelModified","handleExcelDataChange","event","saveExcelFile","formData","excelBlob","error","onMount","isPDF","isExcel","$$invalidate","value","e","_e","_g","_f"],"mappings":"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"}