import{s as $,y as ee,d as u,z as fe,c,B as G,i as H,b as f,x as q,e as _,f as v,l as K,h as b,o as Q,j as N,p as pe,q as me,a as te,g as le,t as se,n as he}from"../chunks/CgRTDwF2.js";import{S as ae,i as oe,f as _e,d as re,t as ne,a as ie,m as ce,b as ue,e as de}from"../chunks/Bnxgdxyh.js";import"../chunks/Fny8-CkQ.js";import{g as ve}from"../chunks/C_2ZPrHa.js";import{b as be}from"../chunks/CisIfe-u.js";import{c as ge,a as xe,u as we,m as ke}from"../chunks/D-bUEbUi.js";import{c as Ee}from"../chunks/CgEzuEYe.js";import{s as ye}from"../chunks/B9ns8vb-.js";import{S as De}from"../chunks/DwPLr_jZ.js";function Ie(s){let e,t=s[5].t("Cancel")+"",l,r,d;return{c(){e=b("button"),l=se(t),this.h()},l(a){e=_(a,"BUTTON",{class:!0});var i=v(e);l=le(i,t),i.forEach(u),this.h()},h(){c(e,"class","px-3 py-1.5 text-sm font-medium bg-gray-300 text-black transition rounded-full")},m(a,i){H(a,e,i),f(e,l),r||(d=q(e,"click",s[13]),r=!0)},p(a,i){i&32&&t!==(t=a[5].t("Cancel")+"")&&te(l,t)},d(a){a&&u(e),r=!1,d()}}}function Se(s){let e,t=s[5].t("Run")+"",l,r,d;return{c(){e=b("button"),l=se(t),this.h()},l(a){e=_(a,"BUTTON",{class:!0});var i=v(e);l=le(i,t),i.forEach(u),this.h()},h(){c(e,"class","px-3.5 py-1.5 text-sm font-medium bg-black hover:bg-gray-900 text-white dark:bg-white dark:text-black dark:hover:bg-gray-100 transition rounded-full")},m(a,i){H(a,e,i),f(e,l),r||(d=q(e,"click",s[12]),r=!0)},p(a,i){i&32&&t!==(t=a[5].t("Run")+"")&&te(l,t)},d(a){a&&u(e),r=!1,d()}}}function Ve(s){let e,t,l,r,d,a,i,D,p,x,V,w,k,S,m,R,C,I,T,U,O;function z(n){s[9](n)}let o={placeholder:s[5].t("Select a model"),items:s[4].map(Z)};s[1]!==void 0&&(o.value=s[1]),p=new De({props:o}),ee.push(()=>_e(p,"value",z));function B(n,g){return n[2]?Ie:Se}let j=B(s),h=j(s);return{c(){e=b("div"),t=b("div"),l=b("div"),r=b("div"),d=b("div"),a=b("div"),i=b("div"),D=b("div"),de(p.$$.fragment),V=Q(),w=b("div"),k=b("div"),S=b("div"),m=b("textarea"),C=Q(),I=b("div"),h.c(),this.h()},l(n){e=_(n,"DIV",{class:!0});var g=v(e);t=_(g,"DIV",{class:!0});var E=v(t);l=_(E,"DIV",{class:!0});var y=v(l);r=_(y,"DIV",{class:!0});var A=v(r);d=_(A,"DIV",{class:!0});var M=v(d);a=_(M,"DIV",{class:!0});var Y=v(a);i=_(Y,"DIV",{class:!0});var F=v(i);D=_(F,"DIV",{class:!0});var J=v(D);ue(p.$$.fragment,J),J.forEach(u),F.forEach(u),Y.forEach(u),M.forEach(u),A.forEach(u),V=K(y),w=_(y,"DIV",{class:!0,id:!0});var L=v(w);k=_(L,"DIV",{class:!0});var P=v(k);S=_(P,"DIV",{class:!0});var W=v(S);m=_(W,"TEXTAREA",{id:!0,class:!0,placeholder:!0}),v(m).forEach(u),W.forEach(u),P.forEach(u),L.forEach(u),C=K(y),I=_(y,"DIV",{class:!0});var X=v(I);h.l(X),X.forEach(u),y.forEach(u),E.forEach(u),g.forEach(u),this.h()},h(){c(D,"class","max-w-full"),c(i,"class","overflow-hidden w-full"),c(a,"class","flex w-full"),c(d,"class","flex flex-col gap-1 w-full"),c(r,"class","flex flex-col justify-between mb-1 gap-1"),c(m,"id","text-completion-textarea"),c(m,"class","w-full h-full p-3 bg-transparent border border-gray-100 dark:border-gray-850 outline-hidden resize-none rounded-lg text-sm"),c(m,"placeholder",R=s[5].t("You're a helpful assistant.")),c(S,"class","flex-1"),c(k,"class","h-full w-full flex flex-col"),c(w,"class","pt-0.5 pb-2.5 flex flex-col justify-between w-full flex-auto overflow-auto h-0"),c(w,"id","messages-container"),c(I,"class","pb-3 flex justify-end"),c(l,"class","flex flex-col h-full px-4"),c(t,"class","mx-auto w-full md:px-0 h-full"),c(e,"class","flex flex-col justify-between w-full overflow-y-auto h-full")},m(n,g){H(n,e,g),f(e,t),f(t,l),f(l,r),f(r,d),f(d,a),f(a,i),f(i,D),ce(p,D,null),f(l,V),f(l,w),f(w,k),f(k,S),f(S,m),s[10](m),G(m,s[0]),f(l,C),f(l,I),h.m(I,null),T=!0,U||(O=q(m,"input",s[11]),U=!0)},p(n,[g]){const E={};g&32&&(E.placeholder=n[5].t("Select a model")),g&16&&(E.items=n[4].map(Z)),!x&&g&2&&(x=!0,E.value=n[1],fe(()=>x=!1)),p.$set(E),(!T||g&32&&R!==(R=n[5].t("You're a helpful assistant.")))&&c(m,"placeholder",R),g&1&&G(m,n[0]),j===(j=B(n))&&h?h.p(n,g):(h.d(1),h=j(n),h&&(h.c(),h.m(I,null)))},i(n){T||(ie(p.$$.fragment,n),T=!0)},o(n){ne(p.$$.fragment,n),T=!1},d(n){n&&u(e),re(p),s[10](null),h.d(),U=!1,O()}}}const Z=s=>({value:s.id,label:s.name,model:s});function Te(s,e,t){let l,r,d,a,i;N(s,ge,o=>t(16,l=o)),N(s,xe,o=>t(17,r=o)),N(s,we,o=>t(18,d=o)),N(s,ke,o=>t(4,a=o));const D=pe("i18n");N(s,D,o=>t(5,i=o));let p="",x="",V=!1,w=!1,k;const S=()=>{const o=k;o&&(o.scrollTop=o==null?void 0:o.scrollHeight)},m=()=>{w=!0,console.log("stopResponse")},R=async()=>{const o=a.find(h=>h.id===x),[B,j]=await Ee(localStorage.token,{model:o.id,stream:!0,messages:[{role:"assistant",content:p}]},`${be}/api`);if(B&&B.ok){const h=B.body.pipeThrough(new TextDecoderStream).pipeThrough(ye(`
`)).getReader();for(;;){const{value:n,done:g}=await h.read();if(g||w){w&&j.abort("User: Stop Response");break}try{let E=n.split(`
`);for(const y of E)if(y!=="")if(y.includes("[DONE]"))console.log("done");else{let A=JSON.parse(y.replace(/^data: /,""));console.log(A),t(0,p+=A.choices[0].delta.content??"")}}catch(E){console.log(E)}S()}}},C=async()=>{x&&(t(2,V=!0),await R(),t(2,V=!1),w=!1)};me(async()=>{(d==null?void 0:d.role)!=="admin"&&await ve("/"),r!=null&&r.models?t(1,x=r==null?void 0:r.models[0]):l!=null&&l.default_models?t(1,x=l==null?void 0:l.default_models.split(",")[0]):t(1,x="")});function I(o){x=o,t(1,x)}function T(o){ee[o?"unshift":"push"](()=>{k=o,t(3,k)})}function U(){p=this.value,t(0,p)}return[p,x,V,k,a,i,D,m,C,I,T,U,()=>{C()},()=>{m()}]}class Re extends ae{constructor(e){super(),oe(this,e,Te,Ve,$,{})}}function Ce(s){let e,t;return e=new Re({}),{c(){de(e.$$.fragment)},l(l){ue(e.$$.fragment,l)},m(l,r){ce(e,l,r),t=!0},p:he,i(l){t||(ie(e.$$.fragment,l),t=!0)},o(l){ne(e.$$.fragment,l),t=!1},d(l){re(e,l)}}}class Me extends ae{constructor(e){super(),oe(this,e,null,Ce,$,{})}}export{Me as component};
//# sourceMappingURL=22.BLkwNyuR.js.map
